<p-table tyleClass="p-datatable-gridlines" [scrollable]="true" scrollHeight="400px" [value]="lstofMaintenance" #dt
    class="mx-3" [paginator]="true" [rows]="size" [totalRecords]="totalRecords"
    currentPageReportTemplate="Showing {first} to {last} of {totalRecords} regions" [showCurrentPageReport]="true"
    [rowsPerPageOptions]="rowsPerPageOptions">
    <ng-template pTemplate="header">
        <tr>
            <th *ngFor="let col of cols">
                {{col.header}}
            </th>
        </tr>
    </ng-template>
    <ng-template pTemplate="body" let-data>
        <tr>
            <td>
                {{data.userMasterid}}
            </td>
            <td>
                {{data.amount}}
            </td>
            <td>
                {{data.usedUnit}}
            </td>
            <td>
                {{data.previousReading}}
            </td>
            <td>
                {{data.currentReading}}
            </td>
            <td>
                <p *ngIf="data.amountReceived">{{data.amountReceived|currency:"INR":"symbol"}}</p>
                <p *ngIf="!data.amountReceived"> - </p>
            </td>
            <td>
                <button *ngIf="!data.maintenancePaid" class="p-button bg-dark rounded"
                    style="font-size: 15px; padding: 10px;" (click)="showMaintenanceBillDialog(data)">
                    <i class="pi pi-eye" style="font-size: 15px"></i>
                </button> &nbsp;
                <button *ngIf="!data.maintenancePaid" style="font-size: 15px; padding: 10px;"
                    class="p-button bg-dark rounded" (click)="showGenerateReceiptDialog(data)">
                    <i class="pi pi-upload" style="font-size: 15px"></i>
                </button> &nbsp;
                <button *ngIf="data.maintenancePaid" class="p-button bg-dark rounded"
                    style="font-size: 15px; padding: 10px;" (click)="showMaintenanceReceiptDialog(data)">
                    <i class="pi pi-eye" style="font-size: 15px"></i>
                </button>
            </td>
        </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage">
        <tr>
            <td [attr.colspan]="3" class="text-center">
                No records found
            </td>
        </tr>
    </ng-template>
</p-table>


<!-- Generate maintenance Bill Dialog -->
<p-dialog [(visible)]="maintenanceBillDialog" [style]="{width: '650px'}" [modal]="true" styleClass="p-fluid"
    (onHide)="hidemaintenanceBillDialog()">

    <ng-template pTemplate="content">
        <div id="generatedBillTabel" *ngIf="maintenanceBillDialog">
            <table class="table">
                <thead class="thead-light">
                    <tr>
                        <th scope="col" class="align-center text-center" colspan="3" style="font-size: 2rem;">
                            Maintenance Bill</th>
                    </tr>
                    <tr>
                        <th scope="col" colspan="3">The Aqua Polaris Appartment, Nr. S.P. Ring Road, NH-8,
                            Nr. Pushkar bung, Nana Chiloda, Ahmedabad</th>
                    </tr>
                    <tr>
                        <th scope="col" colspan="3">Name : {{maintenanceBill.userMasterid}}</th>
                    </tr>
                    <tr>
                        <th scope="col" colspan="3">Month : {{maintenanceBill.createdDate | date}}</th>
                    </tr>
                    <tr>
                        <th scope="col">Description</th>
                        <th scope="col">Unit/Reading</th>
                        <th scope="col">Amount</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="text-wrap text-break">Current Reading</td>
                        <td *ngIf="maintenanceBill?.currentReading">{{maintenanceBill?.currentReading}}</td>
                        <td>-</td>
                    </tr>
                    <tr>
                        <td class="text-wrap text-break">Previous Reading</td>
                        <td *ngIf="maintenanceBill?.previousReading">{{maintenanceBill?.previousReading}}</td>
                        <td>-</td>
                    </tr>
                    <tr>
                        <td>Used Unit </td>
                        <td *ngIf="maintenanceBill?.usedUnit">{{maintenanceBill?.usedUnit}}</td>
                        <td>-</td>
                    </tr>
                    <tr>
                        <td>Rate /- unit</td>
                        <td>-</td>
                        <td *ngIf="maintenanceBill?.waterAmount">{{maintenanceBill?.waterAmount}}</td>
                    </tr>
                    <tr>
                        <td>Maintenance Amount</td>
                        <td>-</td>
                        <td *ngIf="maintenanceBill?.maintenanceAmount">{{maintenanceBill?.maintenanceAmount}}</td>
                    </tr>
                    <tr>
                        <td>Remaining Amount</td>
                        <td>55</td>
                        <td *ngIf="maintenanceBill?.amount">{{maintenanceBill?.amount}}</td>
                    </tr>
                    <!-- <tr>
                        <td>Payment type</td>
                        <td *ngIf="maintenanceBill?.payType">{{maintenanceBill?.payType.label}}</td>
                        <td>653</td>
                    </tr> -->
                    <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>Total</td>
                        <td></td>
                        <td *ngIf="maintenanceBill?.amount">{{maintenanceBill?.amount}}</td>
                    </tr>
                </tbody>
            </table>

        </div>

    </ng-template>

    <ng-template pTemplate="footer">
        <button type="button" pButton pRipple (click)="exportPdfForBill()" class="p-button-warning"
            pTooltip="Download PDF" tooltipPosition="bottom">
            <i class="pi pi-download" style="font-size: 15px"></i>
        </button>
    </ng-template>

</p-dialog>


<!-- Generate maintenance Receipt Dialog -->
<p-dialog [(visible)]="maintenanceReceiptDialog" [style]="{width: '650px'}" [modal]="true" styleClass="p-fluid"
    (onHide)="hidemaintenanceReceiptDialog()">

    <ng-template pTemplate="content">
        <div id="generatedReceiptTabel" *ngIf="maintenanceReceiptDialog">
            <table class="table">
                <thead class="thead-light">
                    <tr>
                        <th scope="col" class="align-center text-center" colspan="3" style="font-size: 2rem;">
                            Maintenance Receipt</th>
                    </tr>
                    <tr>
                        <th scope="col" colspan="3">The Aqua Polaris Appartment, Nr. S.P. Ring Road, NH-8,
                            Nr. Pushkar bung, Nana Chiloda, Ahmedabad</th>
                    </tr>
                    <tr>
                        <th scope="col" colspan="3">Name : {{maintenanceReceipt.userMasterid}}</th>
                    </tr>
                    <tr>
                        <th scope="col" colspan="3">Month : {{maintenanceReceipt.createdDate | date }} </th>
                    </tr>
                    <tr>
                        <th scope="col">Description</th>
                        <th scope="col">Amount / Reference No.</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Maintenance Amount</td>
                        <td *ngIf="maintenanceReceipt?.maintenanceAmount">{{maintenanceReceipt?.maintenanceAmount}}</td>
                    </tr>
                    <tr>
                        <td>Payment type</td>
                        <td *ngIf="maintenanceReceipt?.payType">{{maintenanceReceipt?.amountType | lowercase}}</td>
                    </tr>
                    <tr>
                        <td>Reference No / Chaque No</td>
                        <td *ngIf="maintenanceReceipt?.payType">{{maintenanceReceipt?.referenceNo}}</td>
                    </tr>
                    <tr>
                        <td>Bank Name</td>
                        <td *ngIf="maintenanceReceipt?.payType">{{maintenanceReceipt?.bankName}}</td>
                    </tr>
                    <tr>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>Amount Paid</td>
                        <td *ngIf="maintenanceReceipt?.amount">{{maintenanceReceipt?.amountReceived}}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </ng-template>

    <ng-template pTemplate="footer">
        <button type="button" pButton pRipple (click)="exportPdfForBill()" class="p-button-warning"
            pTooltip="Download PDF" tooltipPosition="bottom">
            <i class="pi pi-download" style="font-size: 15px"></i>
        </button>
    </ng-template>

</p-dialog>


<!-- Generate maintenance Dialog -->
<p-dialog [(visible)]="generateReceiptDialog" [style]="{width: '450px'}" header="{{popupHeader}}" [modal]="true"
    styleClass="p-fluid" (onHide)="hideGenerateReceiptDialog()">

    <ng-template pTemplate="content">
        <form [formGroup]="generateMaintenanceForm" (ngSubmit)="GenerateMaintenanceBill()">
            <div class="p-field">
                <label for="maintenanceAmount">Maintenance Amount* </label>
                <input type="text" disabled pInputText id="maintenanceAmount" formControlName="maintenanceAmount"
                    placeholder="Enter Maintenance Amount" required autofocus pKeyFilter="num" maxLength="50" />
                <div class="p-invalid"
                    *ngIf=" generateMaintenanceFormSubmitted && generateMaintenanceForm.controls['maintenanceAmount'].touched && (generateMaintenanceForm.controls['maintenanceAmount'].hasError('required') && !generateMaintenanceForm.controls['maintenanceAmount'].valid)">
                    required
                </div>
            </div>
            <div class="p-field">
                <label for="waterAmount">Water Bill Amount* </label>
                <input type="text" disabled pInputText id="waterAmount" formControlName="waterAmount"
                    placeholder="Enter Water Amount" required autofocus pKeyFilter="num" maxLength="50" />
                <div class="p-invalid"
                    *ngIf=" generateMaintenanceFormSubmitted && generateMaintenanceForm.controls['waterAmount'].touched && (generateMaintenanceForm.controls['waterAmount'].hasError('required') && !generateMaintenanceForm.controls['waterAmount'].valid)">
                    required
                </div>
            </div>
            <div class="p-field">
                <label for="usedUnit">Used Water unit* </label>
                <input type="text" disabled pInputText id="usedUnit" formControlName="usedUnit"
                    placeholder="Enter Used Unit" required autofocus pKeyFilter="num" maxLength="50" />
                <div class="p-invalid"
                    *ngIf=" generateMaintenanceFormSubmitted && generateMaintenanceForm.controls['usedUnit'].touched && (generateMaintenanceForm.controls['usedUnit'].hasError('required') && !generateMaintenanceForm.controls['usedUnit'].valid)">
                    required
                </div>
            </div>
            <div class="p-field">
                <label for="previousReading">Previous Reading* </label>
                <input type="text" disabled pInputText id="previousReading" formControlName="previousReading"
                    placeholder="Enter Previous Reading" required autofocus pKeyFilter="num" maxLength="50" />
                <div class="p-invalid"
                    *ngIf=" generateMaintenanceFormSubmitted && generateMaintenanceForm.controls['previousReading'].touched && (generateMaintenanceForm.controls['previousReading'].hasError('required') && !generateMaintenanceForm.controls['previousReading'].valid)">
                    required
                </div>
            </div>
            <div class="p-field">
                <label for="currentReading">Current Reading* </label>
                <input type="text" disabled pInputText id="currentReading" formControlName="currentReading"
                    placeholder="Enter Current Reading" required autofocus pKeyFilter="num" maxLength="50" />
                <div class="p-invalid"
                    *ngIf=" generateMaintenanceFormSubmitted && generateMaintenanceForm.controls['currentReading'].touched && (generateMaintenanceForm.controls['currentReading'].hasError('required') && !generateMaintenanceForm.controls['currentReading'].valid)">
                    required
                </div>
            </div>
            <div class="p-field">
                <label for="averageReading">Average Reading* </label>
                <input type="text" disabled pInputText id="averageReading" formControlName="averageReading"
                    placeholder="Enter Average Reading" autofocus pKeyFilter="num" maxLength="50" />
                <div class="p-invalid"
                    *ngIf=" generateMaintenanceFormSubmitted && generateMaintenanceForm.controls['averageReading'].touched && (generateMaintenanceForm.controls['averageReading'].hasError('required') && !generateMaintenanceForm.controls['averageReading'].valid)">
                    required
                </div>
            </div>
            <div class="p-field">
                <label for="amount">Total Payable Amount* </label>
                <input type="text" disabled pInputText id="amount" formControlName="amount" placeholder="Enter Amount"
                    required autofocus pKeyFilter="num" maxLength="50" />
                <div class="p-invalid"
                    *ngIf=" generateMaintenanceFormSubmitted && generateMaintenanceForm.controls['amount'].touched && (generateMaintenanceForm.controls['amount'].hasError('required') && !generateMaintenanceForm.controls['amount'].valid)">
                    required
                </div>
            </div>

            <div class="p-field">
                <label for="referenceNo"> Reference No / Chaque No* </label>
                <input type="text" pInputText id="referenceNo" formControlName="referenceNo"
                    placeholder="Enter referenceNo" required autofocus pKeyFilter="num" maxLength="50" />
                <div class="p-invalid"
                    *ngIf=" generateMaintenanceFormSubmitted && generateMaintenanceForm.controls['referenceNo'].touched && (generateMaintenanceForm.controls['referenceNo'].hasError('required') && !generateMaintenanceForm.controls['referenceNo'].valid)">
                    required
                </div>
            </div>
            <div class="p-field">
                <label for="bankName"> Bank Name* </label>
                <input type="text" pInputText id="bankName" formControlName="bankName" placeholder="Enter bankName"
                    required autofocus pKeyFilter="num" maxLength="50" />
                <div class="p-invalid"
                    *ngIf=" generateMaintenanceFormSubmitted && generateMaintenanceForm.controls['bankName'].touched && (generateMaintenanceForm.controls['bankName'].hasError('required') && !generateMaintenanceForm.controls['bankName'].valid)">
                    required
                </div>
            </div>

            <div class="p-field">
                <label for="name">Select Payment Type* </label>
                <p-dropdown [options]="paymentType" formControlName="amountType" placeholder="Select Payment Type">
                </p-dropdown>
                <div class="p-invalid"
                    *ngIf="generateMaintenanceFormSubmitted && generateMaintenanceForm.controls['amountType'].touched && (generateMaintenanceForm.controls['amountType'].hasError('required') && !generateMaintenanceForm.controls['amountType'].valid)">
                    required
                </div>
            </div>

            <div class="p-field">
                <label for="amountReceived"> Amount To Pay* </label>
                <input type="text" pInputText id="amountReceived" formControlName="amountReceived"
                    placeholder="Enter amountReceived" required autofocus pKeyFilter="num" maxLength="50" />
                <div class="p-invalid"
                    *ngIf=" generateMaintenanceFormSubmitted && generateMaintenanceForm.controls['amountReceived'].touched && (generateMaintenanceForm.controls['amountReceived'].hasError('required') && !generateMaintenanceForm.controls['amountReceived'].valid)">
                    required
                </div>
            </div>

        </form>
    </ng-template>

    <ng-template pTemplate="footer">
        <button pButton pRipple label="Cancel" icon="pi pi-times" class="bg-admin"
            (click)="hideGenerateReceiptDialog()"></button>
        <button pButton pRipple label="Save" icon="pi pi-check" class="p-button-outlined"
            (click)="onSubmitGenerateReceipt(generateMaintenanceForm)"></button>
    </ng-template>

</p-dialog>