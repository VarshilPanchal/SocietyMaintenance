(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{"I/3d":function(t,e,n){"use strict";n.d(e,"a",(function(){return tp}));var r=n("fXoL"),i=n("D0XW"),o=n("HDdC"),s=n("Cfvw"),a=n("LRne"),u=n("JX91"),c=n("Zy1z"),h=n("lJxs"),l=n("Kqap"),f=n("/uUt"),d=n("pLZG"),p=n("pxpQ"),y=n("spgP"),g=n("ofXK"),v=n("Jgta"),m=n("zIRd"),b=n("mrSG"),w=n("qOnz"),I=n("q/0M"),T=function(t,e){return(T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function E(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var _,O="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},S=S||{},D=O||self;function A(){}function N(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function j(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var k="closure_uid_"+(1e9*Math.random()>>>0),C=0;function x(t,e,n){return t.call.apply(t.bind,arguments)}function R(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function P(t,e,n){return(P=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?x:R).apply(null,arguments)}function L(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function F(t,e){function n(){}n.prototype=e.prototype,t.Z=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Vb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function M(){this.s=this.s,this.o=this.o}var q={};M.prototype.s=!1,M.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var t=function(t){return Object.prototype.hasOwnProperty.call(t,k)&&t[k]||(t[k]=++C)}(this);delete q[t]}},M.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var U=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},V=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function B(t){return Array.prototype.concat.apply([],arguments)}function K(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function G(t){return/^[\s\xa0]*$/.test(t)}var z,Q=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function H(t,e){return-1!=t.indexOf(e)}function W(t,e){return t<e?-1:t>e?1:0}t:{var Y=D.navigator;if(Y){var X=Y.userAgent;if(X){z=X;break t}}z=""}function $(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function J(t){var e={};for(var n in t)e[n]=t[n];return e}var Z="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function tt(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<Z.length;o++)n=Z[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function et(t){return et[" "](t),t}et[" "]=A;var nt,rt,it=H(z,"Opera"),ot=H(z,"Trident")||H(z,"MSIE"),st=H(z,"Edge"),at=st||ot,ut=H(z,"Gecko")&&!(H(z.toLowerCase(),"webkit")&&!H(z,"Edge"))&&!(H(z,"Trident")||H(z,"MSIE"))&&!H(z,"Edge"),ct=H(z.toLowerCase(),"webkit")&&!H(z,"Edge");function ht(){var t=D.document;return t?t.documentMode:void 0}t:{var lt="",ft=(rt=z,ut?/rv:([^\);]+)(\)|;)/.exec(rt):st?/Edge\/([\d\.]+)/.exec(rt):ot?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(rt):ct?/WebKit\/(\S+)/.exec(rt):it?/(?:Version)[ \/]?(\S+)/.exec(rt):void 0);if(ft&&(lt=ft?ft[1]:""),ot){var dt=ht();if(null!=dt&&dt>parseFloat(lt)){nt=String(dt);break t}}nt=lt}var pt={};var yt=D.document&&ot&&(ht()||parseInt(nt,10))||void 0,gt=function(){if(!D.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{D.addEventListener("test",A,e),D.removeEventListener("test",A,e)}catch(n){}return t}();function vt(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}function mt(t,e){if(vt.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(ut){t:{try{et(e.nodeName);var i=!0;break t}catch(o){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:bt[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&mt.Z.h.call(this)}}vt.prototype.h=function(){this.defaultPrevented=!0},F(mt,vt);var bt={2:"touch",3:"pen",4:"mouse"};mt.prototype.h=function(){mt.Z.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var wt="closure_listenable_"+(1e6*Math.random()|0),It=0;function Tt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ia=i,this.key=++It,this.ca=this.fa=!1}function Et(t){t.ca=!0,t.listener=null,t.proxy=null,t.src=null,t.ia=null}function _t(t){this.src=t,this.g={},this.h=0}function Ot(t,e){var n=e.type;if(n in t.g){var r,i=t.g[n],o=U(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(Et(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function St(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.ca&&o.listener==e&&o.capture==!!n&&o.ia==r)return i}return-1}_t.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.g[o])||(t=this.g[o]=[],this.h++);var s=St(t,e,r,i);return-1<s?(e=t[s],n||(e.fa=!1)):((e=new Tt(e,this.src,o,!!r,i)).fa=n,t.push(e)),e};var Dt="closure_lm_"+(1e6*Math.random()|0),At={};function Nt(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}return r=Lt(r),e&&e[wt]?e.O(n,r,j(i)?!!i.capture:!!i,o):jt(e,n,r,!0,i,o)}(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)Nt(t,e[o],n,r,i);return null}return n=Lt(n),t&&t[wt]?t.N(e,n,j(r)?!!r.capture:!!r,i):jt(t,e,n,!1,r,i)}function jt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=j(i)?!!i.capture:!!i,a=Rt(t);if(a||(t[Dt]=a=new _t(t)),(n=a.add(e,n,r,s,o)).proxy)return n;if(r=function(){var t=xt;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)gt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Ct(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function kt(t){if("number"!=typeof t&&t&&!t.ca){var e=t.src;if(e&&e[wt])Ot(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Ct(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Rt(e))?(Ot(n,t),0==n.h&&(n.src=null,e[Dt]=null)):Et(t)}}}function Ct(t){return t in At?At[t]:At[t]="on"+t}function xt(t,e){if(t.ca)t=!0;else{e=new mt(e,this);var n=t.listener,r=t.ia||t.src;t.fa&&kt(t),t=n.call(r,e)}return t}function Rt(t){return(t=t[Dt])instanceof _t?t:null}var Pt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Lt(t){return"function"==typeof t?t:(t[Pt]||(t[Pt]=function(e){return t.handleEvent(e)}),t[Pt])}function Ft(){M.call(this),this.i=new _t(this),this.P=this,this.I=null}function Mt(t,e){var n,r=t.I;if(r)for(n=[];r;r=r.I)n.push(r);if(t=t.P,r=e.type||e,"string"==typeof e)e=new vt(e,t);else if(e instanceof vt)e.target=e.target||t;else{var i=e;tt(e=new vt(r,t),i)}if(i=!0,n)for(var o=n.length-1;0<=o;o--){var s=e.g=n[o];i=qt(s,r,!0,e)&&i}if(i=qt(s=e.g=t,r,!0,e)&&i,i=qt(s,r,!1,e)&&i,n)for(o=0;o<n.length;o++)i=qt(s=e.g=n[o],r,!1,e)&&i}function qt(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.ca&&s.capture==n){var a=s.listener,u=s.ia||s.src;s.fa&&Ot(t.i,s),i=!1!==a.call(u,r)&&i}}return i&&!r.defaultPrevented}F(Ft,M),Ft.prototype[wt]=!0,Ft.prototype.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=j(i)?!!i.capture:!!i,r=Lt(r),e&&e[wt]?(e=e.i,(n=String(n).toString())in e.g&&-1<(r=St(s=e.g[n],r,i,o))&&(Et(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.g[n],e.h--))):e&&(e=Rt(e))&&(n=e.g[n.toString()],e=-1,n&&(e=St(n,r,i,o)),(r=-1<e?n[e]:null)&&kt(r))}(this,t,e,n,r)},Ft.prototype.M=function(){if(Ft.Z.M.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)Et(n[r]);delete e.g[t],e.h--}}this.I=null},Ft.prototype.N=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},Ft.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};var Ut=D.JSON.stringify;function Vt(){var t=Yt,e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var Bt,Kt=function(){function t(){this.h=this.g=null}return t.prototype.add=function(t,e){var n=Gt.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n},t}(),Gt=new(function(){function t(t,e){this.i=t,this.j=e,this.h=0,this.g=null}return t.prototype.get=function(){var t;return 0<this.h?(this.h--,this.g=(t=this.g).next,t.next=null):t=this.i(),t},t}())((function(){return new zt}),(function(t){return t.reset()})),zt=function(){function t(){this.next=this.g=this.h=null}return t.prototype.set=function(t,e){this.h=t,this.g=e,this.next=null},t.prototype.reset=function(){this.next=this.g=this.h=null},t}();function Qt(t){D.setTimeout((function(){throw t}),0)}function Ht(t,e){Bt||function(){var t=D.Promise.resolve(void 0);Bt=function(){t.then(Xt)}}(),Wt||(Bt(),Wt=!0),Yt.add(t,e)}var Wt=!1,Yt=new Kt;function Xt(){for(var t;t=Vt();){try{t.h.call(t.g)}catch(n){Qt(n)}var e=Gt;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}Wt=!1}function $t(t,e){Ft.call(this),this.h=t||1,this.g=e||D,this.j=P(this.kb,this),this.l=Date.now()}function Jt(t){t.da=!1,t.S&&(t.g.clearTimeout(t.S),t.S=null)}function Zt(t,e,n){if("function"==typeof t)n&&(t=P(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=P(t.handleEvent,t)}return 2147483647<Number(e)?-1:D.setTimeout(t,e||0)}function te(t){t.g=Zt((function(){t.g=null,t.i&&(t.i=!1,te(t))}),t.j);var e=t.h;t.h=null,t.m.apply(null,e)}F($t,Ft),(_=$t.prototype).da=!1,_.S=null,_.kb=function(){if(this.da){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-t):(this.S&&(this.g.clearTimeout(this.S),this.S=null),Mt(this,"tick"),this.da&&(Jt(this),this.start()))}},_.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},_.M=function(){$t.Z.M.call(this),Jt(this),delete this.g};var ee=function(t){function e(e,n){var r=t.call(this)||this;return r.m=e,r.j=n,r.h=null,r.i=!1,r.g=null,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}T(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.l=function(t){this.h=arguments,this.g?this.i=!0:te(this)},e.prototype.M=function(){t.prototype.M.call(this),this.g&&(D.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)},e}(M);function ne(t){M.call(this),this.h=t,this.g={}}F(ne,M);var re=[];function ie(t,e,n,r){Array.isArray(n)||(n&&(re[0]=n.toString()),n=re);for(var i=0;i<n.length;i++){var o=Nt(e,n[i],r||t.handleEvent,!1,t.h||t);if(!o)break;t.g[o.key]=o}}function oe(t){$(t.g,(function(t,e){this.g.hasOwnProperty(e)&&kt(t)}),t),t.g={}}function se(){this.g=!0}function ae(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return Ut(n)}catch(a){return e}}(t,n)+(r?" "+r:"")}))}ne.prototype.M=function(){ne.Z.M.call(this),oe(this)},ne.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},se.prototype.Aa=function(){this.g=!1},se.prototype.info=function(){};var ue={},ce=null;function he(){return ce=ce||new Ft}function le(t){vt.call(this,ue.Ma,t)}function fe(t){var e=he();Mt(e,new le(e,t))}function de(t,e){vt.call(this,ue.STAT_EVENT,t),this.stat=e}function pe(t){var e=he();Mt(e,new de(e,t))}function ye(t,e){vt.call(this,ue.Na,t),this.size=e}function ge(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return D.setTimeout((function(){t()}),e)}ue.Ma="serverreachability",F(le,vt),ue.STAT_EVENT="statevent",F(de,vt),ue.Na="timingevent",F(ye,vt);var ve={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},me={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function be(){}function we(){}be.prototype.h=null;var Ie,Te={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function Ee(){vt.call(this,"d")}function _e(){vt.call(this,"c")}function Oe(){}function Se(t,e,n,r){this.l=t,this.j=e,this.m=n,this.X=r||1,this.V=new ne(this),this.P=Ae,this.W=new $t(t=at?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new De}function De(){this.i=null,this.g="",this.h=!1}F(Ee,vt),F(_e,vt),F(Oe,be),Oe.prototype.g=function(){return new XMLHttpRequest},Oe.prototype.i=function(){return{}},Ie=new Oe;var Ae=45e3,Ne={},je={};function ke(t,e,n){t.K=1,t.v=tn(We(e)),t.s=n,t.U=!0,Ce(t,null)}function Ce(t,e){t.F=Date.now(),Le(t),t.A=We(t.v);var n=t.A,r=t.X;Array.isArray(r)||(r=[String(r)]),pn(n.h,"t",r),t.C=0,n=t.l.H,t.h=new De,t.g=yr(t.l,n?e:null,!t.s),0<t.O&&(t.L=new ee(P(t.Ia,t,t.g),t.O)),ie(t.V,t.g,"readystatechange",t.gb),e=t.H?J(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.s,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),fe(1),function(t,e,n,r,i,o){t.info((function(){if(t.g)if(o)for(var s="",a=o.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var h=c[0];c=c[1];var l=h.split("_");s=2<=l.length&&"type"==l[1]?s+(h+"=")+c+"&":s+(h+"=redacted&")}}else s=null;else s=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+s}))}(t.j,t.u,t.A,t.m,t.X,t.s)}function xe(t){return!!t.g&&"GET"==t.u&&2!=t.K&&t.l.Ba}function Re(t,e,n){for(var r,i=!0;!t.I&&t.C<n.length;){if((r=Pe(t,n))==je){4==e&&(t.o=4,pe(14),i=!1),ae(t.j,t.m,null,"[Incomplete Response]");break}if(r==Ne){t.o=4,pe(15),ae(t.j,t.m,n,"[Invalid Chunk]"),i=!1;break}ae(t.j,t.m,r,null),Ve(t,r)}xe(t)&&r!=je&&r!=Ne&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,pe(16),i=!1),t.i=t.i&&i,i?0<n.length&&!t.aa&&(t.aa=!0,(e=t.l).g==t&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),ar(e),e.L=!0,pe(11))):(ae(t.j,t.m,n,"[Invalid Chunked Response]"),Ue(t),qe(t))}function Pe(t,e){var n=t.C,r=e.indexOf("\n",n);return-1==r?je:(n=Number(e.substring(n,r)),isNaN(n)?Ne:(r+=1)+n>e.length?je:(e=e.substr(r,n),t.C=r+n,e))}function Le(t){t.Y=Date.now()+t.P,Fe(t,t.P)}function Fe(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=ge(P(t.eb,t),e)}function Me(t){t.B&&(D.clearTimeout(t.B),t.B=null)}function qe(t){0==t.l.G||t.I||hr(t.l,t)}function Ue(t){Me(t);var e=t.L;e&&"function"==typeof e.na&&e.na(),t.L=null,Jt(t.W),oe(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function Ve(t,e){try{var n=t.l;if(0!=n.G&&(n.g==t||In(n.i,t)))if(n.I=t.N,!t.J&&In(n.i,t)&&3==n.G){try{var r=n.Ca.g.parse(e)}catch(o){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;cr(n),Jn(n)}sr(n),pe(18)}}else n.ta=i[1],0<n.ta-n.U&&37500>i[2]&&n.N&&0==n.A&&!n.v&&(n.v=ge(P(n.ab,n),6e3));if(1>=wn(n.i)&&n.ka){try{n.ka()}catch(o){}n.ka=void 0}}else fr(n,11)}else if((t.J||n.g==t)&&cr(n),!G(e))for(i=n.Ca.g.parse(e),e=0;e<i.length;e++){var o=i[e];if(n.U=o[0],o=o[1],2==n.G)if("c"==o[0]){n.J=o[1],n.la=o[2];var s=o[3];null!=s&&(n.ma=s,n.h.info("VER="+n.ma));var a=o[4];null!=a&&(n.za=a,n.h.info("SVER="+n.za));var u=o[5];null!=u&&"number"==typeof u&&0<u&&(n.K=r=1.5*u,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;var c=t.g;if(c){var h=c.g?c.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var l=r.i;!l.g&&(H(h,"spdy")||H(h,"quic")||H(h,"h2"))&&(l.j=l.l,l.g=new Set,l.h&&(Tn(l,l.h),l.h=null))}if(r.D){var f=c.g?c.g.getResponseHeader("X-HTTP-Session-Id"):null;f&&(r.sa=f,Ze(r.F,r.D,f))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-t.F,n.h.info("Handshake RTT: "+n.O+"ms"));var d=t;if((r=n).oa=pr(r,r.H?r.la:null,r.W),d.J){En(r.i,d);var p=d,y=r.K;y&&p.setTimeout(y),p.B&&(Me(p),Le(p)),r.g=d}else or(r);0<n.l.length&&er(n)}else"stop"!=o[0]&&"close"!=o[0]||fr(n,7);else 3==n.G&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?fr(n,7):$n(n):"noop"!=o[0]&&n.j&&n.j.wa(o),n.A=0)}fe(4)}catch(o){}}function Be(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(N(t)||"string"==typeof t)V(t,e,void 0);else{if(t.T&&"function"==typeof t.T)var n=t.T();else if(t.R&&"function"==typeof t.R)n=void 0;else if(N(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.R&&"function"==typeof t.R)return t.R();if("string"==typeof t)return t.split("");if(N(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Ke(t,e){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Ke)for(n=t.T(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Ge(t){if(t.i!=t.g.length){for(var e=0,n=0;e<t.g.length;){var r=t.g[e];ze(t.h,r)&&(t.g[n++]=r),e++}t.g.length=n}if(t.i!=t.g.length){var i={};for(n=e=0;e<t.g.length;)ze(i,r=t.g[e])||(t.g[n++]=r,i[r]=1),e++;t.g.length=n}}function ze(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(_=Se.prototype).setTimeout=function(t){this.P=t},_.gb=function(t){t=t.target;var e=this.L;e&&3==Qn(t)?e.l():this.Ia(t)},_.Ia=function(t){try{if(t==this.g)t:{var e=Qn(this.g),n=this.g.Da(),r=this.g.ba();if(!(3>e)&&(3!=e||at||this.g&&(this.h.h||this.g.ga()||Hn(this.g)))){this.I||4!=e||7==n||fe(8==n||0>=r?3:2),Me(this);var i=this.g.ba();this.N=i;e:if(xe(this)){var o=Hn(this.g);t="";var s=o.length,a=4==Qn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Ue(this),qe(this);var u="";break e}this.h.i=new D.TextDecoder}for(n=0;n<s;n++)this.h.h=!0,t+=this.h.i.decode(o[n],{stream:a&&n==s-1});o.splice(0,s),this.h.g+=t,this.C=0,u=this.h.g}else u=this.g.ga();if(this.i=200==i,function(t,e,n,r,i,o,s){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+o+" "+s}))}(this.j,this.u,this.A,this.m,this.X,e,i),this.i){if(this.$&&!this.J){e:{if(this.g){var c,h=this.g;if((c=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!G(c)){var l=c;break e}}l=null}if(!(i=l)){this.i=!1,this.o=3,pe(12),Ue(this),qe(this);break t}ae(this.j,this.m,i,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Ve(this,i)}this.U?(Re(this,e,u),at&&this.i&&3==e&&(ie(this.V,this.W,"tick",this.fb),this.W.start())):(ae(this.j,this.m,u,null),Ve(this,u)),4==e&&Ue(this),this.i&&!this.I&&(4==e?hr(this.l,this):(this.i=!1,Le(this)))}else 400==i&&0<u.indexOf("Unknown SID")?(this.o=3,pe(12)):(this.o=0,pe(13)),Ue(this),qe(this)}}}catch(e){}},_.fb=function(){if(this.g){var t=Qn(this.g),e=this.g.ga();this.C<e.length&&(Me(this),Re(this,t,e),this.i&&4!=t&&Le(this))}},_.cancel=function(){this.I=!0,Ue(this)},_.eb=function(){this.B=null;var t=Date.now();0<=t-this.Y?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.j,this.A),2!=this.K&&(fe(3),pe(17)),Ue(this),this.o=2,qe(this)):Fe(this,this.Y-t)},(_=Ke.prototype).R=function(){Ge(this);for(var t=[],e=0;e<this.g.length;e++)t.push(this.h[this.g[e]]);return t},_.T=function(){return Ge(this),this.g.concat()},_.get=function(t,e){return ze(this.h,t)?this.h[t]:e},_.set=function(t,e){ze(this.h,t)||(this.i++,this.g.push(t)),this.h[t]=e},_.forEach=function(t,e){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Qe=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function He(t,e){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,t instanceof He){this.g=void 0!==e?e:t.g,Ye(this,t.j),this.s=t.s,Xe(this,t.i),$e(this,t.m),this.l=t.l,e=t.h;var n=new hn;n.i=e.i,e.g&&(n.g=new Ke(e.g),n.h=e.h),Je(this,n),this.o=t.o}else t&&(n=String(t).match(Qe))?(this.g=!!e,Ye(this,n[1]||"",!0),this.s=en(n[2]||""),Xe(this,n[3]||"",!0),$e(this,n[4]),this.l=en(n[5]||"",!0),Je(this,n[6]||"",!0),this.o=en(n[7]||"")):(this.g=!!e,this.h=new hn(null,this.g))}function We(t){return new He(t)}function Ye(t,e,n){t.j=n?en(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function Xe(t,e,n){t.i=n?en(e,!0):e}function $e(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function Je(t,e,n){e instanceof hn?(t.h=e,function(t,e){e&&!t.j&&(ln(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(fn(this,e),pn(this,n,t))}),t)),t.j=e}(t.h,t.g)):(n||(e=nn(e,un)),t.h=new hn(e,t.g))}function Ze(t,e,n){t.h.set(e,n)}function tn(t){return Ze(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function en(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function nn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,rn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function rn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}He.prototype.toString=function(){var t=[],e=this.j;e&&t.push(nn(e,on,!0),":");var n=this.i;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(nn(e,on,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&t.push("/"),t.push(nn(n,"/"==n.charAt(0)?an:sn,!0))),(n=this.h.toString())&&t.push("?",n),(n=this.o)&&t.push("#",nn(n,cn)),t.join("")};var on=/[#\/\?@]/g,sn=/[#\?:]/g,an=/[#\?]/g,un=/[#\?@]/g,cn=/#/g;function hn(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function ln(t){t.g||(t.g=new Ke,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function fn(t,e){ln(t),e=yn(t,e),ze(t.g.h,e)&&(t.i=null,t.h-=t.g.get(e).length,ze((t=t.g).h,e)&&(delete t.h[e],t.i--,t.g.length>2*t.i&&Ge(t)))}function dn(t,e){return ln(t),e=yn(t,e),ze(t.g.h,e)}function pn(t,e,n){fn(t,e),0<n.length&&(t.i=null,t.g.set(yn(t,e),K(n)),t.h+=n.length)}function yn(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}(_=hn.prototype).add=function(t,e){ln(this),this.i=null,t=yn(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},_.forEach=function(t,e){ln(this),this.g.forEach((function(n,r){V(n,(function(n){t.call(e,n,r,this)}),this)}),this)},_.T=function(){ln(this);for(var t=this.g.R(),e=this.g.T(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},_.R=function(t){ln(this);var e=[];if("string"==typeof t)dn(this,t)&&(e=B(e,this.g.get(yn(this,t))));else{t=this.g.R();for(var n=0;n<t.length;n++)e=B(e,t[n])}return e},_.set=function(t,e){return ln(this),this.i=null,dn(this,t=yn(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},_.get=function(t,e){return t&&0<(t=this.R(t)).length?String(t[0]):e},_.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var t=[],e=this.g.T(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.R(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.i=t.join("&")};var gn=function(){return function(t,e){this.h=t,this.g=e}}();function vn(t){this.l=t||mn,t=D.PerformanceNavigationTiming?0<(t=D.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(D.g&&D.g.Ea&&D.g.Ea()&&D.g.Ea().Zb),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var mn=10;function bn(t){return!!t.h||!!t.g&&t.g.size>=t.j}function wn(t){return t.h?1:t.g?t.g.size:0}function In(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function Tn(t,e){t.g?t.g.add(e):t.h=e}function En(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function _n(t){var e,n;if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){var r=t.i;try{for(var i=E(t.g.values()),o=i.next();!o.done;o=i.next())r=r.concat(o.value.D)}catch(s){e={error:s}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}return K(t.i)}function On(){}function Sn(){this.g=new On}function Dn(t,e,n){var r=n||"";try{Be(t,(function(t,n){var i=t;j(t)&&(i=Ut(t)),e.push(r+n+"="+encodeURIComponent(i))}))}catch(Rd){throw e.push(r+"type="+encodeURIComponent("_badmap")),Rd}}function An(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(o){}}function Nn(t){this.l=t.$b||null,this.j=t.ib||!1}function jn(t,e){Ft.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=kn,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}vn.prototype.cancel=function(){var t,e;if(this.i=_n(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){try{for(var n=E(this.g.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(i){t={error:i}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.g.clear()}},On.prototype.stringify=function(t){return D.JSON.stringify(t,void 0)},On.prototype.parse=function(t){return D.JSON.parse(t,void 0)},F(Nn,be),Nn.prototype.g=function(){return new jn(this.l,this.j)},Nn.prototype.i=function(t){return function(){return t}}({}),F(jn,Ft);var kn=0;function Cn(t){t.j.read().then(t.Sa.bind(t)).catch(t.ha.bind(t))}function xn(t){t.readyState=4,t.l=null,t.j=null,t.A=null,Rn(t)}function Rn(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(_=jn.prototype).open=function(t,e){if(this.readyState!=kn)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,Rn(this)},_.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||D).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))},_.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,xn(this)),this.readyState=kn},_.Va=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,Rn(this)),this.g&&(this.readyState=3,Rn(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==D.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Cn(this)}else t.text().then(this.Ua.bind(this),this.ha.bind(this))},_.Sa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?xn(this):Rn(this),3==this.readyState&&Cn(this)}},_.Ua=function(t){this.g&&(this.response=this.responseText=t,xn(this))},_.Ta=function(t){this.g&&(this.response=t,xn(this))},_.ha=function(){this.g&&xn(this)},_.setRequestHeader=function(t,e){this.v.append(t,e)},_.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},_.getAllResponseHeaders=function(){if(!this.h)return"";for(var t=[],e=this.h.entries(),n=e.next();!n.done;)t.push((n=n.value)[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(jn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var Pn=D.JSON.parse;function Ln(t){Ft.call(this),this.headers=new Ke,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Fn,this.K=this.L=!1}F(Ln,Ft);var Fn="",Mn=/^https?$/i,qn=["POST","PUT"];function Un(t){return"content-type"==t.toLowerCase()}function Vn(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Bn(t),Gn(t)}function Bn(t){t.D||(t.D=!0,Mt(t,"complete"),Mt(t,"error"))}function Kn(t){if(t.h&&void 0!==S&&(!t.C[1]||4!=Qn(t)||2!=t.ba()))if(t.v&&4==Qn(t))Zt(t.Fa,0,t);else if(Mt(t,"readystatechange"),4==Qn(t)){t.h=!1;try{var e,n=t.ba();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.H).match(Qe)[1]||null;if(!o&&D.self&&D.self.location){var s=D.self.location.protocol;o=s.substr(0,s.length-1)}i=!Mn.test(o?o.toLowerCase():"")}e=i}if(e)Mt(t,"complete"),Mt(t,"success");else{t.m=6;try{var a=2<Qn(t)?t.g.statusText:""}catch(u){a=""}t.j=a+" ["+t.ba()+"]",Bn(t)}}finally{Gn(t)}}}function Gn(t,e){if(t.g){zn(t);var n=t.g,r=t.C[0]?A:null;t.g=null,t.C=null,e||Mt(t,"ready");try{n.onreadystatechange=r}catch(Rd){}}}function zn(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(D.clearTimeout(t.A),t.A=null)}function Qn(t){return t.g?t.g.readyState:0}function Hn(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case Fn:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Wn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=function(t){var e="";return $(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Ze(t,e,n))}function Yn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Xn(t){this.za=0,this.l=[],this.h=new se,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Yn("failFast",!1,t),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Yn("baseRetryDelayMs",5e3,t),this.$a=Yn("retryDelaySeedMs",1e4,t),this.Ya=Yn("forwardChannelMaxRetries",2,t),this.ra=Yn("forwardChannelRequestTimeoutMs",2e4,t),this.qa=t&&t.xmlHttpFactory||void 0,this.Ba=t&&t.Yb||!1,this.K=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.J="",this.i=new vn(t&&t.concurrentRequestLimit),this.Ca=new Sn,this.ja=t&&t.fastHandshake||!1,this.Ra=t&&t.Wb||!1,t&&t.Aa&&this.h.Aa(),t&&t.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&t&&t.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!t||!1!==t.Xb}function $n(t){if(Zn(t),3==t.G){var e=t.V++,n=We(t.F);Ze(n,"SID",t.J),Ze(n,"RID",e),Ze(n,"TYPE","terminate"),rr(t,n),(e=new Se(t,t.h,e,void 0)).K=2,e.v=tn(We(n)),n=!1,D.navigator&&D.navigator.sendBeacon&&(n=D.navigator.sendBeacon(e.v.toString(),"")),!n&&D.Image&&((new Image).src=e.v,n=!0),n||(e.g=yr(e.l,null),e.g.ea(e.v)),e.F=Date.now(),Le(e)}dr(t)}function Jn(t){t.g&&(ar(t),t.g.cancel(),t.g=null)}function Zn(t){Jn(t),t.u&&(D.clearTimeout(t.u),t.u=null),cr(t),t.i.cancel(),t.m&&("number"==typeof t.m&&D.clearTimeout(t.m),t.m=null)}function tr(t,e){t.l.push(new gn(t.Za++,e)),3==t.G&&er(t)}function er(t){bn(t.i)||t.m||(t.m=!0,Ht(t.Ha,t),t.C=0)}function nr(t,e){var n;n=e?e.m:t.V++;var r=We(t.F);Ze(r,"SID",t.J),Ze(r,"RID",n),Ze(r,"AID",t.U),rr(t,r),t.o&&t.s&&Wn(r,t.o,t.s),n=new Se(t,t.h,n,t.C+1),null===t.o&&(n.H=t.s),e&&(t.l=e.D.concat(t.l)),e=ir(t,n,1e3),n.setTimeout(Math.round(.5*t.ra)+Math.round(.5*t.ra*Math.random())),Tn(t.i,n),ke(n,r,e)}function rr(t,e){t.j&&Be({},(function(t,n){Ze(e,n,t)}))}function ir(t,e,n){n=Math.min(t.l.length,n);var r=t.j?P(t.j.Oa,t.j,t):null;t:for(var i=t.l,o=-1;;){var s=["count="+n];-1==o?0<n?s.push("ofs="+(o=i[0].h)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var c=i[u].h,h=i[u].g;if(0>(c-=o))o=Math.max(0,i[u].h-100),a=!1;else try{Dn(h,s,"req"+c+"_")}catch(Hr){r&&r(h)}}if(a){r=s.join("&");break t}}return t=t.l.splice(0,n),e.D=t,r}function or(t){t.g||t.u||(t.Y=1,Ht(t.Ga,t),t.A=0)}function sr(t){return!(t.g||t.u||3<=t.A||(t.Y++,t.u=ge(P(t.Ga,t),lr(t,t.A)),t.A++,0))}function ar(t){null!=t.B&&(D.clearTimeout(t.B),t.B=null)}function ur(t){t.g=new Se(t,t.h,"rpc",t.Y),null===t.o&&(t.g.H=t.s),t.g.O=0;var e=We(t.oa);Ze(e,"RID","rpc"),Ze(e,"SID",t.J),Ze(e,"CI",t.N?"0":"1"),Ze(e,"AID",t.U),rr(t,e),Ze(e,"TYPE","xmlhttp"),t.o&&t.s&&Wn(e,t.o,t.s),t.K&&t.g.setTimeout(t.K);var n=t.g;t=t.la,n.K=1,n.v=tn(We(e)),n.s=null,n.U=!0,Ce(n,t)}function cr(t){null!=t.v&&(D.clearTimeout(t.v),t.v=null)}function hr(t,e){var n=null;if(t.g==e){cr(t),ar(t),t.g=null;var r=2}else{if(!In(t.i,e))return;n=e.D,En(t.i,e),r=1}if(t.I=e.N,0!=t.G)if(e.i)if(1==r){n=e.s?e.s.length:0,e=Date.now()-e.F;var i=t.C;Mt(r=he(),new ye(r,n,e,i)),er(t)}else or(t);else if(3==(i=e.o)||0==i&&0<t.I||!(1==r&&function(t,e){return!(wn(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.l=e.D.concat(t.l),0):1==t.G||2==t.G||t.C>=(t.Xa?0:t.Ya)||(t.m=ge(P(t.Ha,t,e),lr(t,t.C)),t.C++,0)))}(t,e)||2==r&&sr(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),i){case 1:fr(t,5);break;case 4:fr(t,10);break;case 3:fr(t,6);break;default:fr(t,2)}}function lr(t,e){var n=t.Pa+Math.floor(Math.random()*t.$a);return t.j||(n*=2),n*e}function fr(t,e){if(t.h.info("Error code "+e),2==e){var n=null;t.j&&(n=null);var r=P(t.jb,t);n||(n=new He("//www.google.com/images/cleardot.gif"),D.location&&"http"==D.location.protocol||Ye(n,"https"),tn(n)),function(t,e){var n=new se;if(D.Image){var r=new Image;r.onload=L(An,n,r,"TestLoadImage: loaded",!0,e),r.onerror=L(An,n,r,"TestLoadImage: error",!1,e),r.onabort=L(An,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=L(An,n,r,"TestLoadImage: timeout",!1,e),D.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(n.toString(),r)}else pe(2);t.G=0,t.j&&t.j.va(e),dr(t),Zn(t)}function dr(t){t.G=0,t.I=-1,t.j&&(0==_n(t.i).length&&0==t.l.length||(t.i.i.length=0,K(t.l),t.l.length=0),t.j.ua())}function pr(t,e,n){var r=function(t){return t instanceof He?We(t):new He(t,void 0)}(n);if(""!=r.i)e&&Xe(r,e+"."+r.i),$e(r,r.m);else{var i=D.location;r=function(t,e,n,r){var i=new He(null,void 0);return t&&Ye(i,t),e&&Xe(i,e),n&&$e(i,n),r&&(i.l=r),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.aa&&$(t.aa,(function(t,e){Ze(r,e,t)})),n=t.sa,(e=t.D)&&n&&Ze(r,e,n),Ze(r,"VER",t.ma),rr(t,r),r}function yr(t,e,n){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Ln(n&&t.Ba&&!t.qa?new Nn({ib:!0}):t.qa)).L=t.H,e}function gr(){}function vr(){if(ot&&!(10<=Number(yt)))throw Error("Environmental error: no available transport.")}function mr(t,e){Ft.call(this),this.g=new Xn(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.P=t,(t=e&&e.httpHeadersOverwriteParam)&&!G(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!G(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new Ir(this)}function br(t){Ee.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function wr(){_e.call(this),this.status=1}function Ir(t){this.g=t}(_=Ln.prototype).ea=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():Ie.g(),this.C=function(t){return t.h||(t.h=t.i())}(this.u?this.u:Ie),this.g.onreadystatechange=P(this.Fa,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(o){return void Vn(this,o)}t=n||"";var i=new Ke(this.headers);r&&Be(r,(function(t,e){i.set(e,t)})),r=function(t){t:{for(var e=Un,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(i.T()),n=D.FormData&&t instanceof D.FormData,!(0<=U(qn,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach((function(t,e){this.g.setRequestHeader(e,t)}),this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{zn(this),0<this.B&&((this.K=function(t){return ot&&function(){return t=pt,Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=function(){for(var t=0,e=Q(String(nt)).split("."),n=Q("9").split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=W(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||W(0==o[2].length,0==s[2].length)||W(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t}();var t}()&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=P(this.pa,this)):this.A=Zt(this.pa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(o){Vn(this,o)}},_.pa=function(){void 0!==S&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Mt(this,"timeout"),this.abort(8))},_.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,Mt(this,"complete"),Mt(this,"abort"),Gn(this))},_.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Gn(this,!0)),Ln.Z.M.call(this)},_.Fa=function(){this.s||(this.F||this.v||this.l?Kn(this):this.cb())},_.cb=function(){Kn(this)},_.ba=function(){try{return 2<Qn(this)?this.g.status:-1}catch(rt){return-1}},_.ga=function(){try{return this.g?this.g.responseText:""}catch(rt){return""}},_.Qa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Pn(e)}},_.Da=function(){return this.m},_.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(_=Xn.prototype).ma=8,_.G=1,_.hb=function(t){try{this.h.info("Origin Trials invoked: "+t)}catch(e){}},_.Ha=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;var e=new Se(this,this.h,t,void 0),n=this.s;if(this.P&&(n?tt(n=J(n),this.P):n=this.P),null===this.o&&(e.H=n),this.ja)t:{for(var r=0,i=0;i<this.l.length;i++){var o=this.l[i];if(void 0===(o="__data__"in o.g&&"string"==typeof(o=o.g.__data__)?o.length:void 0))break;if(4096<(r+=o)){r=i;break t}if(4096===r||i===this.l.length-1){r=i+1;break t}}r=1e3}else r=1e3;r=ir(this,e,r),Ze(i=We(this.F),"RID",t),Ze(i,"CVER",22),this.D&&Ze(i,"X-HTTP-Session-Id",this.D),rr(this,i),this.o&&n&&Wn(i,this.o,n),Tn(this.i,e),this.Ra&&Ze(i,"TYPE","init"),this.ja?(Ze(i,"$req",r),Ze(i,"SID","null"),e.$=!0,ke(e,i,null)):ke(e,i,r),this.G=2}}else 3==this.G&&(t?nr(this,t):0==this.l.length||bn(this.i)||nr(this))},_.Ga=function(){if(this.u=null,ur(this),this.$&&!(this.L||null==this.g||0>=this.O)){var t=2*this.O;this.h.info("BP detection timer enabled: "+t),this.B=ge(P(this.bb,this),t)}},_.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,pe(10),Jn(this),ur(this))},_.ab=function(){null!=this.v&&(this.v=null,Jn(this),sr(this),pe(19))},_.jb=function(t){t?(this.h.info("Successfully pinged google.com"),pe(2)):(this.h.info("Failed to ping google.com"),pe(1))},(_=gr.prototype).xa=function(){},_.wa=function(){},_.va=function(){},_.ua=function(){},_.Oa=function(){},vr.prototype.g=function(t,e){return new mr(t,e)},F(mr,Ft),mr.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;t.Wa&&(t.h.info("Origin Trials enabled."),Ht(P(t.hb,t,e))),pe(0),t.W=e,t.aa=n||{},t.N=t.X,t.F=pr(t,null,t.W),er(t)},mr.prototype.close=function(){$n(this.g)},mr.prototype.u=function(t){if("string"==typeof t){var e={};e.__data__=t,tr(this.g,e)}else this.v?((e={}).__data__=Ut(t),tr(this.g,e)):tr(this.g,t)},mr.prototype.M=function(){this.g.j=null,delete this.j,$n(this.g),delete this.g,mr.Z.M.call(this)},F(br,Ee),F(wr,_e),F(Ir,gr),Ir.prototype.xa=function(){Mt(this.g,"a")},Ir.prototype.wa=function(t){Mt(this.g,new br(t))},Ir.prototype.va=function(t){Mt(this.g,new wr(t))},Ir.prototype.ua=function(){Mt(this.g,"b")},vr.prototype.createWebChannel=vr.prototype.g,mr.prototype.send=mr.prototype.u,mr.prototype.open=mr.prototype.m,mr.prototype.close=mr.prototype.close,ve.NO_ERROR=0,ve.TIMEOUT=8,ve.HTTP_ERROR=6,me.COMPLETE="complete",we.EventType=Te,Te.OPEN="a",Te.CLOSE="b",Te.ERROR="c",Te.MESSAGE="d",Ft.prototype.listen=Ft.prototype.N,Ln.prototype.listenOnce=Ln.prototype.O,Ln.prototype.getLastError=Ln.prototype.La,Ln.prototype.getLastErrorCode=Ln.prototype.Da,Ln.prototype.getStatus=Ln.prototype.ba,Ln.prototype.getResponseJson=Ln.prototype.Qa,Ln.prototype.getResponseText=Ln.prototype.ga,Ln.prototype.send=Ln.prototype.ea;var Tr=ve,Er=me,_r=ue,Or=Nn,Sr=we,Dr=Ln,Ar=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}return t.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},t}();Ar.o=-1;var Nr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},jr=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return Object(b.c)(e,t),e}(Error),kr=new I.b("@firebase/firestore");function Cr(){return kr.logLevel}function xr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(kr.logLevel<=I.a.DEBUG){var r=e.map(Lr);kr.debug.apply(kr,Object(b.f)(["Firestore (8.10.1): "+t],r))}}function Rr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(kr.logLevel<=I.a.ERROR){var r=e.map(Lr);kr.error.apply(kr,Object(b.f)(["Firestore (8.10.1): "+t],r))}}function Pr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(kr.logLevel<=I.a.WARN){var r=e.map(Lr);kr.warn.apply(kr,Object(b.f)(["Firestore (8.10.1): "+t],r))}}function Lr(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(Rd){return t}}function Fr(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (8.10.1) INTERNAL ASSERTION FAILED: "+t;throw Rr(e),new Error(e)}function Mr(t,e){t||Fr()}function qr(t,e){return t}function Ur(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var Vr=function(){function t(){}return t.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=Ur(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function Br(t,e){return t<e?-1:t>e?1:0}function Kr(t,e,n){return t.length===e.length&&t.every((function(t,r){return n(t,e[r])}))}function Gr(t){return t+"\0"}var zr=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new jr(Nr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new jr(Nr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new jr(Nr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new jr(Nr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,Math.floor(1e6*(e-1e3*n)))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?Br(this.nanoseconds,t.nanoseconds):Br(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),Qr=function(){function t(t){this.timestamp=t}return t.fromTimestamp=function(e){return new t(e)},t.min=function(){return new t(new zr(0,0))},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t}();function Hr(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Wr(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Yr(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var Xr=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&Fr(),void 0===n?n=t.length-e:n>t.length-e&&Fr(),this.segments=t,this.offset=e,this.len=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach((function(t){n.push(t)})):n.push(e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return this.construct(this.segments,this.offset+(t=void 0===t?1:t),this.length-t)},t.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),$r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(b.c)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=[],i=0,o=t;i<o.length;i++){var s=o[i];if(s.indexOf("//")>=0)throw new jr(Nr.INVALID_ARGUMENT,"Invalid segment ("+s+"). Paths must not contain // in them.");r.push.apply(r,s.split("/").filter((function(t){return t.length>0})))}return new e(r)},e.emptyPath=function(){return new e([])},e}(Xr),Jr=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Zr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(b.c)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.isValidIdentifier=function(t){return Jr.test(t)},e.prototype.canonicalString=function(){return this.toArray().map((function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t})).join(".")},e.prototype.toString=function(){return this.canonicalString()},e.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},e.keyField=function(){return new e(["__name__"])},e.fromServerFormat=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new jr(Nr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},s=!1;i<t.length;){var a=t[i];if("\\"===a){if(i+1===t.length)throw new jr(Nr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new jr(Nr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else"`"===a?(s=!s,i++):"."!==a||s?(r+=a,i++):(o(),i++)}if(o(),s)throw new jr(Nr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.emptyPath=function(){return new e([])},e}(Xr),ti=function(){function t(t){this.fields=t,t.sort(Zr.comparator)}return t.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},t.prototype.isEqual=function(t){return Kr(this.fields,t.fields,(function(t,e){return t.isEqual(e)}))},t}(),ei=function(){function t(t){this.binaryString=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return btoa(this.binaryString)},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},t.prototype.approximateByteSize=function(){return 2*this.binaryString.length},t.prototype.compareTo=function(t){return Br(this.binaryString,t.binaryString)},t.prototype.isEqual=function(t){return this.binaryString===t.binaryString},t}();ei.EMPTY_BYTE_STRING=new ei("");var ni=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ri(t){if(Mr(!!t),"string"==typeof t){var e=0,n=ni.exec(t);if(Mr(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:ii(t.seconds),nanos:ii(t.nanos)}}function ii(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function oi(t){return"string"==typeof t?ei.fromBase64String(t):ei.fromUint8Array(t)}function si(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function ai(t){var e=ri(t.mapValue.fields.__local_write_time__.timestampValue);return new zr(e.seconds,e.nanos)}function ui(t){return null==t}function ci(t){return 0===t&&1/t==-1/0}function hi(t){return"number"==typeof t&&Number.isInteger(t)&&!ci(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var li=function(){function t(t){this.path=t}return t.fromPath=function(e){return new t($r.fromString(e))},t.fromName=function(e){return new t($r.fromString(e).popFirst(5))},t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===$r.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return $r.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new $r(e.slice()))},t}();function fi(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?si(t)?4:10:Fr()}function di(t,e){var n=fi(t);if(n!==fi(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return ai(t).isEqual(ai(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=ri(t.timestampValue),r=ri(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return oi(t.bytesValue).isEqual(oi(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return ii(t.geoPointValue.latitude)===ii(e.geoPointValue.latitude)&&ii(t.geoPointValue.longitude)===ii(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return ii(t.integerValue)===ii(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=ii(t.doubleValue),r=ii(e.doubleValue);return n===r?ci(n)===ci(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return Kr(t.arrayValue.values||[],e.arrayValue.values||[],di);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(Hr(n)!==Hr(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!di(n[i],r[i])))return!1;return!0}(t,e);default:return Fr()}}function pi(t,e){return void 0!==(t.values||[]).find((function(t){return di(t,e)}))}function yi(t,e){var n=fi(t),r=fi(e);if(n!==r)return Br(n,r);switch(n){case 0:return 0;case 1:return Br(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=ii(t.integerValue||t.doubleValue),r=ii(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return gi(t.timestampValue,e.timestampValue);case 4:return gi(ai(t),ai(e));case 5:return Br(t.stringValue,e.stringValue);case 6:return function(t,e){var n=oi(t),r=oi(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Br(n[i],r[i]);if(0!==o)return o}return Br(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=Br(ii(t.latitude),ii(e.latitude));return 0!==n?n:Br(ii(t.longitude),ii(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=yi(n[i],r[i]);if(o)return o}return Br(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=Br(r[s],o[s]);if(0!==a)return a;var u=yi(n[r[s]],i[o[s]]);if(0!==u)return u}return Br(r.length,o.length)}(t.mapValue,e.mapValue);default:throw Fr()}}function gi(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Br(t,e);var n=ri(t),r=ri(e),i=Br(n.seconds,r.seconds);return 0!==i?i:Br(n.nanos,r.nanos)}function vi(t){return function t(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(t){var e=ri(t);return"time("+e.seconds+","+e.nanos+")"}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?oi(e.bytesValue).toBase64():"referenceValue"in e?li.fromName(e.referenceValue).toString():"geoPointValue"in e?"geo("+(n=e.geoPointValue).latitude+","+n.longitude+")":"arrayValue"in e?function(e){for(var n="[",r=!0,i=0,o=e.values||[];i<o.length;i++)r?r=!1:n+=",",n+=t(o[i]);return n+"]"}(e.arrayValue):"mapValue"in e?function(e){for(var n="{",r=!0,i=0,o=Object.keys(e.fields||{}).sort();i<o.length;i++){var s=o[i];r?r=!1:n+=",",n+=s+":"+t(e.fields[s])}return n+"}"}(e.mapValue):Fr();var n}(t)}function mi(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function bi(t){return!!t&&"integerValue"in t}function wi(t){return!!t&&"arrayValue"in t}function Ii(t){return!!t&&"nullValue"in t}function Ti(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Ei(t){return!!t&&"mapValue"in t}function _i(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){var e={mapValue:{fields:{}}};return Wr(t.mapValue.fields,(function(t,n){return e.mapValue.fields[t]=_i(n)})),e}if(t.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(t.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=_i(t.arrayValue.values[r]);return n}return Object.assign({},t)}var Oi=function(){function t(t){this.value=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(t){if(t.isEmpty())return this.value;for(var e=this.value,n=0;n<t.length-1;++n)if(!Ei(e=(e.mapValue.fields||{})[t.get(n)]))return null;return(e=(e.mapValue.fields||{})[t.lastSegment()])||null},t.prototype.set=function(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=_i(e)},t.prototype.setAll=function(t){var e=this,n=Zr.emptyPath(),r={},i=[];t.forEach((function(t,o){if(!n.isImmediateParentOf(o)){var s=e.getFieldsMap(n);e.applyChanges(s,r,i),r={},i=[],n=o.popLast()}t?r[o.lastSegment()]=_i(t):i.push(o.lastSegment())}));var o=this.getFieldsMap(n);this.applyChanges(o,r,i)},t.prototype.delete=function(t){var e=this.field(t.popLast());Ei(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]},t.prototype.isEqual=function(t){return di(this.value,t.value)},t.prototype.getFieldsMap=function(t){var e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(var n=0;n<t.length;++n){var r=e.mapValue.fields[t.get(n)];Ei(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields},t.prototype.applyChanges=function(t,e,n){Wr(e,(function(e,n){return t[e]=n}));for(var r=0,i=n;r<i.length;r++)delete t[i[r]]},t.prototype.clone=function(){return new t(_i(this.value))},t}();function Si(t){var e=[];return Wr(t.fields,(function(t,n){var r=new Zr([t]);if(Ei(n)){var i=Si(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++)e.push(r.child(s[o]))}else e.push(r)})),new ti(e)}var Di=function(){function t(t,e,n,r,i){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=i}return t.newInvalidDocument=function(e){return new t(e,0,Qr.min(),Oi.empty(),0)},t.newFoundDocument=function(e,n,r){return new t(e,1,n,r,0)},t.newNoDocument=function(e,n){return new t(e,2,n,Oi.empty(),0)},t.newUnknownDocument=function(e,n){return new t(e,3,n,Oi.empty(),2)},t.prototype.convertToFoundDocument=function(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this},t.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=Oi.empty(),this.documentState=0,this},t.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=Oi.empty(),this.documentState=2,this},t.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},t.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(t.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),t.prototype.isValidDocument=function(){return 0!==this.documentType},t.prototype.isFoundDocument=function(){return 1===this.documentType},t.prototype.isNoDocument=function(){return 2===this.documentType},t.prototype.isUnknownDocument=function(){return 3===this.documentType},t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)},t.prototype.clone=function(){return new t(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},t.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.value)+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},t}(),Ai=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};function Ni(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new Ai(t,e,n,r,i,o,s)}function ji(t){var e=qr(t);if(null===e.h){var n=e.path.canonicalString();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((function(t){return function(t){return t.field.canonicalString()+t.op.toString()+vi(t.value)}(t)})).join(","),n+="|ob:",n+=e.orderBy.map((function(t){return function(t){return t.field.canonicalString()+t.dir}(t)})).join(","),ui(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=Ki(e.startAt)),e.endAt&&(n+="|ub:",n+=Ki(e.endAt)),e.h=n}return e.h}function ki(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!zi(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if((i=t.filters[r]).op!==(o=e.filters[r]).op||!i.field.isEqual(o.field)||!di(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Hi(t.startAt,e.startAt)&&Hi(t.endAt,e.endAt)}function Ci(t){return li.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var xi=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return Object(b.c)(e,t),e.create=function(t,n,r){return t.isKeyField()?"in"===n||"not-in"===n?this.l(t,n,r):new Ri(t,n,r):"array-contains"===n?new Mi(t,r):"in"===n?new qi(t,r):"not-in"===n?new Ui(t,r):"array-contains-any"===n?new Vi(t,r):new e(t,n,r)},e.l=function(t,e,n){return"in"===e?new Pi(t,n):new Li(t,n)},e.prototype.matches=function(t){var e=t.data.field(this.field);return"!="===this.op?null!==e&&this.m(yi(e,this.value)):null!==e&&fi(this.value)===fi(e)&&this.m(yi(e,this.value))},e.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Fr()}},e.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},e}((function(){})),Ri=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=li.fromName(r.referenceValue),i}return Object(b.c)(e,t),e.prototype.matches=function(t){var e=li.comparator(t.key,this.key);return this.m(e)},e}(xi),Pi=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=Fi(0,n),r}return Object(b.c)(e,t),e.prototype.matches=function(t){return this.keys.some((function(e){return e.isEqual(t.key)}))},e}(xi),Li=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"not-in",n)||this).keys=Fi(0,n),r}return Object(b.c)(e,t),e.prototype.matches=function(t){return!this.keys.some((function(e){return e.isEqual(t.key)}))},e}(xi);function Fi(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((function(t){return li.fromName(t.referenceValue)}))}var Mi=function(t){function e(e,n){return t.call(this,e,"array-contains",n)||this}return Object(b.c)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return wi(e)&&pi(e.arrayValue,this.value)},e}(xi),qi=function(t){function e(e,n){return t.call(this,e,"in",n)||this}return Object(b.c)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return null!==e&&pi(this.value.arrayValue,e)},e}(xi),Ui=function(t){function e(e,n){return t.call(this,e,"not-in",n)||this}return Object(b.c)(e,t),e.prototype.matches=function(t){if(pi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.data.field(this.field);return null!==e&&!pi(this.value.arrayValue,e)},e}(xi),Vi=function(t){function e(e,n){return t.call(this,e,"array-contains-any",n)||this}return Object(b.c)(e,t),e.prototype.matches=function(t){var e=this,n=t.data.field(this.field);return!(!wi(n)||!n.arrayValue.values)&&n.arrayValue.values.some((function(t){return pi(e.value.arrayValue,t)}))},e}(xi),Bi=function(t,e){this.position=t,this.before=e};function Ki(t){return(t.before?"b":"a")+":"+t.position.map((function(t){return vi(t)})).join(",")}var Gi=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function zi(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function Qi(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.isKeyField()?li.comparator(li.fromName(s.referenceValue),n.key):yi(s,n.data.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function Hi(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!di(t.position[n],e.position[n]))return!1;return!0}var Wi=function(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null};function Yi(t,e,n,r,i,o,s,a){return new Wi(t,e,n,r,i,o,s,a)}function Xi(t){return new Wi(t)}function $i(t){return!ui(t.limit)&&"F"===t.limitType}function Ji(t){return!ui(t.limit)&&"L"===t.limitType}function Zi(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function to(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function eo(t){return null!==t.collectionGroup}function no(t){var e=qr(t);if(null===e.p){e.p=[];var n=to(e),r=Zi(e);if(null!==n&&null===r)n.isKeyField()||e.p.push(new Gi(n)),e.p.push(new Gi(Zr.keyField(),"asc"));else{for(var i=!1,o=0,s=e.explicitOrderBy;o<s.length;o++){var a=s[o];e.p.push(a),a.field.isKeyField()&&(i=!0)}if(!i){var u=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.p.push(new Gi(Zr.keyField(),u))}}}return e.p}function ro(t){var e=qr(t);if(!e.T)if("F"===e.limitType)e.T=Ni(e.path,e.collectionGroup,no(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=no(e);r<i.length;r++){var o=i[r];n.push(new Gi(o.field,"desc"===o.dir?"asc":"desc"))}var s=e.endAt?new Bi(e.endAt.position,!e.endAt.before):null,a=e.startAt?new Bi(e.startAt.position,!e.startAt.before):null;e.T=Ni(e.path,e.collectionGroup,n,e.filters,e.limit,s,a)}return e.T}function io(t,e,n){return new Wi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function oo(t,e){return ki(ro(t),ro(e))&&t.limitType===e.limitType}function so(t){return ji(ro(t))+"|lt:"+t.limitType}function ao(t){return"Query(target="+function(t){var e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: ["+t.filters.map((function(t){return(e=t).field.canonicalString()+" "+e.op+" "+vi(e.value);var e})).join(", ")+"]"),ui(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: ["+t.orderBy.map((function(t){return function(t){return t.field.canonicalString()+" ("+t.dir+")"}(t)})).join(", ")+"]"),t.startAt&&(e+=", startAt: "+Ki(t.startAt)),t.endAt&&(e+=", endAt: "+Ki(t.endAt)),"Target("+e+")"}(ro(t))+"; limitType="+t.limitType+")"}function uo(t,e){return e.isFoundDocument()&&function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):li.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(var n=0,r=t.explicitOrderBy;n<r.length;n++){var i=r[n];if(!i.field.isKeyField()&&null===e.data.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!Qi(t.startAt,no(t),e)||t.endAt&&Qi(t.endAt,no(t),e))}(t,e)}function co(t){return function(e,n){for(var r=!1,i=0,o=no(t);i<o.length;i++){var s=o[i],a=ho(s,e,n);if(0!==a)return a;r=r||s.field.isKeyField()}return 0}}function ho(t,e,n){var r=t.field.isKeyField()?li.comparator(e.key,n.key):function(t,e,n){var r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?yi(r,i):Fr()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Fr()}}function lo(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ci(e)?"-0":e}}function fo(t){return{integerValue:""+t}}function po(t,e){return hi(e)?fo(e):lo(t,e)}var yo=function(){this._=void 0};function go(t,e,n){return t instanceof bo?function(t,e){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof wo?Io(t,e):t instanceof To?Eo(t,e):function(t,e){var n=mo(t,e),r=Oo(n)+Oo(t.A);return bi(n)&&bi(t.A)?fo(r):lo(t.R,r)}(t,e)}function vo(t,e,n){return t instanceof wo?Io(t,e):t instanceof To?Eo(t,e):n}function mo(t,e){return t instanceof _o?bi(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}var bo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(b.c)(e,t),e}(yo),wo=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(b.c)(e,t),e}(yo);function Io(t,e){for(var n=So(e),r=function(t){n.some((function(e){return di(e,t)}))||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var To=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(b.c)(e,t),e}(yo);function Eo(t,e){for(var n=So(e),r=function(t){n=n.filter((function(e){return!di(e,t)}))},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var _o=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).R=e,r.A=n,r}return Object(b.c)(e,t),e}(yo);function Oo(t){return ii(t.integerValue||t.doubleValue)}function So(t){return wi(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var Do=function(t,e){this.field=t,this.transform=e},Ao=function(t,e){this.version=t,this.transformResults=e},No=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.none=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function jo(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}var ko=function(){};function Co(t,e,n){t instanceof Fo?function(t,e,n){var r=t.value.clone(),i=Uo(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof Mo?function(t,e,n){if(jo(t.precondition,e)){var r=Uo(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(qo(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else e.convertToUnknownDocument(n.version)}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function xo(t,e,n){t instanceof Fo?function(t,e,n){if(jo(t.precondition,e)){var r=t.value.clone(),i=Vo(t.fieldTransforms,n,e);r.setAll(i),e.convertToFoundDocument(Lo(e),r).setHasLocalMutations()}}(t,e,n):t instanceof Mo?function(t,e,n){if(jo(t.precondition,e)){var r=Vo(t.fieldTransforms,n,e),i=e.data;i.setAll(qo(t)),i.setAll(r),e.convertToFoundDocument(Lo(e),i).setHasLocalMutations()}}(t,e,n):function(t,e){jo(t.precondition,e)&&e.convertToNoDocument(Qr.min())}(t,e)}function Ro(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e.data.field(o.field),a=mo(o.transform,s||null);null!=a&&(null==n&&(n=Oi.empty()),n.set(o.field,a))}return n||null}function Po(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&Kr(t,e,(function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof wo&&e instanceof wo||t instanceof To&&e instanceof To?Kr(t.elements,e.elements,di):t instanceof _o&&e instanceof _o?di(t.A,e.A):t instanceof bo&&e instanceof bo}(t.transform,e.transform)}(t,e)}))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function Lo(t){return t.isFoundDocument()?t.version:Qr.min()}var Fo=function(t){function e(e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=t.call(this)||this).key=e,o.value=n,o.precondition=r,o.fieldTransforms=i,o.type=0,o}return Object(b.c)(e,t),e}(ko),Mo=function(t){function e(e,n,r,i,o){void 0===o&&(o=[]);var s=this;return(s=t.call(this)||this).key=e,s.data=n,s.fieldMask=r,s.precondition=i,s.fieldTransforms=o,s.type=1,s}return Object(b.c)(e,t),e}(ko);function qo(t){var e=new Map;return t.fieldMask.fields.forEach((function(n){if(!n.isEmpty()){var r=t.data.field(n);e.set(n,r)}})),e}function Uo(t,e,n){var r=new Map;Mr(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,a=e.data.field(o.field);r.set(o.field,vo(s,a,n[i]))}return r}function Vo(t,e,n){for(var r=new Map,i=0,o=t;i<o.length;i++){var s=o[i],a=s.transform,u=n.data.field(s.field);r.set(s.field,go(a,u,e))}return r}var Bo,Ko,Go=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=2,r.fieldTransforms=[],r}return Object(b.c)(e,t),e}(ko),zo=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=3,r.fieldTransforms=[],r}return Object(b.c)(e,t),e}(ko),Qo=function(t){this.count=t};function Ho(t){switch(t){case Nr.OK:return Fr();case Nr.CANCELLED:case Nr.UNKNOWN:case Nr.DEADLINE_EXCEEDED:case Nr.RESOURCE_EXHAUSTED:case Nr.INTERNAL:case Nr.UNAVAILABLE:case Nr.UNAUTHENTICATED:return!1;case Nr.INVALID_ARGUMENT:case Nr.NOT_FOUND:case Nr.ALREADY_EXISTS:case Nr.PERMISSION_DENIED:case Nr.FAILED_PRECONDITION:case Nr.ABORTED:case Nr.OUT_OF_RANGE:case Nr.UNIMPLEMENTED:case Nr.DATA_LOSS:return!0;default:return Fr()}}function Wo(t){if(void 0===t)return Rr("GRPC error has no .code"),Nr.UNKNOWN;switch(t){case Bo.OK:return Nr.OK;case Bo.CANCELLED:return Nr.CANCELLED;case Bo.UNKNOWN:return Nr.UNKNOWN;case Bo.DEADLINE_EXCEEDED:return Nr.DEADLINE_EXCEEDED;case Bo.RESOURCE_EXHAUSTED:return Nr.RESOURCE_EXHAUSTED;case Bo.INTERNAL:return Nr.INTERNAL;case Bo.UNAVAILABLE:return Nr.UNAVAILABLE;case Bo.UNAUTHENTICATED:return Nr.UNAUTHENTICATED;case Bo.INVALID_ARGUMENT:return Nr.INVALID_ARGUMENT;case Bo.NOT_FOUND:return Nr.NOT_FOUND;case Bo.ALREADY_EXISTS:return Nr.ALREADY_EXISTS;case Bo.PERMISSION_DENIED:return Nr.PERMISSION_DENIED;case Bo.FAILED_PRECONDITION:return Nr.FAILED_PRECONDITION;case Bo.ABORTED:return Nr.ABORTED;case Bo.OUT_OF_RANGE:return Nr.OUT_OF_RANGE;case Bo.UNIMPLEMENTED:return Nr.UNIMPLEMENTED;case Bo.DATA_LOSS:return Nr.DATA_LOSS;default:return Fr()}}(Ko=Bo||(Bo={}))[Ko.OK=0]="OK",Ko[Ko.CANCELLED=1]="CANCELLED",Ko[Ko.UNKNOWN=2]="UNKNOWN",Ko[Ko.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ko[Ko.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ko[Ko.NOT_FOUND=5]="NOT_FOUND",Ko[Ko.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ko[Ko.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ko[Ko.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ko[Ko.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ko[Ko.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ko[Ko.ABORTED=10]="ABORTED",Ko[Ko.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ko[Ko.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ko[Ko.INTERNAL=13]="INTERNAL",Ko[Ko.UNAVAILABLE=14]="UNAVAILABLE",Ko[Ko.DATA_LOSS=15]="DATA_LOSS";var Yo=function(){function t(t,e){this.comparator=t,this.root=e||$o.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,$o.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,$o.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal((function(e,n){return t(e,n),!1}))},t.prototype.toString=function(){var t=[];return this.inorderTraversal((function(e,n){return t.push(e+":"+n),!1})),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new Xo(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new Xo(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new Xo(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new Xo(this.root,t,this.comparator,!0)},t}(),Xo=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),$o=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Fr();if(this.right.isRed())throw Fr();var t=this.left.check();if(t!==this.right.check())throw Fr();return t+(this.isRed()?0:1)},t}();$o.EMPTY=null,$o.RED=!0,$o.BLACK=!1,$o.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw Fr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw Fr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw Fr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw Fr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw Fr()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new $o(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}());var Jo=function(){function t(t){this.comparator=t,this.data=new Yo(this.comparator)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal((function(e,n){return t(e),!1}))},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new Zo(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new Zo(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach((function(t){e=e.add(t)})),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach((function(e){t.push(e)})),t},t.prototype.toString=function(){var t=[];return this.forEach((function(e){return t.push(e)})),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),Zo=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),ts=new Yo(li.comparator);function es(){return ts}var ns=new Yo(li.comparator);function rs(){return ns}var is=new Yo(li.comparator);function os(){return is}var ss=new Jo(li.comparator);function as(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=ss,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var us=new Jo(Br);function cs(){return us}var hs=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r=new Map;return r.set(e,ls.createSynthesizedTargetChangeForCurrentChange(e,n)),new t(Qr.min(),r,cs(),es(),as())},t}(),ls=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(ei.EMPTY_BYTE_STRING,n,as(),as(),as())},t}(),fs=function(t,e,n,r){this.v=t,this.removedTargetIds=e,this.key=n,this.P=r},ds=function(t,e){this.targetId=t,this.V=e},ps=function(t,e,n,r){void 0===n&&(n=ei.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},ys=function(){function t(){this.S=0,this.D=ms(),this.C=ei.EMPTY_BYTE_STRING,this.N=!1,this.k=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"F",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"$",{get:function(){return this.k},enumerable:!1,configurable:!0}),t.prototype.O=function(t){t.approximateByteSize()>0&&(this.k=!0,this.C=t)},t.prototype.M=function(){var t=as(),e=as(),n=as();return this.D.forEach((function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:Fr()}})),new ls(this.C,this.N,t,e,n)},t.prototype.L=function(){this.k=!1,this.D=ms()},t.prototype.B=function(t,e){this.k=!0,this.D=this.D.insert(t,e)},t.prototype.q=function(t){this.k=!0,this.D=this.D.remove(t)},t.prototype.U=function(){this.S+=1},t.prototype.K=function(){this.S-=1},t.prototype.j=function(){this.k=!0,this.N=!0},t}(),gs=function(){function t(t){this.W=t,this.G=new Map,this.H=es(),this.J=vs(),this.Y=new Jo(Br)}return t.prototype.X=function(t){for(var e=0,n=t.v;e<n.length;e++){var r=n[e];t.P&&t.P.isFoundDocument()?this.Z(r,t.P):this.tt(r,t.key,t.P)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)this.tt(r=o[i],t.key,t.P)},t.prototype.et=function(t){var e=this;this.forEachTarget(t,(function(n){var r=e.nt(n);switch(t.state){case 0:e.st(n)&&r.O(t.resumeToken);break;case 1:r.K(),r.F||r.L(),r.O(t.resumeToken);break;case 2:r.K(),r.F||e.removeTarget(n);break;case 3:e.st(n)&&(r.j(),r.O(t.resumeToken));break;case 4:e.st(n)&&(e.it(n),r.O(t.resumeToken));break;default:Fr()}}))},t.prototype.forEachTarget=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.G.forEach((function(t,r){n.st(r)&&e(r)}))},t.prototype.rt=function(t){var e=t.targetId,n=t.V.count,r=this.ot(e);if(r){var i=r.target;if(Ci(i))if(0===n){var o=new li(i.path);this.tt(e,o,Di.newNoDocument(o,Qr.min()))}else Mr(1===n);else this.ct(e)!==n&&(this.it(e),this.Y=this.Y.add(e))}},t.prototype.ut=function(t){var e=this,n=new Map;this.G.forEach((function(r,i){var o=e.ot(i);if(o){if(r.current&&Ci(o.target)){var s=new li(o.target.path);null!==e.H.get(s)||e.at(i,s)||e.tt(i,s,Di.newNoDocument(s,t))}r.$&&(n.set(i,r.M()),r.L())}}));var r=as();this.J.forEach((function(t,n){var i=!0;n.forEachWhile((function(t){var n=e.ot(t);return!n||2===n.purpose||(i=!1,!1)})),i&&(r=r.add(t))}));var i=new hs(t,n,this.Y,this.H,r);return this.H=es(),this.J=vs(),this.Y=new Jo(Br),i},t.prototype.Z=function(t,e){if(this.st(t)){var n=this.at(t,e.key)?2:0;this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t))}},t.prototype.tt=function(t,e,n){if(this.st(t)){var r=this.nt(t);this.at(t,e)?r.B(e,1):r.q(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n))}},t.prototype.removeTarget=function(t){this.G.delete(t)},t.prototype.ct=function(t){var e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.U=function(t){this.nt(t).U()},t.prototype.nt=function(t){var e=this.G.get(t);return e||(e=new ys,this.G.set(t,e)),e},t.prototype.ht=function(t){var e=this.J.get(t);return e||(e=new Jo(Br),this.J=this.J.insert(t,e)),e},t.prototype.st=function(t){var e=null!==this.ot(t);return e||xr("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.ot=function(t){var e=this.G.get(t);return e&&e.F?null:this.W.lt(t)},t.prototype.it=function(t){var e=this;this.G.set(t,new ys),this.W.getRemoteKeysForTarget(t).forEach((function(n){e.tt(t,n,null)}))},t.prototype.at=function(t,e){return this.W.getRemoteKeysForTarget(t).has(e)},t}();function vs(){return new Yo(li.comparator)}function ms(){return new Yo(li.comparator)}var bs={asc:"ASCENDING",desc:"DESCENDING"},ws={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Is=function(t,e){this.databaseId=t,this.I=e};function Ts(t,e){return t.I?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function Es(t,e){return t.I?e.toBase64():e.toUint8Array()}function _s(t,e){return Ts(t,e.toTimestamp())}function Os(t){return Mr(!!t),Qr.fromTimestamp(function(t){var e=ri(t);return new zr(e.seconds,e.nanos)}(t))}function Ss(t,e){return function(t){return new $r(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function Ds(t){var e=$r.fromString(t);return Mr(Xs(e)),e}function As(t,e){return Ss(t.databaseId,e.path)}function Ns(t,e){var n=Ds(e);if(n.get(1)!==t.databaseId.projectId)throw new jr(Nr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new jr(Nr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new li(xs(n))}function js(t,e){return Ss(t.databaseId,e)}function ks(t){var e=Ds(t);return 4===e.length?$r.emptyPath():xs(e)}function Cs(t){return new $r(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function xs(t){return Mr(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function Rs(t,e,n){return{name:As(t,e),fields:n.value.mapValue.fields}}function Ps(t,e,n){var r=Ns(t,e.name),i=Os(e.updateTime),o=new Oi({mapValue:{fields:e.fields}}),s=Di.newFoundDocument(r,i,o);return n&&s.setHasCommittedMutations(),n?s.setHasCommittedMutations():s}function Ls(t,e){var n;if(e instanceof Fo)n={update:Rs(t,e.key,e.value)};else if(e instanceof Go)n={delete:As(t,e.key)};else if(e instanceof Mo)n={update:Rs(t,e.key,e.data),updateMask:Ys(e.fieldMask)};else{if(!(e instanceof zo))return Fr();n={verify:As(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((function(t){return function(t,e){var n=e.transform;if(n instanceof bo)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof wo)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof To)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof _o)return{fieldPath:e.field.canonicalString(),increment:n.A};throw Fr()}(0,t)}))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:_s(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:Fr()}(t,e.precondition)),n}function Fs(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?No.updateTime(Os(t.updateTime)):void 0!==t.exists?No.exists(t.exists):No.none()}(e.currentDocument):No.none(),r=e.updateTransforms?e.updateTransforms.map((function(e){return function(t,e){var n=null;"setToServerValue"in e?(Mr("REQUEST_TIME"===e.setToServerValue),n=new bo):"appendMissingElements"in e?n=new wo(e.appendMissingElements.values||[]):"removeAllFromArray"in e?n=new To(e.removeAllFromArray.values||[]):"increment"in e?n=new _o(t,e.increment):Fr();var r=Zr.fromServerFormat(e.fieldPath);return new Do(r,n)}(t,e)})):[];if(e.update){var i=Ns(t,e.update.name),o=new Oi({mapValue:{fields:e.update.fields}});if(e.updateMask){var s=function(t){return new ti((t.fieldPaths||[]).map((function(t){return Zr.fromServerFormat(t)})))}(e.updateMask);return new Mo(i,o,s,n,r)}return new Fo(i,o,n,r)}if(e.delete){var a=Ns(t,e.delete);return new Go(a,n)}if(e.verify){var u=Ns(t,e.verify);return new zo(u,n)}return Fr()}function Ms(t,e){return{documents:[js(t,e.path)]}}function qs(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=js(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=js(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(t){if(0!==t.length){var e=t.map((function(t){return function(t){if("=="===t.op){if(Ti(t.value))return{unaryFilter:{field:zs(t.field),op:"IS_NAN"}};if(Ii(t.value))return{unaryFilter:{field:zs(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Ti(t.value))return{unaryFilter:{field:zs(t.field),op:"IS_NOT_NAN"}};if(Ii(t.value))return{unaryFilter:{field:zs(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:zs(t.field),op:Gs(t.op),value:t.value}}}(t)}));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map((function(t){return function(t){return{field:zs(t.field),direction:Ks(t.dir)}}(t)}))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(t,e){return t.I||ui(e)?e:{value:e}}(t,e.limit);return null!==s&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt=Vs(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Vs(e.endAt)),n}function Us(t){var e=ks(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){Mr(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=function t(e){return e?void 0!==e.unaryFilter?[Ws(e)]:void 0!==e.fieldFilter?[Hs(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map((function(e){return t(e)})).reduce((function(t,e){return t.concat(e)})):Fr():[]}(n.where));var a=[];n.orderBy&&(a=n.orderBy.map((function(t){return function(t){return new Gi(Qs(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)})));var u=null;n.limit&&(u=function(t){var e;return ui(e="object"==typeof t?t.value:t)?null:e}(n.limit));var c=null;n.startAt&&(c=Bs(n.startAt));var h=null;return n.endAt&&(h=Bs(n.endAt)),Yi(e,i,a,s,u,"F",c,h)}function Vs(t){return{before:t.before,values:t.position}}function Bs(t){return new Bi(t.values||[],!!t.before)}function Ks(t){return bs[t]}function Gs(t){return ws[t]}function zs(t){return{fieldPath:t.canonicalString()}}function Qs(t){return Zr.fromServerFormat(t.fieldPath)}function Hs(t){return xi.create(Qs(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Fr()}}(t.fieldFilter.op),t.fieldFilter.value)}function Ws(t){switch(t.unaryFilter.op){case"IS_NAN":var e=Qs(t.unaryFilter.field);return xi.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=Qs(t.unaryFilter.field);return xi.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=Qs(t.unaryFilter.field);return xi.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=Qs(t.unaryFilter.field);return xi.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Fr()}}function Ys(t){var e=[];return t.fields.forEach((function(t){return e.push(t.canonicalString())})),{fieldPaths:e}}function Xs(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function $s(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=Zs(e)),e=Js(t.get(n),e);return Zs(e)}function Js(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=o}}return n}function Zs(t){return t+"\x01\x01"}function ta(t){var e=t.length;if(Mr(e>=2),2===e)return Mr("\x01"===t.charAt(0)&&"\x01"===t.charAt(1)),$r.emptyPath();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("\x01",o);switch((s<0||s>n)&&Fr(),t.charAt(s+1)){case"\x01":var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case"\x10":i+=t.substring(o,s),i+="\0";break;case"\x11":i+=t.substring(o,s+1);break;default:Fr()}o=s+2}return new $r(r)}var ea=function(t,e){this.seconds=t,this.nanoseconds=e},na=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};na.store="owner",na.key="owner";var ra=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};ra.store="mutationQueues",ra.keyPath="userId";var ia=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};ia.store="mutations",ia.keyPath="batchId",ia.userMutationsIndex="userMutationsIndex",ia.userMutationsKeyPath=["userId","batchId"];var oa=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,$s(e)]},t.key=function(t,e,n){return[t,$s(e),n]},t}();oa.store="documentMutations",oa.PLACEHOLDER=new oa;var sa=function(t,e){this.path=t,this.readTime=e},aa=function(t,e){this.path=t,this.version=e},ua=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};ua.store="remoteDocuments",ua.readTimeIndex="readTimeIndex",ua.readTimeIndexPath="readTime",ua.collectionReadTimeIndex="collectionReadTimeIndex",ua.collectionReadTimeIndexPath=["parentPath","readTime"];var ca=function(t){this.byteSize=t};ca.store="remoteDocumentGlobal",ca.key="remoteDocumentGlobalKey";var ha=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};ha.store="targets",ha.keyPath="targetId",ha.queryTargetsIndexName="queryTargetsIndex",ha.queryTargetsKeyPath=["canonicalId","targetId"];var la=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};la.store="targetDocuments",la.keyPath=["targetId","path"],la.documentTargetsIndex="documentTargetsIndex",la.documentTargetsKeyPath=["path","targetId"];var fa=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};fa.key="targetGlobalKey",fa.store="targetGlobal";var da=function(t,e){this.collectionId=t,this.parent=e};da.store="collectionParents",da.keyPath=["collectionId","parent"];var pa=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};pa.store="clientMetadata",pa.keyPath="clientId";var ya=function(t,e,n){this.bundleId=t,this.createTime=e,this.version=n};ya.store="bundles",ya.keyPath="bundleId";var ga=function(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n};ga.store="namedQueries",ga.keyPath="name";var va=Object(b.f)(Object(b.f)([],Object(b.f)(Object(b.f)([],Object(b.f)(Object(b.f)([],Object(b.f)(Object(b.f)([],[ra.store,ia.store,oa.store,ua.store,ha.store,na.store,fa.store,la.store]),[pa.store])),[ca.store])),[da.store])),[ya.store,ga.store]),ma="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",ba=function(){function t(){this.onCommittedListeners=[]}return t.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},t.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach((function(t){return t()}))},t}(),wa=function(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))},Ia=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)}),(function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)}))}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&Fr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t((function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}}))},t.prototype.toPromise=function(){var t=this;return new Promise((function(e,n){t.next(e,n)}))},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction((function(){return e(n)})):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction((function(){return e(n)})):t.reject(n)},t.resolve=function(e){return new t((function(t,n){t(e)}))},t.reject=function(e){return new t((function(t,n){n(e)}))},t.waitFor=function(e){return new t((function(t,n){var r=0,i=0,o=!1;e.forEach((function(e){++r,e.next((function(){++i,o&&i===r&&t()}),(function(t){return n(t)}))})),o=!0,i===r&&t()}))},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next((function(n){return n?t.resolve(n):e()}))},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach((function(t,i){r.push(e.call(n,t,i))})),this.waitFor(r)},t}(),Ta=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.ft=new wa,this.transaction.oncomplete=function(){n.ft.resolve()},this.transaction.onabort=function(){e.error?n.ft.reject(new Oa(t,e.error)):n.ft.resolve()},this.transaction.onerror=function(e){var r=ja(e.target.error);n.ft.reject(new Oa(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(e){throw new Oa(n,e)}},Object.defineProperty(t.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(xr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new Da(e)},t}(),Ea=function(){function t(e,n,r){this.name=e,this.version=n,this.wt=r,12.2===t._t(Object(w.o)())&&Rr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return t.delete=function(t){return xr("SimpleDb","Removing database:",t),Aa(window.indexedDB.deleteDatabase(t)).toPromise()},t.yt=function(){if("undefined"==typeof indexedDB)return!1;if(t.gt())return!0;var e=Object(w.o)(),n=t._t(e),r=0<n&&n<10,i=t.Et(e),o=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||o)},t.gt=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Tt)},t.It=function(t,e){return t.store(e)},t._t=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},t.Et=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},t.prototype.At=function(t){return Object(b.b)(this,void 0,void 0,(function(){var e,n=this;return Object(b.d)(this,(function(r){switch(r.label){case 0:return this.db?[3,2]:(xr("SimpleDb","Opening database:",this.name),e=this,[4,new Promise((function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){e(t.target.result)},i.onblocked=function(){r(new Oa(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;r("VersionError"===n.name?new jr(Nr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):new Oa(t,n))},i.onupgradeneeded=function(t){xr("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',t.oldVersion),n.wt.Rt(t.target.result,i.transaction,t.oldVersion,n.version).next((function(){xr("SimpleDb","Database upgrade to version "+n.version+" complete")}))}}))]);case 1:e.db=r.sent(),r.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(t){return n.bt(t)}),this.db)]}}))}))},t.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},t.prototype.runTransaction=function(t,e,n,r){return Object(b.b)(this,void 0,void 0,(function(){var i,o,s,a,u;return Object(b.d)(this,(function(c){switch(c.label){case 0:i="readonly"===e,o=0,s=function(){var e,s,u,c,h;return Object(b.d)(this,(function(l){switch(l.label){case 0:++o,l.label=1;case 1:return l.trys.push([1,4,,5]),[4,a.At(t)];case 2:return a.db=l.sent(),e=Ta.open(a.db,t,i?"readonly":"readwrite",n),s=r(e).catch((function(t){return e.abort(t),Ia.reject(t)})).toPromise(),u={},s.catch((function(){})),[4,e.dt];case 3:return[2,(u.value=(l.sent(),s),u)];case 4:return xr("SimpleDb","Transaction failed with error:",(c=l.sent()).message,"Retrying:",h="FirebaseError"!==c.name&&o<3),a.close(),h?[3,5]:[2,{value:Promise.reject(c)}];case 5:return[2]}}))},a=this,c.label=1;case 1:return[5,s()];case 2:if("object"==typeof(u=c.sent()))return[2,u.value];c.label=3;case 3:return[3,1];case 4:return[2]}}))}))},t.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},t}(),_a=function(){function t(t){this.Pt=t,this.Vt=!1,this.St=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.Vt=!0},t.prototype.Ct=function(t){this.St=t},t.prototype.delete=function(){return Aa(this.Pt.delete())},t}(),Oa=function(t){function e(e,n){var r=this;return(r=t.call(this,Nr.UNAVAILABLE,"IndexedDB transaction '"+e+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return Object(b.c)(e,t),e}(jr);function Sa(t){return"IndexedDbTransactionError"===t.name}var Da=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(xr("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(xr("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Aa(n)},t.prototype.add=function(t){return xr("SimpleDb","ADD",this.store.name,t,t),Aa(this.store.add(t))},t.prototype.get=function(t){var e=this;return Aa(this.store.get(t)).next((function(n){return void 0===n&&(n=null),xr("SimpleDb","GET",e.store.name,t,n),n}))},t.prototype.delete=function(t){return xr("SimpleDb","DELETE",this.store.name,t),Aa(this.store.delete(t))},t.prototype.count=function(){return xr("SimpleDb","COUNT",this.store.name),Aa(this.store.count())},t.prototype.Nt=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.xt(n,(function(t,e){r.push(e)})).next((function(){return r}))},t.prototype.kt=function(t,e){xr("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.Ft=!1;var r=this.cursor(n);return this.xt(r,(function(t,e,n){return n.delete()}))},t.prototype.$t=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.xt(r,e)},t.prototype.Ot=function(t){var e=this.cursor({});return new Ia((function(n,r){e.onerror=function(t){var e=ja(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next((function(t){t?r.continue():n()})):n()}}))},t.prototype.xt=function(t,e){var n=[];return new Ia((function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new _a(i),s=e(i.primaryKey,i.value,o);if(s instanceof Ia){var a=s.catch((function(t){return o.done(),Ia.reject(t)}));n.push(a)}o.isDone?r():null===o.Dt?i.continue():i.continue(o.Dt)}else r()}})).next((function(){return Ia.waitFor(n)}))},t.prototype.options=function(t,e){var n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.Ft?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function Aa(t){return new Ia((function(e,n){t.onsuccess=function(t){e(t.target.result)},t.onerror=function(t){var e=ja(t.target.error);n(e)}}))}var Na=!1;function ja(t){var e=Ea._t(Object(w.o)());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new jr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Na||(Na=!0,setTimeout((function(){throw r}),0)),r}}return t}var ka=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Mt=e,r.currentSequenceNumber=n,r}return Object(b.c)(e,t),e}(ba);function Ca(t,e){var n=qr(t);return Ea.It(n.Mt,e)}var xa=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}return t.prototype.applyToRemoteDocument=function(t,e){for(var n=e.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(t.key)&&Co(i,t,n[r])}},t.prototype.applyToLocalView=function(t){for(var e=0,n=this.baseMutations;e<n.length;e++)(o=n[e]).key.isEqual(t.key)&&xo(o,t,this.localWriteTime);for(var r=0,i=this.mutations;r<i.length;r++){var o;(o=i[r]).key.isEqual(t.key)&&xo(o,t,this.localWriteTime)}},t.prototype.applyToLocalDocumentSet=function(t){var e=this;this.mutations.forEach((function(n){var r=t.get(n.key),i=r;e.applyToLocalView(i),r.isValidDocument()||i.convertToNoDocument(Qr.min())}))},t.prototype.keys=function(){return this.mutations.reduce((function(t,e){return t.add(e.key)}),as())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&Kr(this.mutations,t.mutations,(function(t,e){return Po(t,e)}))&&Kr(this.baseMutations,t.baseMutations,(function(t,e){return Po(t,e)}))},t}(),Ra=function(){function t(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}return t.from=function(e,n,r){Mr(e.mutations.length===r.length);for(var i=os(),o=e.mutations,s=0;s<o.length;s++)i=i.insert(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),Pa=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=Qr.min()),void 0===o&&(o=Qr.min()),void 0===s&&(s=ei.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.withSequenceNumber=function(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.withResumeToken=function(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.withLastLimboFreeSnapshotVersion=function(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)},t}(),La=function(t){this.Lt=t};function Fa(t,e){if(e.document)return Ps(t.Lt,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=li.fromSegments(e.noDocument.path),r=Ba(e.noDocument.readTime),i=Di.newNoDocument(n,r);return e.hasCommittedMutations?i.setHasCommittedMutations():i}if(e.unknownDocument){var o=li.fromSegments(e.unknownDocument.path);return r=Ba(e.unknownDocument.version),Di.newUnknownDocument(o,r)}return Fr()}function Ma(t,e,n){var r=qa(n),i=e.key.path.popLast().toArray();if(e.isFoundDocument()){var o=function(t,e){return{name:As(t,e.key),fields:e.data.value.mapValue.fields,updateTime:Ts(t,e.version.toTimestamp())}}(t.Lt,e),s=e.hasCommittedMutations;return new ua(null,null,o,s,r,i)}if(e.isNoDocument()){var a=e.key.path.toArray(),u=Va(e.version);return s=e.hasCommittedMutations,new ua(null,new sa(a,u),null,s,r,i)}if(e.isUnknownDocument()){var c=e.key.path.toArray(),h=Va(e.version);return new ua(new aa(c,h),null,null,!0,r,i)}return Fr()}function qa(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function Ua(t){var e=new zr(t[0],t[1]);return Qr.fromTimestamp(e)}function Va(t){var e=t.toTimestamp();return new ea(e.seconds,e.nanoseconds)}function Ba(t){var e=new zr(t.seconds,t.nanoseconds);return Qr.fromTimestamp(e)}function Ka(t,e){for(var n=(e.baseMutations||[]).map((function(e){return Fs(t.Lt,e)})),r=0;r<e.mutations.length-1;++r)r+1<e.mutations.length&&void 0!==e.mutations[r+1].transform&&(e.mutations[r].updateTransforms=e.mutations[r+1].transform.fieldTransforms,e.mutations.splice(r+1,1),++r);var i=e.mutations.map((function(e){return Fs(t.Lt,e)})),o=zr.fromMillis(e.localWriteTimeMs);return new xa(e.batchId,o,n,i)}function Ga(t){var e,n,r=Ba(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?Ba(t.lastLimboFreeSnapshotVersion):Qr.min();return void 0!==t.query.documents?(Mr(1===(n=t.query).documents.length),e=ro(Xi(ks(n.documents[0])))):e=function(t){return ro(Us(t))}(t.query),new Pa(e,t.targetId,0,t.lastListenSequenceNumber,r,i,ei.fromBase64String(t.resumeToken))}function za(t,e){var n,r=Va(e.snapshotVersion),i=Va(e.lastLimboFreeSnapshotVersion);n=Ci(e.target)?Ms(t.Lt,e.target):qs(t.Lt,e.target);var o=e.resumeToken.toBase64();return new ha(e.targetId,ji(e.target),r,o,e.sequenceNumber,i,n)}function Qa(t){var e=Us({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?io(e,e.limit,"L"):e}var Ha=function(){function t(){}return t.prototype.getBundleMetadata=function(t,e){return Wa(t).get(e).next((function(t){if(t)return{id:(e=t).bundleId,createTime:Ba(e.createTime),version:e.version};var e}))},t.prototype.saveBundleMetadata=function(t,e){return Wa(t).put({bundleId:(n=e).id,createTime:Va(Os(n.createTime)),version:n.version});var n},t.prototype.getNamedQuery=function(t,e){return Ya(t).get(e).next((function(t){if(t)return{name:(e=t).name,query:Qa(e.bundledQuery),readTime:Ba(e.readTime)};var e}))},t.prototype.saveNamedQuery=function(t,e){return Ya(t).put(function(t){return{name:t.name,readTime:Va(Os(t.readTime)),bundledQuery:t.bundledQuery}}(e))},t}();function Wa(t){return Ca(t,ya.store)}function Ya(t){return Ca(t,ga.store)}var Xa=function(){function t(){this.Bt=new $a}return t.prototype.addToCollectionParentIndex=function(t,e){return this.Bt.add(e),Ia.resolve()},t.prototype.getCollectionParents=function(t,e){return Ia.resolve(this.Bt.getEntries(e))},t}(),$a=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Jo($r.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new Jo($r.comparator)).toArray()},t}(),Ja=function(){function t(){this.qt=new $a}return t.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(!this.qt.has(e)){var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener((function(){n.qt.add(e)}));var o={collectionId:r,parent:$s(i)};return Za(t).put(o)}return Ia.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[Gr(e),""],!1,!0);return Za(t).Nt(r).next((function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(ta(o.parent))}return n}))},t}();function Za(t){return Ca(t,da.store)}var tu={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},eu=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t}();function nu(t,e,n){var r=t.store(ia.store),i=t.store(oa.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,u=r.$t({range:s},(function(t,e,n){return a++,n.delete()}));o.push(u.next((function(){Mr(1===a)})));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],d=oa.key(e,f.key.path,n.batchId);o.push(i.delete(d)),c.push(f.key)}return Ia.waitFor(o).next((function(){return c}))}function ru(t){if(!t)return 0;var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Fr();e=t.noDocument}return JSON.stringify(e).length}eu.DEFAULT_COLLECTION_PERCENTILE=10,eu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,eu.DEFAULT=new eu(41943040,eu.DEFAULT_COLLECTION_PERCENTILE,eu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),eu.DISABLED=new eu(-1,0,0);var iu=function(){function t(t,e,n,r){this.userId=t,this.R=e,this.Ut=n,this.referenceDelegate=r,this.Kt={}}return t.Qt=function(e,n,r,i){return Mr(""!==e.uid),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return su(t).$t({index:ia.userMutationsIndex,range:n},(function(t,n,r){e=!1,r.done()})).next((function(){return e}))},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=au(t),s=su(t);return s.add({}).next((function(a){Mr("number"==typeof a);for(var u=new xa(a,e,n,r),c=function(t,e,n){var r=n.baseMutations.map((function(e){return Ls(t.Lt,e)})),i=n.mutations.map((function(e){return Ls(t.Lt,e)}));return new ia(e,n.batchId,n.localWriteTime.toMillis(),r,i)}(i.R,i.userId,u),h=[],l=new Jo((function(t,e){return Br(t.canonicalString(),e.canonicalString())})),f=0,d=r;f<d.length;f++){var p=d[f],y=oa.key(i.userId,p.key.path,a);l=l.add(p.key.path.popLast()),h.push(s.put(c)),h.push(o.put(y,oa.PLACEHOLDER))}return l.forEach((function(e){h.push(i.Ut.addToCollectionParentIndex(t,e))})),t.addOnCommittedListener((function(){i.Kt[a]=u.keys()})),Ia.waitFor(h).next((function(){return u}))}))},t.prototype.lookupMutationBatch=function(t,e){var n=this;return su(t).get(e).next((function(t){return t?(Mr(t.userId===n.userId),Ka(n.R,t)):null}))},t.prototype.jt=function(t,e){var n=this;return this.Kt[e]?Ia.resolve(this.Kt[e]):this.lookupMutationBatch(t,e).next((function(t){if(t){var r=t.keys();return n.Kt[e]=r,r}return null}))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return su(t).$t({index:ia.userMutationsIndex,range:i},(function(t,e,i){e.userId===n.userId&&(Mr(e.batchId>=r),o=Ka(n.R,e)),i.done()})).next((function(){return o}))},t.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return su(t).$t({index:ia.userMutationsIndex,range:e,reverse:!0},(function(t,e,r){n=e.batchId,r.done()})).next((function(){return n}))},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return su(t).Nt(ia.userMutationsIndex,n).next((function(t){return t.map((function(t){return Ka(e.R,t)}))}))},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=oa.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return au(t).$t({range:i},(function(r,i,s){var a=r[0],u=r[2],c=ta(r[1]);if(a===n.userId&&e.path.isEqual(c))return su(t).get(u).next((function(t){if(!t)throw Fr();Mr(t.userId===n.userId),o.push(Ka(n.R,t))}));s.done()})).next((function(){return o}))},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Jo(Br),i=[];return e.forEach((function(e){var o=oa.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),a=au(t).$t({range:s},(function(t,i,o){var s=t[0],a=t[2],u=ta(t[1]);s===n.userId&&e.path.isEqual(u)?r=r.add(a):o.done()}));i.push(a)})),Ia.waitFor(i).next((function(){return n.Wt(t,r)}))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this,r=e.path,i=r.length+1,o=oa.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),a=new Jo(Br);return au(t).$t({range:s},(function(t,e,o){var s=t[0],u=t[2],c=ta(t[1]);s===n.userId&&r.isPrefixOf(c)?c.length===i&&(a=a.add(u)):o.done()})).next((function(){return n.Wt(t,a)}))},t.prototype.Wt=function(t,e){var n=this,r=[],i=[];return e.forEach((function(e){i.push(su(t).get(e).next((function(t){if(null===t)throw Fr();Mr(t.userId===n.userId),r.push(Ka(n.R,t))})))})),Ia.waitFor(i).next((function(){return r}))},t.prototype.removeMutationBatch=function(t,e){var n=this;return nu(t.Mt,this.userId,e).next((function(r){return t.addOnCommittedListener((function(){n.Gt(e.batchId)})),Ia.forEach(r,(function(e){return n.referenceDelegate.markPotentiallyOrphaned(t,e)}))}))},t.prototype.Gt=function(t){delete this.Kt[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next((function(n){if(!n)return Ia.resolve();var r=IDBKeyRange.lowerBound(oa.prefixForUser(e.userId)),i=[];return au(t).$t({range:r},(function(t,n,r){if(t[0]===e.userId){var o=ta(t[1]);i.push(o)}else r.done()})).next((function(){Mr(0===i.length)}))}))},t.prototype.containsKey=function(t,e){return ou(t,this.userId,e)},t.prototype.zt=function(t){var e=this;return uu(t).get(this.userId).next((function(t){return t||new ra(e.userId,-1,"")}))},t}();function ou(t,e,n){var r=oa.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return au(t).$t({range:o,Ft:!0},(function(t,n,r){t[0]===e&&t[1]===i&&(s=!0),r.done()})).next((function(){return s}))}function su(t){return Ca(t,ia.store)}function au(t){return Ca(t,oa.store)}function uu(t){return Ca(t,ra.store)}var cu=function(){function t(t){this.Ht=t}return t.prototype.next=function(){return this.Ht+=2,this.Ht},t.Jt=function(){return new t(0)},t.Yt=function(){return new t(-1)},t}(),hu=function(){function t(t,e){this.referenceDelegate=t,this.R=e}return t.prototype.allocateTargetId=function(t){var e=this;return this.Xt(t).next((function(n){var r=new cu(n.highestTargetId);return n.highestTargetId=r.next(),e.Zt(t,n).next((function(){return n.highestTargetId}))}))},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next((function(t){return Qr.fromTimestamp(new zr(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))}))},t.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next((function(t){return t.highestListenSequenceNumber}))},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.Xt(t).next((function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Zt(t,i)}))},t.prototype.addTargetData=function(t,e){var n=this;return this.te(t,e).next((function(){return n.Xt(t).next((function(r){return r.targetCount+=1,n.ee(e,r),n.Zt(t,r)}))}))},t.prototype.updateTargetData=function(t,e){return this.te(t,e)},t.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next((function(){return lu(t).delete(e.targetId)})).next((function(){return n.Xt(t)})).next((function(e){return Mr(e.targetCount>0),e.targetCount-=1,n.Zt(t,e)}))},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return lu(t).$t((function(s,a){var u=Ga(a);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(i++,o.push(r.removeTargetData(t,u)))})).next((function(){return Ia.waitFor(o)})).next((function(){return i}))},t.prototype.forEachTarget=function(t,e){return lu(t).$t((function(t,n){var r=Ga(n);e(r)}))},t.prototype.Xt=function(t){return fu(t).get(fa.key).next((function(t){return Mr(null!==t),t}))},t.prototype.Zt=function(t,e){return fu(t).put(fa.key,e)},t.prototype.te=function(t,e){return lu(t).put(za(this.R,e))},t.prototype.ee=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getTargetCount=function(t){return this.Xt(t).next((function(t){return t.targetCount}))},t.prototype.getTargetData=function(t,e){var n=ji(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return lu(t).$t({range:r,index:ha.queryTargetsIndexName},(function(t,n,r){var o=Ga(n);ki(e,o.target)&&(i=o,r.done())})).next((function(){return i}))},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=du(t);return e.forEach((function(e){var s=$s(e.path);i.push(o.put(new la(n,s))),i.push(r.referenceDelegate.addReference(t,n,e))})),Ia.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=du(t);return Ia.forEach(e,(function(e){var o=$s(e.path);return Ia.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,n,e)])}))},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=du(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=du(t),i=as();return r.$t({range:n,Ft:!0},(function(t,e,n){var r=ta(t[1]),o=new li(r);i=i.add(o)})).next((function(){return i}))},t.prototype.containsKey=function(t,e){var n=$s(e.path),r=IDBKeyRange.bound([n],[Gr(n)],!1,!0),i=0;return du(t).$t({index:la.documentTargetsIndex,Ft:!0,range:r},(function(t,e,n){0!==t[0]&&(i++,n.done())})).next((function(){return i>0}))},t.prototype.lt=function(t,e){return lu(t).get(e).next((function(t){return t?Ga(t):null}))},t}();function lu(t){return Ca(t,ha.store)}function fu(t){return Ca(t,fa.store)}function du(t){return Ca(t,la.store)}function pu(t){return Object(b.b)(this,void 0,void 0,(function(){return Object(b.d)(this,(function(e){if(t.code!==Nr.FAILED_PRECONDITION||t.message!==ma)throw t;return xr("LocalStore","Unexpectedly lost primary lease"),[2]}))}))}function yu(t,e){var n=t[1],r=e[1],i=Br(t[0],e[0]);return 0===i?Br(n,r):i}var gu=function(){function t(t){this.ne=t,this.buffer=new Jo(yu),this.se=0}return t.prototype.ie=function(){return++this.se},t.prototype.re=function(t){var e=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();yu(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),vu=function(){function t(t,e){this.garbageCollector=t,this.asyncQueue=e,this.oe=!1,this.ce=null}return t.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ue(t)},t.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.ce},enumerable:!1,configurable:!0}),t.prototype.ue=function(t){var e=this,n=this.oe?3e5:6e4;xr("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,(function(){return Object(b.b)(e,void 0,void 0,(function(){var e;return Object(b.d)(this,(function(n){switch(n.label){case 0:this.ce=null,this.oe=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return n.sent(),[3,7];case 3:return Sa(e=n.sent())?(xr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,pu(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.ue(t)];case 8:return n.sent(),[2]}}))}))}))},t}(),mu=function(){function t(t,e){this.ae=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.ae.he(t).next((function(t){return Math.floor(e/100*t)}))},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return Ia.resolve(Ar.o);var r=new gu(e);return this.ae.forEachTarget(t,(function(t){return r.re(t.sequenceNumber)})).next((function(){return n.ae.le(t,(function(t){return r.re(t)}))})).next((function(){return r.maxValue}))},t.prototype.removeTargets=function(t,e,n){return this.ae.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.ae.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(xr("LruGarbageCollector","Garbage collection skipped; disabled"),Ia.resolve(tu)):this.getCacheSize(t).next((function(r){return r<n.params.cacheSizeCollectionThreshold?(xr("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),tu):n.fe(t,e)}))},t.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},t.prototype.fe=function(t,e){var n,r,i,o,s,a,u,c=this,h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((function(e){return e>c.params.maximumSequenceNumbersToCollect?(xr("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.maximumSequenceNumbersToCollect+" from "+e),r=c.params.maximumSequenceNumbersToCollect):r=e,o=Date.now(),c.nthSequenceNumber(t,r)})).next((function(r){return n=r,s=Date.now(),c.removeTargets(t,n,e)})).next((function(e){return i=e,a=Date.now(),c.removeOrphanedDocuments(t,n)})).next((function(t){return u=Date.now(),Cr()<=I.a.DEBUG&&xr("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-h)+"ms\n\tDetermined least recently used "+r+" in "+(s-o)+"ms\n\tRemoved "+i+" targets in "+(a-s)+"ms\n\tRemoved "+t+" documents in "+(u-a)+"ms\nTotal Duration: "+(u-h)+"ms"),Ia.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})}))},t}(),bu=function(){function t(t,e){this.db=t,this.garbageCollector=function(t,e){return new mu(t,e)}(this,e)}return t.prototype.he=function(t){var e=this.de(t);return this.db.getTargetCache().getTargetCount(t).next((function(t){return e.next((function(e){return t+e}))}))},t.prototype.de=function(t){var e=0;return this.le(t,(function(t){e++})).next((function(){return e}))},t.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},t.prototype.le=function(t,e){return this.we(t,(function(t,n){return e(n)}))},t.prototype.addReference=function(t,e,n){return wu(t,n)},t.prototype.removeReference=function(t,e,n){return wu(t,n)},t.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},t.prototype.markPotentiallyOrphaned=function(t,e){return wu(t,e)},t.prototype._e=function(t,e){return function(t,e){var n=!1;return uu(t).Ot((function(r){return ou(t,r,e).next((function(t){return t&&(n=!0),Ia.resolve(!t)}))})).next((function(){return n}))}(t,e)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.we(t,(function(s,a){if(a<=e){var u=n._e(t,s).next((function(e){if(!e)return o++,r.getEntry(t,s).next((function(){return r.removeEntry(s),du(t).delete([0,$s(s.path)])}))}));i.push(u)}})).next((function(){return Ia.waitFor(i)})).next((function(){return r.apply(t)})).next((function(){return o}))},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},t.prototype.updateLimboDocument=function(t,e){return wu(t,e)},t.prototype.we=function(t,e){var n,r=du(t),i=Ar.o;return r.$t({index:la.documentTargetsIndex},(function(t,r){var o=r.path,s=r.sequenceNumber;0===t[0]?(i!==Ar.o&&e(new li(ta(n)),i),i=s,n=o):i=Ar.o})).next((function(){i!==Ar.o&&e(new li(ta(n)),i)}))},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function wu(t,e){return du(t).put(function(t,e){return new la(0,$s(t.path),e)}(e,t.currentSequenceNumber))}var Iu=function(){function t(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[1];if(this.equalsFn(o[0],t))return s}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){Wr(this.inner,(function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];t(o[0],o[1])}}))},t.prototype.isEmpty=function(){return Yr(this.inner)},t}(),Tu=function(){function t(){this.changes=new Iu((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),this.changesApplied=!1}return t.prototype.getReadTime=function(t){var e=this.changes.get(t);return e?e.readTime:Qr.min()},t.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})},t.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{document:Di.newInvalidDocument(t),readTime:e})},t.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?Ia.resolve(n.document):this.getFromCache(t,e)},t.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},t.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},t.prototype.assertNotApplied=function(){},t}(),Eu=function(){function t(t,e){this.R=t,this.Ut=e}return t.prototype.addEntry=function(t,e,n){return Su(t).put(Du(e),n)},t.prototype.removeEntry=function(t,e){var n=Su(t),r=Du(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next((function(r){return r.byteSize+=e,n.me(t,r)}))},t.prototype.getEntry=function(t,e){var n=this;return Su(t).get(Du(e)).next((function(t){return n.ye(e,t)}))},t.prototype.ge=function(t,e){var n=this;return Su(t).get(Du(e)).next((function(t){return{document:n.ye(e,t),size:ru(t)}}))},t.prototype.getEntries=function(t,e){var n=this,r=es();return this.pe(t,e,(function(t,e){var i=n.ye(t,e);r=r.insert(t,i)})).next((function(){return r}))},t.prototype.Ee=function(t,e){var n=this,r=es(),i=new Yo(li.comparator);return this.pe(t,e,(function(t,e){var o=n.ye(t,e);r=r.insert(t,o),i=i.insert(t,ru(e))})).next((function(){return{documents:r,Te:i}}))},t.prototype.pe=function(t,e,n){if(e.isEmpty())return Ia.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return Su(t).$t({range:r},(function(t,e,r){for(var s=li.fromSegments(t);o&&li.comparator(o,s)<0;)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.Ct(o.path.toArray()):r.done()})).next((function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null}))},t.prototype.getDocumentsMatchingQuery=function(t,e,n){var r=this,i=es(),o=e.path.length+1,s={};if(n.isEqual(Qr.min())){var a=e.path.toArray();s.range=IDBKeyRange.lowerBound(a)}else{var u=e.path.toArray(),c=qa(n);s.range=IDBKeyRange.lowerBound([u,c],!0),s.index=ua.collectionReadTimeIndex}return Su(t).$t(s,(function(t,n,s){if(t.length===o){var a=Fa(r.R,n);e.path.isPrefixOf(a.key.path)?uo(e,a)&&(i=i.insert(a.key,a)):s.done()}})).next((function(){return i}))},t.prototype.newChangeBuffer=function(t){return new _u(this,!!t&&t.trackRemovals)},t.prototype.getSize=function(t){return this.getMetadata(t).next((function(t){return t.byteSize}))},t.prototype.getMetadata=function(t){return Ou(t).get(ca.key).next((function(t){return Mr(!!t),t}))},t.prototype.me=function(t,e){return Ou(t).put(ca.key,e)},t.prototype.ye=function(t,e){if(e){var n=Fa(this.R,e);if(!n.isNoDocument()||!n.version.isEqual(Qr.min()))return n}return Di.newInvalidDocument(t)},t}(),_u=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Ie=e,r.trackRemovals=n,r.Ae=new Iu((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),r}return Object(b.c)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=new Jo((function(t,e){return Br(t.canonicalString(),e.canonicalString())}));return this.changes.forEach((function(o,s){var a=e.Ae.get(o);if(s.document.isValidDocument()){var u=Ma(e.Ie.R,s.document,e.getReadTime(o));i=i.add(o.path.popLast());var c=ru(u);r+=c-a,n.push(e.Ie.addEntry(t,o,u))}else if(r-=a,e.trackRemovals){var h=Ma(e.Ie.R,Di.newNoDocument(o,Qr.min()),e.getReadTime(o));n.push(e.Ie.addEntry(t,o,h))}else n.push(e.Ie.removeEntry(t,o))})),i.forEach((function(r){n.push(e.Ie.Ut.addToCollectionParentIndex(t,r))})),n.push(this.Ie.updateMetadata(t,r)),Ia.waitFor(n)},e.prototype.getFromCache=function(t,e){var n=this;return this.Ie.ge(t,e).next((function(t){return n.Ae.set(e,t.size),t.document}))},e.prototype.getAllFromCache=function(t,e){var n=this;return this.Ie.Ee(t,e).next((function(t){var e=t.documents;return t.Te.forEach((function(t,e){n.Ae.set(t,e)})),e}))},e}(Tu);function Ou(t){return Ca(t,ca.store)}function Su(t){return Ca(t,ua.store)}function Du(t){return t.path.toArray()}var Au=function(){function t(t){this.R=t}return t.prototype.Rt=function(t,e,n,r){var i=this;Mr(n<r&&n>=0&&r<=11);var o=new Ta("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(na.store)}(t),function(t){t.createObjectStore(ra.store,{keyPath:ra.keyPath}),t.createObjectStore(ia.store,{keyPath:ia.keyPath,autoIncrement:!0}).createIndex(ia.userMutationsIndex,ia.userMutationsKeyPath,{unique:!0}),t.createObjectStore(oa.store)}(t),Nu(t),function(t){t.createObjectStore(ua.store)}(t));var s=Ia.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(la.store),t.deleteObjectStore(ha.store),t.deleteObjectStore(fa.store)}(t),Nu(t)),s=s.next((function(){return function(t){var e=t.store(fa.store),n=new fa(0,0,Qr.min().toTimestamp(),0);return e.put(fa.key,n)}(o)}))),n<4&&r>=4&&(0!==n&&(s=s.next((function(){return function(t,e){return e.store(ia.store).Nt().next((function(n){t.deleteObjectStore(ia.store),t.createObjectStore(ia.store,{keyPath:ia.keyPath,autoIncrement:!0}).createIndex(ia.userMutationsIndex,ia.userMutationsKeyPath,{unique:!0});var r=e.store(ia.store),i=n.map((function(t){return r.put(t)}));return Ia.waitFor(i)}))}(t,o)}))),s=s.next((function(){!function(t){t.createObjectStore(pa.store,{keyPath:pa.keyPath})}(t)}))),n<5&&r>=5&&(s=s.next((function(){return i.Re(o)}))),n<6&&r>=6&&(s=s.next((function(){return function(t){t.createObjectStore(ca.store)}(t),i.be(o)}))),n<7&&r>=7&&(s=s.next((function(){return i.ve(o)}))),n<8&&r>=8&&(s=s.next((function(){return i.Pe(t,o)}))),n<9&&r>=9&&(s=s.next((function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(ua.store);e.createIndex(ua.readTimeIndex,ua.readTimeIndexPath,{unique:!1}),e.createIndex(ua.collectionReadTimeIndex,ua.collectionReadTimeIndexPath,{unique:!1})}(e)}))),n<10&&r>=10&&(s=s.next((function(){return i.Ve(o)}))),n<11&&r>=11&&(s=s.next((function(){!function(t){t.createObjectStore(ya.store,{keyPath:ya.keyPath})}(t),function(t){t.createObjectStore(ga.store,{keyPath:ga.keyPath})}(t)}))),s},t.prototype.be=function(t){var e=0;return t.store(ua.store).$t((function(t,n){e+=ru(n)})).next((function(){var n=new ca(e);return t.store(ca.store).put(ca.key,n)}))},t.prototype.Re=function(t){var e=this,n=t.store(ra.store),r=t.store(ia.store);return n.Nt().next((function(n){return Ia.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Nt(ia.userMutationsIndex,i).next((function(r){return Ia.forEach(r,(function(r){Mr(r.userId===n.userId);var i=Ka(e.R,r);return nu(t,n.userId,i).next((function(){}))}))}))}))}))},t.prototype.ve=function(t){var e=t.store(la.store),n=t.store(ua.store);return t.store(fa.store).get(fa.key).next((function(t){var r=[];return n.$t((function(n,i){var o=new $r(n),s=function(t){return[0,$s(t)]}(o);r.push(e.get(s).next((function(n){return n?Ia.resolve():function(n){return e.put(new la(0,$s(n),t.highestListenSequenceNumber))}(o)})))})).next((function(){return Ia.waitFor(r)}))}))},t.prototype.Pe=function(t,e){t.createObjectStore(da.store,{keyPath:da.keyPath});var n=e.store(da.store),r=new $a,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:$s(i)})}};return e.store(ua.store).$t({Ft:!0},(function(t,e){var n=new $r(t);return i(n.popLast())})).next((function(){return e.store(oa.store).$t({Ft:!0},(function(t,e){var n=ta(t[1]);return i(n.popLast())}))}))},t.prototype.Ve=function(t){var e=this,n=t.store(ha.store);return n.$t((function(t,r){var i=Ga(r),o=za(e.R,i);return n.put(o)}))},t}();function Nu(t){t.createObjectStore(la.store,{keyPath:la.keyPath}).createIndex(la.documentTargetsIndex,la.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(ha.store,{keyPath:ha.keyPath}).createIndex(ha.queryTargetsIndexName,ha.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(fa.store)}var ju="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",ku=function(){function t(e,n,r,i,o,s,a,u,c,h){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Se=o,this.window=s,this.document=a,this.De=c,this.Ce=h,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ke=null,this.inForeground=!1,this.Fe=null,this.$e=null,this.Oe=Number.NEGATIVE_INFINITY,this.Me=function(t){return Promise.resolve()},!t.yt())throw new jr(Nr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new bu(this,i),this.Le=n+"main",this.R=new La(u),this.Be=new Ea(this.Le,11,new Au(this.R)),this.qe=new hu(this.referenceDelegate,this.R),this.Ut=new Ja,this.Ue=function(t,e){return new Eu(t,e)}(this.R,this.Ut),this.Ke=new Ha,this.window&&this.window.localStorage?this.Qe=this.window.localStorage:(this.Qe=null,!1===h&&Rr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.prototype.start=function(){var t=this;return this.je().then((function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new jr(Nr.FAILED_PRECONDITION,ju);return t.We(),t.Ge(),t.ze(),t.runTransaction("getHighestListenSequenceNumber","readonly",(function(e){return t.qe.getHighestSequenceNumber(e)}))})).then((function(e){t.Ne=new Ar(e,t.De)})).then((function(){t.xe=!0})).catch((function(e){return t.Be&&t.Be.close(),Promise.reject(e)}))},t.prototype.He=function(t){var e=this;return this.Me=function(n){return Object(b.b)(e,void 0,void 0,(function(){return Object(b.d)(this,(function(e){return this.started?[2,t(n)]:[2]}))}))},t(this.isPrimary)},t.prototype.setDatabaseDeletedListener=function(t){var e=this;this.Be.vt((function(n){return Object(b.b)(e,void 0,void 0,(function(){return Object(b.d)(this,(function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}))},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget((function(){return Object(b.b)(e,void 0,void 0,(function(){return Object(b.d)(this,(function(t){switch(t.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))})))},t.prototype.je=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(function(e){return xu(e).put(new pa(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next((function(){if(t.isPrimary)return t.Je(e).next((function(e){e||(t.isPrimary=!1,t.Se.enqueueRetryable((function(){return t.Me(!1)})))}))})).next((function(){return t.Ye(e)})).next((function(n){return t.isPrimary&&!n?t.Xe(e).next((function(){return!1})):!!n&&t.Ze(e).next((function(){return!0}))}))})).catch((function(e){if(Sa(e))return xr("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return xr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((function(e){t.isPrimary!==e&&t.Se.enqueueRetryable((function(){return t.Me(e)})),t.isPrimary=e}))},t.prototype.Je=function(t){var e=this;return Cu(t).get(na.key).next((function(t){return Ia.resolve(e.tn(t))}))},t.prototype.en=function(t){return xu(t).delete(this.clientId)},t.prototype.nn=function(){return Object(b.b)(this,void 0,void 0,(function(){var t,e,n,r=this;return Object(b.d)(this,(function(i){switch(i.label){case 0:return!this.isPrimary||this.sn(this.Oe,18e5)?[3,2]:(this.Oe=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(t){var e=Ca(t,pa.store);return e.Nt().next((function(t){var n=r.rn(t,18e5),i=t.filter((function(t){return-1===n.indexOf(t)}));return Ia.forEach(i,(function(t){return e.delete(t.clientId)})).next((function(){return i}))}))})).catch((function(){return[]}))]);case 1:if(t=i.sent(),this.Qe)for(e=0,n=t;e<n.length;e++)this.Qe.removeItem(this.on(n[e].clientId));i.label=2;case 2:return[2]}}))}))},t.prototype.ze=function(){var t=this;this.$e=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,(function(){return t.je().then((function(){return t.nn()})).then((function(){return t.ze()}))}))},t.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.Ye=function(t){var e=this;return this.Ce?Ia.resolve(!0):Cu(t).get(na.key).next((function(n){if(null!==n&&e.sn(n.leaseTimestampMs,5e3)&&!e.cn(n.ownerId)){if(e.tn(n)&&e.networkEnabled)return!0;if(!e.tn(n)){if(!n.allowTabSynchronization)throw new jr(Nr.FAILED_PRECONDITION,ju);return!1}}return!(!e.networkEnabled||!e.inForeground)||xu(t).Nt().next((function(t){return void 0===e.rn(t,5e3).find((function(t){return!(e.clientId===t.clientId||!(!e.networkEnabled&&t.networkEnabled||!e.inForeground&&t.inForeground&&e.networkEnabled===t.networkEnabled))}))}))})).next((function(t){return e.isPrimary!==t&&xr("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t}))},t.prototype.shutdown=function(){return Object(b.b)(this,void 0,void 0,(function(){var t=this;return Object(b.d)(this,(function(e){switch(e.label){case 0:return this.xe=!1,this.un(),this.$e&&(this.$e.cancel(),this.$e=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[na.store,pa.store],(function(e){var n=new ka(e,Ar.o);return t.Xe(n).next((function(){return t.en(n)}))}))];case 1:return e.sent(),this.Be.close(),this.ln(),[2]}}))}))},t.prototype.rn=function(t,e){var n=this;return t.filter((function(t){return n.sn(t.updateTimeMs,e)&&!n.cn(t.clientId)}))},t.prototype.fn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",(function(e){return xu(e).Nt().next((function(e){return t.rn(e,18e5).map((function(t){return t.clientId}))}))}))},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.getMutationQueue=function(t){return iu.Qt(t,this.R,this.Ut,this.referenceDelegate)},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getBundleCache=function(){return this.Ke},t.prototype.runTransaction=function(t,e,n){var r,i=this;return xr("IndexedDbPersistence","Starting transaction:",t),this.Be.runTransaction(t,"readonly"===e?"readonly":"readwrite",va,(function(o){return r=new ka(o,i.Ne?i.Ne.next():Ar.o),"readwrite-primary"===e?i.Je(r).next((function(t){return!!t||i.Ye(r)})).next((function(e){if(!e)throw Rr("Failed to obtain primary lease for action '"+t+"'."),i.isPrimary=!1,i.Se.enqueueRetryable((function(){return i.Me(!1)})),new jr(Nr.FAILED_PRECONDITION,ma);return n(r)})).next((function(t){return i.Ze(r).next((function(){return t}))})):i.dn(r).next((function(){return n(r)}))})).then((function(t){return r.raiseOnCommittedEvent(),t}))},t.prototype.dn=function(t){var e=this;return Cu(t).get(na.key).next((function(t){if(null!==t&&e.sn(t.leaseTimestampMs,5e3)&&!e.cn(t.ownerId)&&!e.tn(t)&&!(e.Ce||e.allowTabSynchronization&&t.allowTabSynchronization))throw new jr(Nr.FAILED_PRECONDITION,ju)}))},t.prototype.Ze=function(t){var e=new na(this.clientId,this.allowTabSynchronization,Date.now());return Cu(t).put(na.key,e)},t.yt=function(){return Ea.yt()},t.prototype.Xe=function(t){var e=this,n=Cu(t);return n.get(na.key).next((function(t){return e.tn(t)?(xr("IndexedDbPersistence","Releasing primary lease."),n.delete(na.key)):Ia.resolve()}))},t.prototype.sn=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(Rr("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.We=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Fe=function(){t.Se.enqueueAndForget((function(){return t.inForeground="visible"===t.document.visibilityState,t.je()}))},this.document.addEventListener("visibilitychange",this.Fe),this.inForeground="visible"===this.document.visibilityState)},t.prototype.an=function(){this.Fe&&(this.document.removeEventListener("visibilitychange",this.Fe),this.Fe=null)},t.prototype.Ge=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.ke=function(){e.un(),Object(w.z)()&&navigator.appVersion.match("Version/14")&&e.Se.enterRestrictedMode(!0),e.Se.enqueueAndForget((function(){return e.shutdown()}))},this.window.addEventListener("pagehide",this.ke))},t.prototype.hn=function(){this.ke&&(this.window.removeEventListener("pagehide",this.ke),this.ke=null)},t.prototype.cn=function(t){var e;try{var n=null!==(null===(e=this.Qe)||void 0===e?void 0:e.getItem(this.on(t)));return xr("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return Rr("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.un=function(){if(this.Qe)try{this.Qe.setItem(this.on(this.clientId),String(Date.now()))}catch(t){Rr("Failed to set zombie client id.",t)}},t.prototype.ln=function(){if(this.Qe)try{this.Qe.removeItem(this.on(this.clientId))}catch(t){}},t.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function Cu(t){return Ca(t,na.store)}function xu(t){return Ca(t,pa.store)}function Ru(t,e){var n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var Pu=function(t,e){this.progress=t,this.wn=e},Lu=function(){function t(t,e,n){this.Ue=t,this._n=e,this.Ut=n}return t.prototype.mn=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,e).next((function(r){return n.yn(t,e,r)}))},t.prototype.yn=function(t,e,n){return this.Ue.getEntry(t,e).next((function(t){for(var e=0,r=n;e<r.length;e++)r[e].applyToLocalView(t);return t}))},t.prototype.gn=function(t,e){t.forEach((function(t,n){for(var r=0,i=e;r<i.length;r++)i[r].applyToLocalView(n)}))},t.prototype.pn=function(t,e){var n=this;return this.Ue.getEntries(t,e).next((function(e){return n.En(t,e).next((function(){return e}))}))},t.prototype.En=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next((function(t){return n.gn(e,t)}))},t.prototype.getDocumentsMatchingQuery=function(t,e,n){return function(t){return li.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Tn(t,e.path):eo(e)?this.In(t,e,n):this.An(t,e,n)},t.prototype.Tn=function(t,e){return this.mn(t,new li(e)).next((function(t){var e=rs();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))},t.prototype.In=function(t,e,n){var r=this,i=e.collectionGroup,o=rs();return this.Ut.getCollectionParents(t,i).next((function(s){return Ia.forEach(s,(function(s){var a=function(t,e){return new Wi(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,s.child(i));return r.An(t,a,n).next((function(t){t.forEach((function(t,e){o=o.insert(t,e)}))}))})).next((function(){return o}))}))},t.prototype.An=function(t,e,n){var r,i,o=this;return this.Ue.getDocumentsMatchingQuery(t,e,n).next((function(n){return r=n,o._n.getAllMutationBatchesAffectingQuery(t,e)})).next((function(e){return o.Rn(t,i=e,r).next((function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,a=o.mutations;s<a.length;s++){var u=a[s],c=u.key,h=r.get(c);null==h&&(h=Di.newInvalidDocument(c),r=r.insert(c,h)),xo(u,h,o.localWriteTime),h.isFoundDocument()||(r=r.remove(c))}}))})).next((function(){return r.forEach((function(t,n){uo(e,n)||(r=r.remove(t))})),r}))},t.prototype.Rn=function(t,e,n){for(var r=as(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof Mo&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.Ue.getEntries(t,r).next((function(t){return t.forEach((function(t,e){e.isFoundDocument()&&(c=c.insert(t,e))})),c}))},t}(),Fu=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.bn=n,this.vn=r}return t.Pn=function(e,n){for(var r=as(),i=as(),o=0,s=n.docChanges;o<s.length;o++){var a=s[o];switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),Mu=function(){function t(){}return t.prototype.Vn=function(t){this.Sn=t},t.prototype.getDocumentsMatchingQuery=function(t,e,n,r){var i=this;return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||n.isEqual(Qr.min())?this.Dn(t,e):this.Sn.pn(t,r).next((function(o){var s=i.Cn(e,o);return($i(e)||Ji(e))&&i.Nn(e.limitType,s,r,n)?i.Dn(t,e):(Cr()<=I.a.DEBUG&&xr("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),ao(e)),i.Sn.getDocumentsMatchingQuery(t,e,n).next((function(t){return s.forEach((function(e){t=t.insert(e.key,e)})),t})))}))},t.prototype.Cn=function(t,e){var n=new Jo(co(t));return e.forEach((function(e,r){uo(t,r)&&(n=n.add(r))})),n},t.prototype.Nn=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)},t.prototype.Dn=function(t,e){return Cr()<=I.a.DEBUG&&xr("QueryEngine","Using full collection scan to execute query:",ao(e)),this.Sn.getDocumentsMatchingQuery(t,e,Qr.min())},t}(),qu=function(){function t(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.kn=new Yo(Br),this.Fn=new Iu((function(t){return ji(t)}),ki),this.$n=Qr.min(),this._n=t.getMutationQueue(n),this.On=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new Lu(this.On,this._n,this.persistence.getIndexManager()),this.Ke=t.getBundleCache(),this.xn.Vn(this.Mn)}return t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return t.collect(n,e.kn)}))},t}();function Uu(t,e,n,r){return new qu(t,e,n,r)}function Vu(t,e){return Object(b.b)(this,void 0,void 0,(function(){var n,r,i,o;return Object(b.d)(this,(function(s){switch(s.label){case 0:return n=qr(t),r=n._n,i=n.Mn,[4,n.persistence.runTransaction("Handle user change","readonly",(function(t){var o;return n._n.getAllMutationBatches(t).next((function(s){return o=s,r=n.persistence.getMutationQueue(e),i=new Lu(n.On,r,n.persistence.getIndexManager()),r.getAllMutationBatches(t)})).next((function(e){for(var n=[],r=[],s=as(),a=0,u=o;a<u.length;a++){var c=u[a];n.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++)s=s.add(l[h].key)}for(var f=0,d=e;f<d.length;f++){var p=d[f];r.push(p.batchId);for(var y=0,g=p.mutations;y<g.length;y++)s=s.add(g[y].key)}return i.pn(t,s).next((function(t){return{Ln:t,removedBatchIds:n,addedBatchIds:r}}))}))}))];case 1:return o=s.sent(),[2,(n._n=r,n.Mn=i,n.xn.Vn(n.Mn),o)]}}))}))}function Bu(t,e){var n=qr(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(t){var r=e.batch.keys(),i=n.On.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),s=Ia.resolve();return o.forEach((function(t){s=s.next((function(){return r.getEntry(e,t)})).next((function(e){var o=n.docVersions.get(t);Mr(null!==o),e.version.compareTo(o)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&r.addEntry(e,n.commitVersion))}))})),s.next((function(){return t._n.removeMutationBatch(e,i)}))}(n,t,e,i).next((function(){return i.apply(t)})).next((function(){return n._n.performConsistencyCheck(t)})).next((function(){return n.Mn.pn(t,r)}))}))}function Ku(t){var e=qr(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(function(t){return e.qe.getLastRemoteSnapshotVersion(t)}))}function Gu(t,e){var n=qr(t),r=e.snapshotVersion,i=n.kn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(function(t){var o=n.On.newChangeBuffer({trackRemovals:!0});i=n.kn;var s=[];e.targetChanges.forEach((function(e,o){var a=i.get(o);if(a){s.push(n.qe.removeMatchingKeys(t,e.removedDocuments,o).next((function(){return n.qe.addMatchingKeys(t,e.addedDocuments,o)})));var u=e.resumeToken;if(u.approximateByteSize()>0){var c=a.withResumeToken(u,r).withSequenceNumber(t.currentSequenceNumber);i=i.insert(o,c),function(t,e,n){return Mr(e.resumeToken.approximateByteSize()>0),0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(a,c,e)&&s.push(n.qe.updateTargetData(t,c))}}}));var a=es();if(e.documentUpdates.forEach((function(r,i){e.resolvedLimboDocuments.has(r)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))})),s.push(zu(t,o,e.documentUpdates,r,void 0).next((function(t){a=t}))),!r.isEqual(Qr.min())){var u=n.qe.getLastRemoteSnapshotVersion(t).next((function(e){return n.qe.setTargetsMetadata(t,t.currentSequenceNumber,r)}));s.push(u)}return Ia.waitFor(s).next((function(){return o.apply(t)})).next((function(){return n.Mn.En(t,a)})).next((function(){return a}))})).then((function(t){return n.kn=i,t}))}function zu(t,e,n,r,i){var o=as();return n.forEach((function(t){return o=o.add(t)})),e.getEntries(t,o).next((function(t){var o=es();return n.forEach((function(n,s){var a=t.get(n),u=(null==i?void 0:i.get(n))||r;s.isNoDocument()&&s.version.isEqual(Qr.min())?(e.removeEntry(n,u),o=o.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(e.addEntry(s,u),o=o.insert(n,s)):xr("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)})),o}))}function Qu(t,e){var n=qr(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(function(t){return void 0===e&&(e=-1),n._n.getNextMutationBatchAfterBatchId(t,e)}))}function Hu(t,e){var n=qr(t);return n.persistence.runTransaction("Allocate target","readwrite",(function(t){var r;return n.qe.getTargetData(t,e).next((function(i){return i?Ia.resolve(r=i):n.qe.allocateTargetId(t).next((function(i){return r=new Pa(e,i,0,t.currentSequenceNumber),n.qe.addTargetData(t,r).next((function(){return r}))}))}))})).then((function(t){var r=n.kn.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.kn=n.kn.insert(t.targetId,t),n.Fn.set(e,t.targetId)),t}))}function Wu(t,e,n){return Object(b.b)(this,void 0,void 0,(function(){var r,i,o,s;return Object(b.d)(this,(function(a){switch(a.label){case 0:r=qr(t),i=r.kn.get(e),o=n?"readwrite":"readwrite-primary",a.label=1;case 1:return a.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",o,(function(t){return r.persistence.referenceDelegate.removeTarget(t,i)}))];case 2:a.sent(),a.label=3;case 3:return[3,5];case 4:if(!Sa(s=a.sent()))throw s;return xr("LocalStore","Failed to update sequence numbers for target "+e+": "+s),[3,5];case 5:return r.kn=r.kn.remove(e),r.Fn.delete(i.target),[2]}}))}))}function Yu(t,e,n){var r=qr(t),i=Qr.min(),o=as();return r.persistence.runTransaction("Execute query","readonly",(function(t){return function(t,e,n){var r=qr(t),i=r.Fn.get(n);return void 0!==i?Ia.resolve(r.kn.get(i)):r.qe.getTargetData(e,n)}(r,t,ro(e)).next((function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.qe.getMatchingKeysForTargetId(t,e.targetId).next((function(t){o=t}))})).next((function(){return r.xn.getDocumentsMatchingQuery(t,e,n?i:Qr.min(),n?o:as())})).next((function(t){return{documents:t,Bn:o}}))}))}function Xu(t,e){var n=qr(t),r=qr(n.qe),i=n.kn.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(function(t){return r.lt(t,e).next((function(t){return t?t.target:null}))}))}function $u(t){var e=qr(t);return e.persistence.runTransaction("Get new document changes","readonly",(function(t){return function(t,e,n){var r=qr(t),i=es(),o=qa(n),s=Su(e),a=IDBKeyRange.lowerBound(o,!0);return s.$t({index:ua.readTimeIndex,range:a},(function(t,e){var n=Fa(r.R,e);i=i.insert(n.key,n),o=e.readTime})).next((function(){return{wn:i,readTime:Ua(o)}}))}(e.On,t,e.$n)})).then((function(t){var n=t.wn;return e.$n=t.readTime,n}))}function Ju(t){return Object(b.b)(this,void 0,void 0,(function(){var e;return Object(b.d)(this,(function(n){return[2,(e=qr(t)).persistence.runTransaction("Synchronize last document change read time","readonly",(function(t){return function(t){var e=Su(t),n=Qr.min();return e.$t({index:ua.readTimeIndex,reverse:!0},(function(t,e,r){e.readTime&&(n=Ua(e.readTime)),r.done()})).next((function(){return n}))}(t)})).then((function(t){e.$n=t}))]}))}))}function Zu(t,e,n,r){return Object(b.b)(this,void 0,void 0,(function(){var i,o,s,a,u,c,h,l,f,d;return Object(b.d)(this,(function(p){switch(p.label){case 0:for(i=qr(t),o=as(),s=es(),a=os(),u=0,c=n;u<c.length;u++)l=e.qn((h=c[u]).metadata.name),h.document&&(o=o.add(l)),s=s.insert(l,e.Un(h)),a=a.insert(l,e.Kn(h.metadata.readTime));return f=i.On.newChangeBuffer({trackRemovals:!0}),[4,Hu(i,function(t){return ro(Xi($r.fromString("__bundle__/docs/"+t)))}(r))];case 1:return d=p.sent(),[2,i.persistence.runTransaction("Apply bundle documents","readwrite",(function(t){return zu(t,f,s,Qr.min(),a).next((function(e){return f.apply(t),e})).next((function(e){return i.qe.removeMatchingKeysForTargetId(t,d.targetId).next((function(){return i.qe.addMatchingKeys(t,o,d.targetId)})).next((function(){return i.Mn.En(t,e)})).next((function(){return e}))}))}))]}}))}))}function tc(t,e,n){return void 0===n&&(n=as()),Object(b.b)(this,void 0,void 0,(function(){var r,i;return Object(b.d)(this,(function(o){switch(o.label){case 0:return[4,Hu(t,ro(Qa(e.bundledQuery)))];case 1:return r=o.sent(),[2,(i=qr(t)).persistence.runTransaction("Save named query","readwrite",(function(t){var o=Os(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return i.Ke.saveNamedQuery(t,e);var s=r.withResumeToken(ei.EMPTY_BYTE_STRING,o);return i.kn=i.kn.insert(s.targetId,s),i.qe.updateTargetData(t,s).next((function(){return i.qe.removeMatchingKeysForTargetId(t,r.targetId)})).next((function(){return i.qe.addMatchingKeys(t,n,r.targetId)})).next((function(){return i.Ke.saveNamedQuery(t,e)}))}))]}}))}))}var ec=function(){function t(t){this.R=t,this.Qn=new Map,this.jn=new Map}return t.prototype.getBundleMetadata=function(t,e){return Ia.resolve(this.Qn.get(e))},t.prototype.saveBundleMetadata=function(t,e){var n;return this.Qn.set(e.id,{id:(n=e).id,version:n.version,createTime:Os(n.createTime)}),Ia.resolve()},t.prototype.getNamedQuery=function(t,e){return Ia.resolve(this.jn.get(e))},t.prototype.saveNamedQuery=function(t,e){return this.jn.set(e.name,function(t){return{name:t.name,query:Qa(t.bundledQuery),readTime:Os(t.readTime)}}(e)),Ia.resolve()},t}(),nc=function(){function t(){this.Wn=new Jo(rc.Gn),this.zn=new Jo(rc.Hn)}return t.prototype.isEmpty=function(){return this.Wn.isEmpty()},t.prototype.addReference=function(t,e){var n=new rc(t,e);this.Wn=this.Wn.add(n),this.zn=this.zn.add(n)},t.prototype.Jn=function(t,e){var n=this;t.forEach((function(t){return n.addReference(t,e)}))},t.prototype.removeReference=function(t,e){this.Yn(new rc(t,e))},t.prototype.Xn=function(t,e){var n=this;t.forEach((function(t){return n.removeReference(t,e)}))},t.prototype.Zn=function(t){var e=this,n=new li(new $r([])),r=new rc(n,t),i=new rc(n,t+1),o=[];return this.zn.forEachInRange([r,i],(function(t){e.Yn(t),o.push(t.key)})),o},t.prototype.ts=function(){var t=this;this.Wn.forEach((function(e){return t.Yn(e)}))},t.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},t.prototype.es=function(t){var e=new li(new $r([])),n=new rc(e,t),r=new rc(e,t+1),i=as();return this.zn.forEachInRange([n,r],(function(t){i=i.add(t.key)})),i},t.prototype.containsKey=function(t){var e=new rc(t,0),n=this.Wn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),rc=function(){function t(t,e){this.key=t,this.ns=e}return t.Gn=function(t,e){return li.comparator(t.key,e.key)||Br(t.ns,e.ns)},t.Hn=function(t,e){return Br(t.ns,e.ns)||li.comparator(t.key,e.key)},t}(),ic=function(){function t(t,e){this.Ut=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new Jo(rc.Gn)}return t.prototype.checkEmpty=function(t){return Ia.resolve(0===this._n.length)},t.prototype.addMutationBatch=function(t,e,n,r){var i=this.ss;this.ss++;var o=new xa(i,e,n,r);this._n.push(o);for(var s=0,a=r;s<a.length;s++){var u=a[s];this.rs=this.rs.add(new rc(u.key,i)),this.Ut.addToCollectionParentIndex(t,u.key.path.popLast())}return Ia.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return Ia.resolve(this.os(e))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this.cs(e+1),r=n<0?0:n;return Ia.resolve(this._n.length>r?this._n[r]:null)},t.prototype.getHighestUnacknowledgedBatchId=function(){return Ia.resolve(0===this._n.length?-1:this.ss-1)},t.prototype.getAllMutationBatches=function(t){return Ia.resolve(this._n.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new rc(e,0),i=new rc(e,Number.POSITIVE_INFINITY),o=[];return this.rs.forEachInRange([r,i],(function(t){var e=n.os(t.ns);o.push(e)})),Ia.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Jo(Br);return e.forEach((function(t){var e=new rc(t,0),i=new rc(t,Number.POSITIVE_INFINITY);n.rs.forEachInRange([e,i],(function(t){r=r.add(t.ns)}))})),Ia.resolve(this.us(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,i=n;li.isDocumentKey(i)||(i=i.child(""));var o=new rc(new li(i),0),s=new Jo(Br);return this.rs.forEachWhile((function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(s=s.add(t.ns)),!0)}),o),Ia.resolve(this.us(s))},t.prototype.us=function(t){var e=this,n=[];return t.forEach((function(t){var r=e.os(t);null!==r&&n.push(r)})),n},t.prototype.removeMutationBatch=function(t,e){var n=this;Mr(0===this.hs(e.batchId,"removed")),this._n.shift();var r=this.rs;return Ia.forEach(e.mutations,(function(i){var o=new rc(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.markPotentiallyOrphaned(t,i.key)})).next((function(){n.rs=r}))},t.prototype.Gt=function(t){},t.prototype.containsKey=function(t,e){var n=new rc(e,0),r=this.rs.firstAfterOrEqual(n);return Ia.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return Ia.resolve()},t.prototype.hs=function(t,e){return this.cs(t)},t.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},t.prototype.os=function(t){var e=this.cs(t);return e<0||e>=this._n.length?null:this._n[e]},t}(),oc=function(){function t(t,e){this.Ut=t,this.ls=e,this.docs=new Yo(li.comparator),this.size=0}return t.prototype.addEntry=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:s,readTime:n}),this.size+=s-o,this.Ut.addToCollectionParentIndex(t,r.path.popLast())},t.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return Ia.resolve(n?n.document.clone():Di.newInvalidDocument(e))},t.prototype.getEntries=function(t,e){var n=this,r=es();return e.forEach((function(t){var e=n.docs.get(t);r=r.insert(t,e?e.document.clone():Di.newInvalidDocument(t))})),Ia.resolve(r)},t.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=es(),i=new li(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=o.getNext(),a=s.value,u=a.document,c=a.readTime;if(!e.path.isPrefixOf(s.key.path))break;c.compareTo(n)<=0||uo(e,u)&&(r=r.insert(u.key,u.clone()))}return Ia.resolve(r)},t.prototype.fs=function(t,e){return Ia.forEach(this.docs,(function(t){return e(t)}))},t.prototype.newChangeBuffer=function(t){return new sc(this)},t.prototype.getSize=function(t){return Ia.resolve(this.size)},t}(),sc=function(t){function e(e){var n=this;return(n=t.call(this)||this).Ie=e,n}return Object(b.c)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach((function(r,i){i.document.isValidDocument()?n.push(e.Ie.addEntry(t,i.document,e.getReadTime(r))):e.Ie.removeEntry(r)})),Ia.waitFor(n)},e.prototype.getFromCache=function(t,e){return this.Ie.getEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.Ie.getEntries(t,e)},e}(Tu),ac=function(){function t(t){this.persistence=t,this.ds=new Iu((function(t){return ji(t)}),ki),this.lastRemoteSnapshotVersion=Qr.min(),this.highestTargetId=0,this.ws=0,this._s=new nc,this.targetCount=0,this.ys=cu.Jt()}return t.prototype.forEachTarget=function(t,e){return this.ds.forEach((function(t,n){return e(n)})),Ia.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return Ia.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return Ia.resolve(this.ws)},t.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),Ia.resolve(this.highestTargetId)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),Ia.resolve()},t.prototype.te=function(t){this.ds.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ys=new cu(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},t.prototype.addTargetData=function(t,e){return this.te(e),this.targetCount+=1,Ia.resolve()},t.prototype.updateTargetData=function(t,e){return this.te(e),Ia.resolve()},t.prototype.removeTargetData=function(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),this.targetCount-=1,Ia.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.ds.forEach((function(s,a){a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r.ds.delete(s),o.push(r.removeMatchingKeysForTargetId(t,a.targetId)),i++)})),Ia.waitFor(o).next((function(){return i}))},t.prototype.getTargetCount=function(t){return Ia.resolve(this.targetCount)},t.prototype.getTargetData=function(t,e){var n=this.ds.get(e)||null;return Ia.resolve(n)},t.prototype.addMatchingKeys=function(t,e,n){return this._s.Jn(e,n),Ia.resolve()},t.prototype.removeMatchingKeys=function(t,e,n){this._s.Xn(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach((function(e){i.push(r.markPotentiallyOrphaned(t,e))})),Ia.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this._s.Zn(e),Ia.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this._s.es(e);return Ia.resolve(n)},t.prototype.containsKey=function(t,e){return Ia.resolve(this._s.containsKey(e))},t}(),uc=function(){function t(t,e){var n=this;this.gs={},this.Ne=new Ar(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new ac(this),this.Ut=new Xa,this.Ue=function(t,e){return new oc(t,(function(t){return n.referenceDelegate.ps(t)}))}(this.Ut),this.R=new La(e),this.Ke=new ec(this.R)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.setDatabaseDeletedListener=function(){},t.prototype.setNetworkEnabled=function(){},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getMutationQueue=function(t){var e=this.gs[t.toKey()];return e||(e=new ic(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=e),e},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getBundleCache=function(){return this.Ke},t.prototype.runTransaction=function(t,e,n){var r=this;xr("MemoryPersistence","Starting transaction:",t);var i=new cc(this.Ne.next());return this.referenceDelegate.Es(),n(i).next((function(t){return r.referenceDelegate.Ts(i).next((function(){return t}))})).toPromise().then((function(t){return i.raiseOnCommittedEvent(),t}))},t.prototype.Is=function(t,e){return Ia.or(Object.values(this.gs).map((function(n){return function(){return n.containsKey(t,e)}})))},t}(),cc=function(t){function e(e){var n=this;return(n=t.call(this)||this).currentSequenceNumber=e,n}return Object(b.c)(e,t),e}(ba),hc=function(){function t(t){this.persistence=t,this.As=new nc,this.Rs=null}return t.bs=function(e){return new t(e)},Object.defineProperty(t.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw Fr()},enumerable:!1,configurable:!0}),t.prototype.addReference=function(t,e,n){return this.As.addReference(n,e),this.vs.delete(n.toString()),Ia.resolve()},t.prototype.removeReference=function(t,e,n){return this.As.removeReference(n,e),this.vs.add(n.toString()),Ia.resolve()},t.prototype.markPotentiallyOrphaned=function(t,e){return this.vs.add(e.toString()),Ia.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.As.Zn(e.targetId).forEach((function(t){return n.vs.add(t.toString())}));var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next((function(t){t.forEach((function(t){return n.vs.add(t.toString())}))})).next((function(){return r.removeTargetData(t,e)}))},t.prototype.Es=function(){this.Rs=new Set},t.prototype.Ts=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ia.forEach(this.vs,(function(r){var i=li.fromPath(r);return e.Ps(t,i).next((function(t){t||n.removeEntry(i)}))})).next((function(){return e.Rs=null,n.apply(t)}))},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ps(t,e).next((function(t){t?n.vs.delete(e.toString()):n.vs.add(e.toString())}))},t.prototype.ps=function(t){return 0},t.prototype.Ps=function(t,e){var n=this;return Ia.or([function(){return Ia.resolve(n.As.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Is(t,e)}])},t}(),lc=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();function fc(t,e){return"firestore_clients_"+t+"_"+e}function dc(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.isAuthenticated()&&(r+="_"+e.uid),r}function pc(t,e){return"firestore_targets_"+t+"_"+e}lc.UNAUTHENTICATED=new lc(null),lc.GOOGLE_CREDENTIALS=new lc("google-credentials-uid"),lc.FIRST_PARTY=new lc("first-party-uid"),lc.MOCK_USER=new lc("mock-user");var yc=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.Vs=function(e,n,r){var i,o=JSON.parse(r),s="object"==typeof o&&-1!==["pending","acknowledged","rejected"].indexOf(o.state)&&(void 0===o.error||"object"==typeof o.error);return s&&o.error&&(s="string"==typeof o.error.message&&"string"==typeof o.error.code)&&(i=new jr(o.error.code,o.error.message)),s?new t(e,n,o.state,i):(Rr("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),gc=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.Vs=function(e,n){var r,i=JSON.parse(n),o="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new jr(i.error.code,i.error.message)),o?new t(e,i.state,r):(Rr("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),vc=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.Vs=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=cs(),s=0;i&&s<r.activeTargetIds.length;++s)i=hi(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(Rr("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),mc=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.Vs=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(Rr("SharedClientState","Failed to parse online state: "+e),null)},t}(),bc=function(){function t(){this.activeTargetIds=cs()}return t.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),wc=function(){function t(t,e,n,r,i){this.window=t,this.Se=e,this.persistenceKey=n,this.Ns=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.ks.bind(this),this.Fs=new Yo(Br),this.started=!1,this.$s=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Os=fc(this.persistenceKey,this.Ns),this.Ms=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.Fs=this.Fs.insert(this.Ns,new bc),this.Ls=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Us=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.Ks=function(t){return"firestore_bundle_loaded_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.xs)}return t.yt=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return Object(b.b)(this,void 0,void 0,(function(){var t,e,n,r,i,o,s,a,u,c,h=this;return Object(b.d)(this,(function(l){switch(l.label){case 0:return[4,this.syncEngine.fn()];case 1:for(t=l.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.Ns&&(i=this.getItem(fc(this.persistenceKey,r)))&&(o=vc.Vs(r,i))&&(this.Fs=this.Fs.insert(o.clientId,o));for(this.Qs(),(s=this.storage.getItem(this.Us))&&(a=this.js(s))&&this.Ws(a),u=0,c=this.$s;u<c.length;u++)this.ks(c[u]);return this.$s=[],this.window.addEventListener("pagehide",(function(){return h.shutdown()})),this.started=!0,[2]}}))}))},t.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.Fs)},t.prototype.isActiveQueryTarget=function(t){var e=!1;return this.Fs.forEach((function(n,r){r.activeTargetIds.has(t)&&(e=!0)})),e},t.prototype.addPendingMutation=function(t){this.zs(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.zs(t,e,n),this.Hs(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(pc(this.persistenceKey,t));if(n){var r=gc.Vs(t,n);r&&(e=r.state)}}return this.Js.Ds(t),this.Qs(),e},t.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Qs()},t.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(pc(this.persistenceKey,t))},t.prototype.updateQueryState=function(t,e,n){this.Ys(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach((function(t){r.Hs(t)})),this.currentUser=t,n.forEach((function(t){r.addPendingMutation(t)}))},t.prototype.setOnlineState=function(t){this.Xs(t)},t.prototype.notifyBundleLoaded=function(){this.Zs()},t.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.Os),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return xr("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){xr("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){xr("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.ks=function(t){var e=this,n=t;if(n.storageArea===this.storage){if(xr("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Os)return void Rr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable((function(){return Object(b.b)(e,void 0,void 0,(function(){var t,e,r,i,o,s;return Object(b.d)(this,(function(a){if(this.started){if(null!==n.key)if(this.Ls.test(n.key)){if(null==n.newValue)return t=this.ti(n.key),[2,this.ei(t,null)];if(e=this.ni(n.key,n.newValue))return[2,this.ei(e.clientId,e)]}else if(this.Bs.test(n.key)){if(null!==n.newValue&&(r=this.si(n.key,n.newValue)))return[2,this.ii(r)]}else if(this.qs.test(n.key)){if(null!==n.newValue&&(i=this.ri(n.key,n.newValue)))return[2,this.oi(i)]}else if(n.key===this.Us){if(null!==n.newValue&&(o=this.js(n.newValue)))return[2,this.Ws(o)]}else if(n.key===this.Ms)(s=function(t){var e=Ar.o;if(null!=t)try{var n=JSON.parse(t);Mr("number"==typeof n),e=n}catch(t){Rr("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(n.newValue))!==Ar.o&&this.sequenceNumberHandler(s);else if(n.key===this.Ks)return[2,this.syncEngine.ci()]}else this.$s.push(n);return[2]}))}))}))}},Object.defineProperty(t.prototype,"Js",{get:function(){return this.Fs.get(this.Ns)},enumerable:!1,configurable:!0}),t.prototype.Qs=function(){this.setItem(this.Os,this.Js.Ss())},t.prototype.zs=function(t,e,n){var r=new yc(this.currentUser,t,e,n),i=dc(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Ss())},t.prototype.Hs=function(t){var e=dc(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Xs=function(t){this.storage.setItem(this.Us,JSON.stringify({clientId:this.Ns,onlineState:t}))},t.prototype.Ys=function(t,e,n){var r=pc(this.persistenceKey,t),i=new gc(t,e,n);this.setItem(r,i.Ss())},t.prototype.Zs=function(){this.setItem(this.Ks,"value-not-used")},t.prototype.ti=function(t){var e=this.Ls.exec(t);return e?e[1]:null},t.prototype.ni=function(t,e){var n=this.ti(t);return vc.Vs(n,e)},t.prototype.si=function(t,e){var n=this.Bs.exec(t),r=Number(n[1]);return yc.Vs(new lc(void 0!==n[2]?n[2]:null),r,e)},t.prototype.ri=function(t,e){var n=this.qs.exec(t),r=Number(n[1]);return gc.Vs(r,e)},t.prototype.js=function(t){return mc.Vs(t)},t.prototype.ii=function(t){return Object(b.b)(this,void 0,void 0,(function(){return Object(b.d)(this,(function(e){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(t.batchId,t.state,t.error)]:(xr("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])}))}))},t.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},t.prototype.ei=function(t,e){var n=this,r=e?this.Fs.insert(t,e):this.Fs.remove(t),i=this.Gs(this.Fs),o=this.Gs(r),s=[],a=[];return o.forEach((function(t){i.has(t)||s.push(t)})),i.forEach((function(t){o.has(t)||a.push(t)})),this.syncEngine.hi(s,a).then((function(){n.Fs=r}))},t.prototype.Ws=function(t){this.Fs.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},t.prototype.Gs=function(t){var e=cs();return t.forEach((function(t,n){e=e.unionWith(n.activeTargetIds)})),e},t}(),Ic=function(){function t(){this.li=new bc,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.fi[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},t.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.fi[t]},t.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.start=function(){return this.li=new bc,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t.prototype.notifyBundleLoaded=function(){},t}(),Tc=function(){function t(){}return t.prototype.di=function(t){},t.prototype.shutdown=function(){},t}(),Ec=function(){function t(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}return t.prototype.di=function(t){this.gi.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},t.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},t.prototype._i=function(){xr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(0)},t.prototype.yi=function(){xr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(1)},t.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),_c={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},Oc=function(){function t(t){this.Ei=t.Ei,this.Ti=t.Ti}return t.prototype.Ii=function(t){this.Ai=t},t.prototype.Ri=function(t){this.bi=t},t.prototype.onMessage=function(t){this.vi=t},t.prototype.close=function(){this.Ti()},t.prototype.send=function(t){this.Ei(t)},t.prototype.Pi=function(){this.Ai()},t.prototype.Vi=function(t){this.bi(t)},t.prototype.Si=function(t){this.vi(t)},t}(),Sc=function(t){function e(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n.autoDetectLongPolling=e.autoDetectLongPolling,n.useFetchStreams=e.useFetchStreams,n}return Object(b.c)(e,t),e.prototype.Fi=function(t,e,n,r){return new Promise((function(i,o){var s=new Dr;s.listenOnce(Er.COMPLETE,(function(){try{switch(s.getLastErrorCode()){case Tr.NO_ERROR:var e=s.getResponseJson();xr("Connection","XHR received:",JSON.stringify(e)),i(e);break;case Tr.TIMEOUT:xr("Connection",'RPC "'+t+'" timed out'),o(new jr(Nr.DEADLINE_EXCEEDED,"Request time out"));break;case Tr.HTTP_ERROR:var n=s.getStatus();if(xr("Connection",'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),n>0){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var a=function(t){var e=t.toLowerCase().replace(/_/g,"-");return Object.values(Nr).indexOf(e)>=0?e:Nr.UNKNOWN}(r.status);o(new jr(a,r.message))}else o(new jr(Nr.UNKNOWN,"Server responded with status "+s.getStatus()))}else o(new jr(Nr.UNAVAILABLE,"Connection failed."));break;default:Fr()}}finally{xr("Connection",'RPC "'+t+'" completed.')}}));var a=JSON.stringify(r);s.send(e,"POST",a,n,15)}))},e.prototype.Oi=function(t,e){var n=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=new vr,i=he(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new Or({})),this.ki(o.initMessageHeaders,e),Object(w.v)()||Object(w.y)()||Object(w.s)()||Object(w.u)()||Object(w.A)()||Object(w.r)()||(o.httpHeadersOverwriteParam="$httpHeaders");var s=n.join("");xr("Connection","Creating WebChannel: "+s,o);var a=r.createWebChannel(s,o),u=!1,c=!1,h=new Oc({Ei:function(t){c?xr("Connection","Not sending because WebChannel is closed:",t):(u||(xr("Connection","Opening WebChannel transport."),a.open(),u=!0),xr("Connection","WebChannel sending:",t),a.send(t))},Ti:function(){return a.close()}}),l=function(t,e,n){t.listen(e,(function(t){try{n(t)}catch(t){setTimeout((function(){throw t}),0)}}))};return l(a,Sr.EventType.OPEN,(function(){c||xr("Connection","WebChannel transport opened.")})),l(a,Sr.EventType.CLOSE,(function(){c||(c=!0,xr("Connection","WebChannel transport closed"),h.Vi())})),l(a,Sr.EventType.ERROR,(function(t){c||(c=!0,Pr("Connection","WebChannel transport errored:",t),h.Vi(new jr(Nr.UNAVAILABLE,"The operation could not be completed")))})),l(a,Sr.EventType.MESSAGE,(function(t){var e;if(!c){var n=t.data[0];Mr(!!n);var r=n.error||(null===(e=n[0])||void 0===e?void 0:e.error);if(r){xr("Connection","WebChannel received error:",r);var i=r.status,o=function(t){var e=Bo[t];if(void 0!==e)return Wo(e)}(i),s=r.message;void 0===o&&(o=Nr.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),c=!0,h.Vi(new jr(o,s)),a.close()}else xr("Connection","WebChannel received:",n),h.Si(n)}})),l(i,_r.STAT_EVENT,(function(t){10===t.stat?xr("Connection","Detected buffering proxy"):11===t.stat&&xr("Connection","Detected no buffering proxy")})),setTimeout((function(){h.Pi()}),0),h},e}(function(){function t(t){this.databaseInfo=t,this.databaseId=t.databaseId,this.Di=(t.ssl?"https":"http")+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return t.prototype.Ni=function(t,e,n,r){var i=this.xi(t,e);xr("RestConnection","Sending: ",i,n);var o={};return this.ki(o,r),this.Fi(t,i,o,n).then((function(t){return xr("RestConnection","Received: ",t),t}),(function(e){throw Pr("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e}))},t.prototype.$i=function(t,e,n,r){return this.Ni(t,e,n,r)},t.prototype.ki=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.10.1",t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},t.prototype.xi=function(t,e){return this.Di+"/v1/"+e+":"+_c[t]},t}());function Dc(){return"undefined"!=typeof window?window:null}function Ac(){return"undefined"!=typeof document?document:null}function Nc(t){return new Is(t,!0)}var jc=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=i,this.qi=0,this.Ui=null,this.Ki=Date.now(),this.reset()}return t.prototype.reset=function(){this.qi=0},t.prototype.Qi=function(){this.qi=this.Bi},t.prototype.ji=function(t){var e=this;this.cancel();var n=Math.floor(this.qi+this.Wi()),r=Math.max(0,Date.now()-this.Ki),i=Math.max(0,n-r);i>0&&xr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.qi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,i,(function(){return e.Ki=Date.now(),t()})),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},t.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},t.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},t.prototype.Wi=function(){return(Math.random()-.5)*this.qi},t}(),kc=function(){function t(t,e,n,r,i,o){this.Se=t,this.zi=n,this.Hi=r,this.Ji=i,this.listener=o,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new jc(t,e)}return t.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.er=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.nr()},t.prototype.stop=function(){return Object(b.b)(this,void 0,void 0,(function(){return Object(b.d)(this,(function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.sr=function(){this.state=0,this.Zi.reset()},t.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,(function(){return t.rr()})))},t.prototype.cr=function(t){this.ur(),this.stream.send(t)},t.prototype.rr=function(){return Object(b.b)(this,void 0,void 0,(function(){return Object(b.d)(this,(function(t){return this.er()?[2,this.close(0)]:[2]}))}))},t.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},t.prototype.close=function(t,e){return Object(b.b)(this,void 0,void 0,(function(){return Object(b.d)(this,(function(n){switch(n.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,3!==t?this.Zi.reset():e&&e.code===Nr.RESOURCE_EXHAUSTED?(Rr(e.toString()),Rr("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Qi()):e&&e.code===Nr.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(e)];case 1:return n.sent(),[2]}}))}))},t.prototype.ar=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.hr(this.Yi),n=this.Yi;this.Ji.getToken().then((function(e){t.Yi===n&&t.lr(e)}),(function(n){e((function(){var e=new jr(Nr.UNKNOWN,"Fetching auth token failed: "+n.message);return t.dr(e)}))}))},t.prototype.lr=function(t){var e=this,n=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii((function(){n((function(){return e.state=2,e.listener.Ii()}))})),this.stream.Ri((function(t){n((function(){return e.dr(t)}))})),this.stream.onMessage((function(t){n((function(){return e.onMessage(t)}))}))},t.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji((function(){return Object(b.b)(t,void 0,void 0,(function(){return Object(b.d)(this,(function(t){return this.state=0,this.start(),[2]}))}))}))},t.prototype.dr=function(t){return xr("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.hr=function(t){var e=this;return function(n){e.Se.enqueueAndForget((function(){return e.Yi===t?n():(xr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}},t}(),Cc=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).R=i,s}return Object(b.c)(e,t),e.prototype.wr=function(t){return this.Hi.Oi("Listen",t)},e.prototype.onMessage=function(t){this.Zi.reset();var e=function(t,e){var n;if("targetChange"in e){var r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Fr()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(t,e){return t.I?(Mr(void 0===e||"string"==typeof e),ei.fromBase64String(e||"")):(Mr(void 0===e||e instanceof Uint8Array),ei.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),s=(a=e.targetChange.cause)&&function(t){var e=void 0===t.code?Nr.UNKNOWN:Wo(t.code);return new jr(e,t.message||"")}(a);n=new ps(r,i,o,s||null)}else if("documentChange"in e){i=Ns(t,(r=e.documentChange).document.name),o=Os(r.document.updateTime);var a=new Oi({mapValue:{fields:r.document.fields}}),u=(s=Di.newFoundDocument(i,o,a),r.targetIds||[]);n=new fs(u,r.removedTargetIds||[],s.key,s)}else if("documentDelete"in e)i=Ns(t,(r=e.documentDelete).document),o=r.readTime?Os(r.readTime):Qr.min(),a=Di.newNoDocument(i,o),n=new fs([],s=r.removedTargetIds||[],a.key,a);else if("documentRemove"in e)i=Ns(t,(r=e.documentRemove).document),n=new fs([],o=r.removedTargetIds||[],i,null);else{if(!("filter"in e))return Fr();var c=e.filter;i=new Qo(r=c.count||0),n=new ds(o=c.targetId,i)}return n}(this.R,t),n=function(t){if(!("targetChange"in t))return Qr.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?Qr.min():e.readTime?Os(e.readTime):Qr.min()}(t);return this.listener._r(e,n)},e.prototype.mr=function(t){var e={};e.database=Cs(this.R),e.addTarget=function(t,e){var n,r=e.target;return(n=Ci(r)?{documents:Ms(t,r)}:{query:qs(t,r)}).targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=Es(t,e.resumeToken):e.snapshotVersion.compareTo(Qr.min())>0&&(n.readTime=Ts(t,e.snapshotVersion.toTimestamp())),n}(this.R,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Fr()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(0,t);n&&(e.labels=n),this.cr(e)},e.prototype.yr=function(t){var e={};e.database=Cs(this.R),e.removeTarget=t,this.cr(e)},e}(kc),xc=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).R=i,s.gr=!1,s}return Object(b.c)(e,t),Object.defineProperty(e.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},e.prototype.ar=function(){this.gr&&this.Er([])},e.prototype.wr=function(t){return this.Hi.Oi("Write",t)},e.prototype.onMessage=function(t){if(Mr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.gr){this.Zi.reset();var e=function(t,e){return t&&t.length>0?(Mr(void 0!==e),t.map((function(t){return function(t,e){var n=Os(t.updateTime?t.updateTime:e);return n.isEqual(Qr.min())&&(n=Os(e)),new Ao(n,t.transformResults||[])}(t,e)}))):[]}(t.writeResults,t.commitTime),n=Os(t.commitTime);return this.listener.Tr(n,e)}return Mr(!t.writeResults||0===t.writeResults.length),this.gr=!0,this.listener.Ir()},e.prototype.Ar=function(){var t={};t.database=Cs(this.R),this.cr(t)},e.prototype.Er=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map((function(t){return Ls(e.R,t)}))};this.cr(n)},e}(kc),Rc=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.Hi=n,i.R=r,i.Rr=!1,i}return Object(b.c)(e,t),e.prototype.br=function(){if(this.Rr)throw new jr(Nr.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.Ni=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then((function(i){return r.Hi.Ni(t,e,n,i)})).catch((function(t){throw"FirebaseError"===t.name?(t.code===Nr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new jr(Nr.UNKNOWN,t.toString())}))},e.prototype.$i=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then((function(i){return r.Hi.$i(t,e,n,i)})).catch((function(t){throw"FirebaseError"===t.name?(t.code===Nr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new jr(Nr.UNKNOWN,t.toString())}))},e.prototype.terminate=function(){this.Rr=!0},e}((function(){})),Pc=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}return t.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()})))},t.prototype.Nr=function(t){"Online"===this.state?this.Dr("Unknown"):(this.vr++,this.vr>=1&&(this.kr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},t.prototype.set=function(t){this.kr(),this.vr=0,"Online"===t&&(this.Vr=!1),this.Dr(t)},t.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.Cr=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Vr?(Rr(e),this.Vr=!1):xr("OnlineStateTracker",e)},t.prototype.kr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},t}(),Lc=function(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Fr=[],this.$r=new Map,this.Or=new Set,this.Mr=[],this.Lr=i,this.Lr.di((function(t){n.enqueueAndForget((function(){return Object(b.b)(o,void 0,void 0,(function(){return Object(b.d)(this,(function(t){switch(t.label){case 0:return zc(this)?(xr("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return Object(b.b)(this,void 0,void 0,(function(){var e;return Object(b.d)(this,(function(n){switch(n.label){case 0:return(e=qr(t)).Or.add(4),[4,Mc(e)];case 1:return n.sent(),e.Br.set("Unknown"),e.Or.delete(4),[4,Fc(e)];case 2:return n.sent(),[2]}}))}))}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))}))})),this.Br=new Pc(n,r)};function Fc(t){return Object(b.b)(this,void 0,void 0,(function(){var e,n;return Object(b.d)(this,(function(r){switch(r.label){case 0:if(!zc(t))return[3,4];e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function Mc(t){return Object(b.b)(this,void 0,void 0,(function(){var e,n;return Object(b.d)(this,(function(r){switch(r.label){case 0:e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function qc(t,e){var n=qr(t);n.$r.has(e.targetId)||(n.$r.set(e.targetId,e),Gc(n)?Kc(n):sh(n).er()&&Vc(n,e))}function Uc(t,e){var n=qr(t),r=sh(n);n.$r.delete(e),r.er()&&Bc(n,e),0===n.$r.size&&(r.er()?r.ir():zc(n)&&n.Br.set("Unknown"))}function Vc(t,e){t.qr.U(e.targetId),sh(t).mr(e)}function Bc(t,e){t.qr.U(e),sh(t).yr(e)}function Kc(t){t.qr=new gs({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},lt:function(e){return t.$r.get(e)||null}}),sh(t).start(),t.Br.Sr()}function Gc(t){return zc(t)&&!sh(t).tr()&&t.$r.size>0}function zc(t){return 0===qr(t).Or.size}function Qc(t){t.qr=void 0}function Hc(t){return Object(b.b)(this,void 0,void 0,(function(){return Object(b.d)(this,(function(e){return t.$r.forEach((function(e,n){Vc(t,e)})),[2]}))}))}function Wc(t,e){return Object(b.b)(this,void 0,void 0,(function(){return Object(b.d)(this,(function(n){return Qc(t),Gc(t)?(t.Br.Nr(e),Kc(t)):t.Br.set("Unknown"),[2]}))}))}function Yc(t,e,n){return Object(b.b)(this,void 0,void 0,(function(){var r,i,o;return Object(b.d)(this,(function(s){switch(s.label){case 0:if(t.Br.set("Online"),!(e instanceof ps&&2===e.state&&e.cause))return[3,6];s.label=1;case 1:return s.trys.push([1,3,,5]),[4,function(t,e){return Object(b.b)(this,void 0,void 0,(function(){var n,r,i,o;return Object(b.d)(this,(function(s){switch(s.label){case 0:n=e.cause,r=0,i=e.targetIds,s.label=1;case 1:return r<i.length?t.$r.has(o=i[r])?[4,t.remoteSyncer.rejectListen(o,n)]:[3,3]:[3,5];case 2:s.sent(),t.$r.delete(o),t.qr.removeTarget(o),s.label=3;case 3:s.label=4;case 4:return r++,[3,1];case 5:return[2]}}))}))}(t,e)];case 2:return s.sent(),[3,5];case 3:return r=s.sent(),xr("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),[4,Xc(t,r)];case 4:return s.sent(),[3,5];case 5:return[3,13];case 6:if(e instanceof fs?t.qr.X(e):e instanceof ds?t.qr.rt(e):t.qr.et(e),n.isEqual(Qr.min()))return[3,13];s.label=7;case 7:return s.trys.push([7,11,,13]),[4,Ku(t.localStore)];case 8:return i=s.sent(),n.compareTo(i)>=0?[4,function(t,e){var n=t.qr.ut(e);return n.targetChanges.forEach((function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=t.$r.get(r);i&&t.$r.set(r,i.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach((function(e){var n=t.$r.get(e);if(n){t.$r.set(e,n.withResumeToken(ei.EMPTY_BYTE_STRING,n.snapshotVersion)),Bc(t,e);var r=new Pa(n.target,e,1,n.sequenceNumber);Vc(t,r)}})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)]:[3,10];case 9:s.sent(),s.label=10;case 10:return[3,13];case 11:return xr("RemoteStore","Failed to raise snapshot:",o=s.sent()),[4,Xc(t,o)];case 12:return s.sent(),[3,13];case 13:return[2]}}))}))}function Xc(t,e,n){return Object(b.b)(this,void 0,void 0,(function(){var r=this;return Object(b.d)(this,(function(i){switch(i.label){case 0:if(!Sa(e))throw e;return t.Or.add(1),[4,Mc(t)];case 1:return i.sent(),t.Br.set("Offline"),n||(n=function(){return Ku(t.localStore)}),t.asyncQueue.enqueueRetryable((function(){return Object(b.b)(r,void 0,void 0,(function(){return Object(b.d)(this,(function(e){switch(e.label){case 0:return xr("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return e.sent(),t.Or.delete(1),[4,Fc(t)];case 2:return e.sent(),[2]}}))}))})),[2]}}))}))}function $c(t,e){return e().catch((function(n){return Xc(t,n,e)}))}function Jc(t){return Object(b.b)(this,void 0,void 0,(function(){var e,n,r,i,o;return Object(b.d)(this,(function(s){switch(s.label){case 0:e=qr(t),n=ah(e),r=e.Fr.length>0?e.Fr[e.Fr.length-1].batchId:-1,s.label=1;case 1:if(!function(t){return zc(t)&&t.Fr.length<10}(e))return[3,7];s.label=2;case 2:return s.trys.push([2,4,,6]),[4,Qu(e.localStore,r)];case 3:return null===(i=s.sent())?(0===e.Fr.length&&n.ir(),[3,7]):(r=i.batchId,function(t,e){t.Fr.push(e);var n=ah(t);n.er()&&n.pr&&n.Er(e.mutations)}(e,i),[3,6]);case 4:return o=s.sent(),[4,Xc(e,o)];case 5:return s.sent(),[3,6];case 6:return[3,1];case 7:return Zc(e)&&th(e),[2]}}))}))}function Zc(t){return zc(t)&&!ah(t).tr()&&t.Fr.length>0}function th(t){ah(t).start()}function eh(t){return Object(b.b)(this,void 0,void 0,(function(){return Object(b.d)(this,(function(e){return ah(t).Ar(),[2]}))}))}function nh(t){return Object(b.b)(this,void 0,void 0,(function(){var e,n,r;return Object(b.d)(this,(function(i){for(e=ah(t),n=0,r=t.Fr;n<r.length;n++)e.Er(r[n].mutations);return[2]}))}))}function rh(t,e,n){return Object(b.b)(this,void 0,void 0,(function(){var r,i;return Object(b.d)(this,(function(o){switch(o.label){case 0:return r=t.Fr.shift(),i=Ra.from(r,e,n),[4,$c(t,(function(){return t.remoteSyncer.applySuccessfulWrite(i)}))];case 1:return o.sent(),[4,Jc(t)];case 2:return o.sent(),[2]}}))}))}function ih(t,e){return Object(b.b)(this,void 0,void 0,(function(){return Object(b.d)(this,(function(n){switch(n.label){case 0:return e&&ah(t).pr?[4,function(t,e){return Object(b.b)(this,void 0,void 0,(function(){var n,r;return Object(b.d)(this,(function(i){switch(i.label){case 0:return Ho(r=e.code)&&r!==Nr.ABORTED?(n=t.Fr.shift(),ah(t).sr(),[4,$c(t,(function(){return t.remoteSyncer.rejectFailedWrite(n.batchId,e)}))]):[3,3];case 1:return i.sent(),[4,Jc(t)];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return Zc(t)&&th(t),[2]}}))}))}function oh(t,e){return Object(b.b)(this,void 0,void 0,(function(){var n;return Object(b.d)(this,(function(r){switch(r.label){case 0:return n=qr(t),e?(n.Or.delete(2),[4,Fc(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.Or.add(2),[4,Mc(n)]);case 3:r.sent(),n.Br.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}}))}))}function sh(t){var e=this;return t.Ur||(t.Ur=function(t,e,n){var r=qr(t);return r.br(),new Cc(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:Hc.bind(null,t),Ri:Wc.bind(null,t),_r:Yc.bind(null,t)}),t.Mr.push((function(n){return Object(b.b)(e,void 0,void 0,(function(){return Object(b.d)(this,(function(e){switch(e.label){case 0:return n?(t.Ur.sr(),Gc(t)?Kc(t):t.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.Ur.stop()];case 2:e.sent(),Qc(t),e.label=3;case 3:return[2]}}))}))}))),t.Ur}function ah(t){var e=this;return t.Kr||(t.Kr=function(t,e,n){var r=qr(t);return r.br(),new xc(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:eh.bind(null,t),Ri:ih.bind(null,t),Ir:nh.bind(null,t),Tr:rh.bind(null,t)}),t.Mr.push((function(n){return Object(b.b)(e,void 0,void 0,(function(){return Object(b.d)(this,(function(e){switch(e.label){case 0:return n?(t.Kr.sr(),[4,Jc(t)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.Kr.stop()];case 3:e.sent(),t.Fr.length>0&&(xr("RemoteStore","Stopping write stream with "+t.Fr.length+" pending writes"),t.Fr=[]),e.label=4;case 4:return[2]}}))}))}))),t.Kr}var uh=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new wa,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((function(t){}))}return t.createAndSchedule=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout((function(){return e.handleDelayElapsed()}),t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new jr(Nr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget((function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then((function(e){return t.deferred.resolve(e)}))):Promise.resolve()}))},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}();function ch(t,e){if(Rr("AsyncQueue",e+": "+t),Sa(t))return new jr(Nr.UNAVAILABLE,e+": "+t);throw t}var hh=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||li.comparator(e.key,n.key)}:function(t,e){return li.comparator(t.key,e.key)},this.keyedMap=rs(),this.sortedSet=new Yo(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal((function(e,n){return t(e),!1}))},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach((function(e){t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}(),lh=function(){function t(){this.Qr=new Yo(li.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.Qr.get(e);n?0!==t.type&&3===n.type?this.Qr=this.Qr.insert(e,t):3===t.type&&1!==n.type?this.Qr=this.Qr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Qr=this.Qr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Qr=this.Qr.remove(e):1===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):Fr():this.Qr=this.Qr.insert(e,t)},t.prototype.jr=function(){var t=[];return this.Qr.inorderTraversal((function(e,n){t.push(n)})),t},t}(),fh=function(){function t(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach((function(t){o.push({type:0,doc:t})})),new t(e,n,hh.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&oo(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),dh=function(){this.Wr=void 0,this.listeners=[]},ph=function(){this.queries=new Iu((function(t){return so(t)}),oo),this.onlineState="Unknown",this.Gr=new Set};function yh(t,e){return Object(b.b)(this,void 0,void 0,(function(){var n,r,i,o,s,a,u;return Object(b.d)(this,(function(c){switch(c.label){case 0:if(n=qr(t),i=!1,(o=n.queries.get(r=e.query))||(i=!0,o=new dh),!i)return[3,4];c.label=1;case 1:return c.trys.push([1,3,,4]),s=o,[4,n.onListen(r)];case 2:return s.Wr=c.sent(),[3,4];case 3:return a=c.sent(),u=ch(a,"Initialization of query '"+ao(e.query)+"' failed"),[2,void e.onError(u)];case 4:return n.queries.set(r,o),o.listeners.push(e),e.zr(n.onlineState),o.Wr&&e.Hr(o.Wr)&&bh(n),[2]}}))}))}function gh(t,e){return Object(b.b)(this,void 0,void 0,(function(){var n,r,i,o,s;return Object(b.d)(this,(function(a){return n=qr(t),i=!1,(o=n.queries.get(r=e.query))&&(s=o.listeners.indexOf(e))>=0&&(o.listeners.splice(s,1),i=0===o.listeners.length),i?[2,(n.queries.delete(r),n.onUnlisten(r))]:[2]}))}))}function vh(t,e){for(var n=qr(t),r=!1,i=0,o=e;i<o.length;i++){var s=o[i],a=n.queries.get(s.query);if(a){for(var u=0,c=a.listeners;u<c.length;u++)c[u].Hr(s)&&(r=!0);a.Wr=s}}r&&bh(n)}function mh(t,e,n){var r=qr(t),i=r.queries.get(e);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.queries.delete(e)}function bh(t){t.Gr.forEach((function(t){t.next()}))}var wh=function(){function t(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new fh(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),o=!0):this.eo(t,this.onlineState)&&(this.no(t),o=!0),this.Xr=t,o},t.prototype.onError=function(t){this.Jr.error(t)},t.prototype.zr=function(t){this.onlineState=t;var e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e},t.prototype.eo=function(t,e){return!t.fromCache||!(this.options.so&&"Offline"!==e||t.docs.isEmpty()&&"Offline"!==e)},t.prototype.Zr=function(t){return t.docChanges.length>0||!!(t.syncStateChanged||this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites)&&!0===this.options.includeMetadataChanges},t.prototype.no=function(t){t=fh.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},t}(),Ih=function(){function t(t,e){this.payload=t,this.byteLength=e}return t.prototype.io=function(){return"metadata"in this.payload},t}(),Th=function(){function t(t){this.R=t}return t.prototype.qn=function(t){return Ns(this.R,t)},t.prototype.Un=function(t){return t.metadata.exists?Ps(this.R,t.document,!1):Di.newNoDocument(this.qn(t.metadata.name),this.Kn(t.metadata.readTime))},t.prototype.Kn=function(t){return Os(t)},t}();!function(){function t(t,e,n){this.ro=t,this.localStore=e,this.R=n,this.queries=[],this.documents=[],this.progress=function(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}(t)}t.prototype.oo=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},t.prototype.co=function(t){for(var e=new Map,n=new Th(this.R),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var s=n.qn(o.metadata.name),a=0,u=o.metadata.queries;a<u.length;a++){var c=u[a],h=(e.get(c)||as()).add(s);e.set(c,h)}}return e},t.prototype.complete=function(){return Object(b.b)(this,void 0,void 0,(function(){var t,e,n,r,i;return Object(b.d)(this,(function(o){switch(o.label){case 0:return[4,Zu(this.localStore,new Th(this.R),this.documents,this.ro.id)];case 1:t=o.sent(),e=this.co(this.documents),n=0,r=this.queries,o.label=2;case 2:return n<r.length?[4,tc(this.localStore,i=r[n],e.get(i.name))]:[3,5];case 3:o.sent(),o.label=4;case 4:return n++,[3,2];case 5:return[2,(this.progress.taskState="Success",new Pu(Object.assign({},this.progress),t))]}}))}))}}();var Eh=function(t){this.key=t},_h=function(t){this.key=t},Oh=function(){function t(t,e){this.query=t,this.uo=e,this.ao=null,this.current=!1,this.ho=as(),this.mutatedKeys=as(),this.lo=co(t),this.fo=new hh(this.lo)}return Object.defineProperty(t.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),t.prototype._o=function(t,e){var n=this,r=e?e.mo:new lh,i=e?e.fo:this.fo,o=e?e.mutatedKeys:this.mutatedKeys,s=i,a=!1,u=$i(this.query)&&i.size===this.query.limit?i.last():null,c=Ji(this.query)&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal((function(t,e){var h=i.get(t),l=uo(n.query,e)?e:null,f=!!h&&n.mutatedKeys.has(h.key),d=!!l&&(l.hasLocalMutations||n.mutatedKeys.has(l.key)&&l.hasCommittedMutations),p=!1;h&&l?h.data.isEqual(l.data)?f!==d&&(r.track({type:3,doc:l}),p=!0):n.yo(h,l)||(r.track({type:2,doc:l}),p=!0,(u&&n.lo(l,u)>0||c&&n.lo(l,c)<0)&&(a=!0)):!h&&l?(r.track({type:0,doc:l}),p=!0):h&&!l&&(r.track({type:1,doc:h}),p=!0,(u||c)&&(a=!0)),p&&(l?(s=s.add(l),o=d?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))})),$i(this.query)||Ji(this.query))for(;s.size>this.query.limit;){var h=$i(this.query)?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{fo:s,mo:r,Nn:a,mutatedKeys:o}},t.prototype.yo=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this,i=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var o=t.mo.jr();o.sort((function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Fr()}};return n(t)-n(e)}(t.type,e.type)||r.lo(t.doc,e.doc)})),this.po(n);var s=e?this.Eo():[],a=0===this.ho.size&&this.current?1:0,u=a!==this.ao;return this.ao=a,0!==o.length||u?{snapshot:new fh(this.query,t.fo,i,o,t.mutatedKeys,0===a,u,!1),To:s}:{To:s}},t.prototype.zr=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new lh,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},t.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},t.prototype.po=function(t){var e=this;t&&(t.addedDocuments.forEach((function(t){return e.uo=e.uo.add(t)})),t.modifiedDocuments.forEach((function(t){})),t.removedDocuments.forEach((function(t){return e.uo=e.uo.delete(t)})),this.current=t.current)},t.prototype.Eo=function(){var t=this;if(!this.current)return[];var e=this.ho;this.ho=as(),this.fo.forEach((function(e){t.Io(e.key)&&(t.ho=t.ho.add(e.key))}));var n=[];return e.forEach((function(e){t.ho.has(e)||n.push(new _h(e))})),this.ho.forEach((function(t){e.has(t)||n.push(new Eh(t))})),n},t.prototype.Ao=function(t){this.uo=t.Bn,this.ho=as();var e=this._o(t.documents);return this.applyChanges(e,!0)},t.prototype.Ro=function(){return fh.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)},t}(),Sh=function(t,e,n){this.query=t,this.targetId=e,this.view=n},Dh=function(t){this.key=t,this.bo=!1},Ah=function(){function t(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.vo={},this.Po=new Iu((function(t){return so(t)}),oo),this.Vo=new Map,this.So=new Set,this.Do=new Yo(li.comparator),this.Co=new Map,this.No=new nc,this.xo={},this.ko=new Map,this.Fo=cu.Yt(),this.onlineState="Unknown",this.$o=void 0}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.$o},enumerable:!1,configurable:!0}),t}();function Nh(t,e){return Object(b.b)(this,void 0,void 0,(function(){var n,r,i,o,s;return Object(b.d)(this,(function(a){switch(a.label){case 0:return n=il(t),(i=n.Po.get(e))?(n.sharedClientState.addLocalQueryTarget(i.targetId),r=i.view.Ro(),[3,4]):[3,1];case 1:return[4,Hu(n.localStore,ro(e))];case 2:return o=a.sent(),s=n.sharedClientState.addLocalQueryTarget(o.targetId),[4,jh(n,e,o.targetId,"current"===s)];case 3:r=a.sent(),n.isPrimaryClient&&qc(n.remoteStore,o),a.label=4;case 4:return[2,r]}}))}))}function jh(t,e,n,r){return Object(b.b)(this,void 0,void 0,(function(){var i,o,s,a,u,c;return Object(b.d)(this,(function(h){switch(h.label){case 0:return t.Oo=function(e,n,r){return function(t,e,n,r){return Object(b.b)(this,void 0,void 0,(function(){var i,o,s;return Object(b.d)(this,(function(a){switch(a.label){case 0:return(i=e.view._o(n)).Nn?[4,Yu(t.localStore,e.query,!1).then((function(t){return e.view._o(t.documents,i)}))]:[3,2];case 1:i=a.sent(),a.label=2;case 2:return o=r&&r.targetChanges.get(e.targetId),s=e.view.applyChanges(i,t.isPrimaryClient,o),[2,(Kh(t,e.targetId,s.To),s.snapshot)]}}))}))}(t,e,n,r)},[4,Yu(t.localStore,e,!0)];case 1:return i=h.sent(),o=new Oh(e,i.Bn),s=o._o(i.documents),a=ls.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState),u=o.applyChanges(s,t.isPrimaryClient,a),Kh(t,n,u.To),c=new Sh(e,n,o),[2,(t.Po.set(e,c),t.Vo.has(n)?t.Vo.get(n).push(e):t.Vo.set(n,[e]),u.snapshot)]}}))}))}function kh(t,e){return Object(b.b)(this,void 0,void 0,(function(){var n,r,i;return Object(b.d)(this,(function(o){switch(o.label){case 0:return n=qr(t),r=n.Po.get(e),(i=n.Vo.get(r.targetId)).length>1?[2,(n.Vo.set(r.targetId,i.filter((function(t){return!oo(t,e)}))),void n.Po.delete(e))]:n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)?[3,2]:[4,Wu(n.localStore,r.targetId,!1).then((function(){n.sharedClientState.clearQueryState(r.targetId),Uc(n.remoteStore,r.targetId),Vh(n,r.targetId)})).catch(pu)]):[3,3];case 1:o.sent(),o.label=2;case 2:return[3,5];case 3:return Vh(n,r.targetId),[4,Wu(n.localStore,r.targetId,!0)];case 4:o.sent(),o.label=5;case 5:return[2]}}))}))}function Ch(t,e,n){return Object(b.b)(this,void 0,void 0,(function(){var r,i,o,s;return Object(b.d)(this,(function(a){switch(a.label){case 0:r=ol(t),a.label=1;case 1:return a.trys.push([1,5,,6]),[4,function(t,e){var n,r=qr(t),i=zr.now(),o=e.reduce((function(t,e){return t.add(e.key)}),as());return r.persistence.runTransaction("Locally write mutations","readwrite",(function(t){return r.Mn.pn(t,o).next((function(o){n=o;for(var s=[],a=0,u=e;a<u.length;a++){var c=u[a],h=Ro(c,n.get(c.key));null!=h&&s.push(new Mo(c.key,h,Si(h.value.mapValue),No.exists(!0)))}return r._n.addMutationBatch(t,i,s,e)}))})).then((function(t){return t.applyToLocalDocumentSet(n),{batchId:t.batchId,changes:n}}))}(r.localStore,e)];case 2:return i=a.sent(),r.sharedClientState.addPendingMutation(i.batchId),function(t,e,n){var r=t.xo[t.currentUser.toKey()];r||(r=new Yo(Br)),r=r.insert(e,n),t.xo[t.currentUser.toKey()]=r}(r,i.batchId,n),[4,Qh(r,i.changes)];case 3:return a.sent(),[4,Jc(r.remoteStore)];case 4:return a.sent(),[3,6];case 5:return o=a.sent(),s=ch(o,"Failed to persist write"),n.reject(s),[3,6];case 6:return[2]}}))}))}function xh(t,e){return Object(b.b)(this,void 0,void 0,(function(){var n,r;return Object(b.d)(this,(function(i){switch(i.label){case 0:n=qr(t),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,Gu(n.localStore,e)];case 2:return r=i.sent(),e.targetChanges.forEach((function(t,e){var r=n.Co.get(e);r&&(Mr(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.bo=!0:t.modifiedDocuments.size>0?Mr(r.bo):t.removedDocuments.size>0&&(Mr(r.bo),r.bo=!1))})),[4,Qh(n,r,e)];case 3:return i.sent(),[3,6];case 4:return[4,pu(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}}))}))}function Rh(t,e,n){var r=qr(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.Po.forEach((function(t,n){var r=n.view.zr(e);r.snapshot&&i.push(r.snapshot)})),function(t,e){var n=qr(t);n.onlineState=e;var r=!1;n.queries.forEach((function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].zr(e)&&(r=!0)})),r&&bh(n)}(r.eventManager,e),i.length&&r.vo._r(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function Ph(t,e,n){return Object(b.b)(this,void 0,void 0,(function(){var r,i,o,s,a,u;return Object(b.d)(this,(function(c){switch(c.label){case 0:return(r=qr(t)).sharedClientState.updateQueryState(e,"rejected",n),i=r.Co.get(e),(o=i&&i.key)?(s=(s=new Yo(li.comparator)).insert(o,Di.newNoDocument(o,Qr.min())),a=as().add(o),u=new hs(Qr.min(),new Map,new Jo(Br),s,a),[4,xh(r,u)]):[3,2];case 1:return c.sent(),r.Do=r.Do.remove(o),r.Co.delete(e),zh(r),[3,4];case 2:return[4,Wu(r.localStore,e,!1).then((function(){return Vh(r,e,n)})).catch(pu)];case 3:c.sent(),c.label=4;case 4:return[2]}}))}))}function Lh(t,e){return Object(b.b)(this,void 0,void 0,(function(){var n,r,i;return Object(b.d)(this,(function(o){switch(o.label){case 0:n=qr(t),r=e.batch.batchId,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,Bu(n.localStore,e)];case 2:return i=o.sent(),Uh(n,r,null),qh(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),[4,Qh(n,i)];case 3:return o.sent(),[3,6];case 4:return[4,pu(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}}))}))}function Fh(t,e,n){return Object(b.b)(this,void 0,void 0,(function(){var r,i;return Object(b.d)(this,(function(o){switch(o.label){case 0:r=qr(t),o.label=1;case 1:return o.trys.push([1,4,,6]),[4,function(t,e){var n=qr(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(function(t){var r;return n._n.lookupMutationBatch(t,e).next((function(e){return Mr(null!==e),r=e.keys(),n._n.removeMutationBatch(t,e)})).next((function(){return n._n.performConsistencyCheck(t)})).next((function(){return n.Mn.pn(t,r)}))}))}(r.localStore,e)];case 2:return i=o.sent(),Uh(r,e,n),qh(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),[4,Qh(r,i)];case 3:return o.sent(),[3,6];case 4:return[4,pu(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}}))}))}function Mh(t,e){return Object(b.b)(this,void 0,void 0,(function(){var n,r,i,o,s;return Object(b.d)(this,(function(a){switch(a.label){case 0:zc((n=qr(t)).remoteStore)||xr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,function(t){var e=qr(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(t){return e._n.getHighestUnacknowledgedBatchId(t)}))}(n.localStore)];case 2:return-1===(r=a.sent())?[2,void e.resolve()]:((i=n.ko.get(r)||[]).push(e),n.ko.set(r,i),[3,4]);case 3:return o=a.sent(),s=ch(o,"Initialization of waitForPendingWrites() operation failed"),e.reject(s),[3,4];case 4:return[2]}}))}))}function qh(t,e){(t.ko.get(e)||[]).forEach((function(t){t.resolve()})),t.ko.delete(e)}function Uh(t,e,n){var r=qr(t),i=r.xo[r.currentUser.toKey()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.xo[r.currentUser.toKey()]=i}}function Vh(t,e,n){void 0===n&&(n=null),t.sharedClientState.removeLocalQueryTarget(e);for(var r=0,i=t.Vo.get(e);r<i.length;r++){var o=i[r];t.Po.delete(o),n&&t.vo.Mo(o,n)}t.Vo.delete(e),t.isPrimaryClient&&t.No.Zn(e).forEach((function(e){t.No.containsKey(e)||Bh(t,e)}))}function Bh(t,e){t.So.delete(e.path.canonicalString());var n=t.Do.get(e);null!==n&&(Uc(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),zh(t))}function Kh(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof Eh?(t.No.addReference(o.key,e),Gh(t,o)):o instanceof _h?(xr("SyncEngine","Document no longer in limbo: "+o.key),t.No.removeReference(o.key,e),t.No.containsKey(o.key)||Bh(t,o.key)):Fr()}}function Gh(t,e){var n=e.key,r=n.path.canonicalString();t.Do.get(n)||t.So.has(r)||(xr("SyncEngine","New document in limbo: "+n),t.So.add(r),zh(t))}function zh(t){for(;t.So.size>0&&t.Do.size<t.maxConcurrentLimboResolutions;){var e=t.So.values().next().value;t.So.delete(e);var n=new li($r.fromString(e)),r=t.Fo.next();t.Co.set(r,new Dh(n)),t.Do=t.Do.insert(n,r),qc(t.remoteStore,new Pa(ro(Xi(n.path)),r,2,Ar.o))}}function Qh(t,e,n){return Object(b.b)(this,void 0,void 0,(function(){var r,i,o,s;return Object(b.d)(this,(function(a){switch(a.label){case 0:return r=qr(t),i=[],o=[],s=[],r.Po.isEmpty()?[3,3]:(r.Po.forEach((function(t,a){s.push(r.Oo(a,e,n).then((function(t){if(t){r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,t.fromCache?"not-current":"current"),i.push(t);var e=Fu.Pn(a.targetId,t);o.push(e)}})))})),[4,Promise.all(s)]);case 1:return a.sent(),r.vo._r(i),[4,function(t,e){return Object(b.b)(this,void 0,void 0,(function(){var n,r,i,o,s,a,u,c;return Object(b.d)(this,(function(h){switch(h.label){case 0:n=qr(t),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(t){return Ia.forEach(e,(function(e){return Ia.forEach(e.bn,(function(r){return n.persistence.referenceDelegate.addReference(t,e.targetId,r)})).next((function(){return Ia.forEach(e.vn,(function(r){return n.persistence.referenceDelegate.removeReference(t,e.targetId,r)}))}))}))}))];case 2:return h.sent(),[3,4];case 3:if(!Sa(r=h.sent()))throw r;return xr("LocalStore","Failed to update sequence numbers: "+r),[3,4];case 4:for(i=0,o=e;i<o.length;i++)a=(s=o[i]).targetId,s.fromCache||(u=n.kn.get(a),c=u.withLastLimboFreeSnapshotVersion(u.snapshotVersion),n.kn=n.kn.insert(a,c));return[2]}}))}))}(r.localStore,o)];case 2:a.sent(),a.label=3;case 3:return[2]}}))}))}function Hh(t,e){return Object(b.b)(this,void 0,void 0,(function(){var n,r;return Object(b.d)(this,(function(i){switch(i.label){case 0:return(n=qr(t)).currentUser.isEqual(e)?[3,3]:(xr("SyncEngine","User change. New user:",e.toKey()),[4,Vu(n.localStore,e)]);case 1:return r=i.sent(),n.currentUser=e,function(t,e){t.ko.forEach((function(t){t.forEach((function(t){t.reject(new jr(Nr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.ko.clear()}(n),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),[4,Qh(n,r.Ln)];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))}function Wh(t,e){var n=qr(t),r=n.Co.get(e);if(r&&r.bo)return as().add(r.key);var i=as(),o=n.Vo.get(e);if(!o)return i;for(var s=0,a=o;s<a.length;s++){var u=n.Po.get(a[s]);i=i.unionWith(u.view.wo)}return i}function Yh(t,e){return Object(b.b)(this,void 0,void 0,(function(){var n,r,i;return Object(b.d)(this,(function(o){switch(o.label){case 0:return[4,Yu((n=qr(t)).localStore,e.query,!0)];case 1:return r=o.sent(),i=e.view.Ao(r),[2,(n.isPrimaryClient&&Kh(n,e.targetId,i.To),i)]}}))}))}function Xh(t){return Object(b.b)(this,void 0,void 0,(function(){var e;return Object(b.d)(this,(function(n){return[2,$u((e=qr(t)).localStore).then((function(t){return Qh(e,t)}))]}))}))}function $h(t,e,n,r){return Object(b.b)(this,void 0,void 0,(function(){var i,o;return Object(b.d)(this,(function(s){switch(s.label){case 0:return[4,function(t,e){var n=qr(t),r=qr(n._n);return n.persistence.runTransaction("Lookup mutation documents","readonly",(function(t){return r.jt(t,e).next((function(e){return e?n.Mn.pn(t,e):Ia.resolve(null)}))}))}((i=qr(t)).localStore,e)];case 1:return null===(o=s.sent())?[3,6]:"pending"!==n?[3,3]:[4,Jc(i.remoteStore)];case 2:return s.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(Uh(i,e,r||null),qh(i,e),function(t,e){qr(qr(t)._n).Gt(e)}(i.localStore,e)):Fr(),s.label=4;case 4:return[4,Qh(i,o)];case 5:return s.sent(),[3,7];case 6:xr("SyncEngine","Cannot apply mutation batch with id: "+e),s.label=7;case 7:return[2]}}))}))}function Jh(t,e){return Object(b.b)(this,void 0,void 0,(function(){var n,r,i,o,s,a,u;return Object(b.d)(this,(function(c){switch(c.label){case 0:return il(n=qr(t)),ol(n),!0!==e||!0===n.$o?[3,3]:(r=n.sharedClientState.getAllActiveQueryTargets(),[4,Zh(n,r.toArray())]);case 1:return i=c.sent(),n.$o=!0,[4,oh(n.remoteStore,!0)];case 2:for(c.sent(),o=0,s=i;o<s.length;o++)qc(n.remoteStore,s[o]);return[3,7];case 3:return!1!==e||!1===n.$o?[3,7]:(a=[],u=Promise.resolve(),n.Vo.forEach((function(t,e){n.sharedClientState.isLocalQueryTarget(e)?a.push(e):u=u.then((function(){return Vh(n,e),Wu(n.localStore,e,!0)})),Uc(n.remoteStore,e)})),[4,u]);case 4:return c.sent(),[4,Zh(n,a)];case 5:return c.sent(),function(t){var e=qr(t);e.Co.forEach((function(t,n){Uc(e.remoteStore,n)})),e.No.ts(),e.Co=new Map,e.Do=new Yo(li.comparator)}(n),n.$o=!1,[4,oh(n.remoteStore,!1)];case 6:c.sent(),c.label=7;case 7:return[2]}}))}))}function Zh(t,e,n){return Object(b.b)(this,void 0,void 0,(function(){var n,r,i,o,s,a,u,c,h,l,f,d,p;return Object(b.d)(this,(function(y){switch(y.label){case 0:n=qr(t),r=[],i=[],o=0,s=e,y.label=1;case 1:return o<s.length?(u=void 0,(c=n.Vo.get(a=s[o]))&&0!==c.length?[4,Hu(n.localStore,ro(c[0]))]:[3,7]):[3,13];case 2:u=y.sent(),h=0,l=c,y.label=3;case 3:return h<l.length?(f=n.Po.get(l[h]),[4,Yh(n,f)]):[3,6];case 4:(d=y.sent()).snapshot&&i.push(d.snapshot),y.label=5;case 5:return h++,[3,3];case 6:return[3,11];case 7:return[4,Xu(n.localStore,a)];case 8:return p=y.sent(),[4,Hu(n.localStore,p)];case 9:return u=y.sent(),[4,jh(n,tl(p),a,!1)];case 10:y.sent(),y.label=11;case 11:r.push(u),y.label=12;case 12:return o++,[3,1];case 13:return[2,(n.vo._r(i),r)]}}))}))}function tl(t){return Yi(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function el(t){var e=qr(t);return qr(qr(e.localStore).persistence).fn()}function nl(t,e,n,r){return Object(b.b)(this,void 0,void 0,(function(){var i,o,s;return Object(b.d)(this,(function(a){switch(a.label){case 0:return(i=qr(t)).$o?(xr("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!i.Vo.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,$u(i.localStore)];case 3:return o=a.sent(),s=hs.createSynthesizedRemoteEventForCurrentChange(e,"current"===n),[4,Qh(i,o,s)];case 4:return a.sent(),[3,8];case 5:return[4,Wu(i.localStore,e,!0)];case 6:return a.sent(),Vh(i,e,r),[3,8];case 7:Fr(),a.label=8;case 8:return[2]}}))}))}function rl(t,e,n){return Object(b.b)(this,void 0,void 0,(function(){var r,i,o,s,a,u,c,h,l;return Object(b.d)(this,(function(f){switch(f.label){case 0:if(!(r=il(t)).$o)return[3,10];i=0,o=e,f.label=1;case 1:return i<o.length?r.Vo.has(s=o[i])?(xr("SyncEngine","Adding an already active target "+s),[3,5]):[4,Xu(r.localStore,s)]:[3,6];case 2:return a=f.sent(),[4,Hu(r.localStore,a)];case 3:return u=f.sent(),[4,jh(r,tl(a),u.targetId,!1)];case 4:f.sent(),qc(r.remoteStore,u),f.label=5;case 5:return i++,[3,1];case 6:c=function(t){return Object(b.d)(this,(function(e){switch(e.label){case 0:return r.Vo.has(t)?[4,Wu(r.localStore,t,!1).then((function(){Uc(r.remoteStore,t),Vh(r,t)})).catch(pu)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))},h=0,l=n,f.label=7;case 7:return h<l.length?[5,c(l[h])]:[3,10];case 8:f.sent(),f.label=9;case 9:return h++,[3,7];case 10:return[2]}}))}))}function il(t){var e=qr(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=xh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Wh.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Ph.bind(null,e),e.vo._r=vh.bind(null,e.eventManager),e.vo.Mo=mh.bind(null,e.eventManager),e}function ol(t){var e=qr(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Lh.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Fh.bind(null,e),e}var sl=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return Object(b.b)(this,void 0,void 0,(function(){return Object(b.d)(this,(function(e){switch(e.label){case 0:return this.R=Nc(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return e.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Ko(t),[2]}}))}))},t.prototype.Uo=function(t){return null},t.prototype.Ko=function(t){return Uu(this.persistence,new Mu,t.initialUser,this.R)},t.prototype.qo=function(t){return new uc(hc.bs,this.R)},t.prototype.Bo=function(t){return new Ic},t.prototype.terminate=function(){return Object(b.b)(this,void 0,void 0,(function(){return Object(b.d)(this,(function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}}))}))},t}(),al=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Qo=e,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return Object(b.c)(e,t),e.prototype.initialize=function(e){return Object(b.b)(this,void 0,void 0,(function(){var n=this;return Object(b.d)(this,(function(r){switch(r.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return r.sent(),[4,Ju(this.localStore)];case 2:return r.sent(),[4,this.Qo.initialize(this,e)];case 3:return r.sent(),[4,ol(this.Qo.syncEngine)];case 4:return r.sent(),[4,Jc(this.Qo.remoteStore)];case 5:return r.sent(),[4,this.persistence.He((function(){return n.gcScheduler&&!n.gcScheduler.started&&n.gcScheduler.start(n.localStore),Promise.resolve()}))];case 6:return r.sent(),[2]}}))}))},e.prototype.Ko=function(t){return Uu(this.persistence,new Mu,t.initialUser,this.R)},e.prototype.Uo=function(t){return new vu(this.persistence.referenceDelegate.garbageCollector,t.asyncQueue)},e.prototype.qo=function(t){var e=Ru(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?eu.withCacheSize(this.cacheSizeBytes):eu.DEFAULT;return new ku(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,Dc(),Ac(),this.R,this.sharedClientState,!!this.forceOwnership)},e.prototype.Bo=function(t){return new Ic},e}(sl),ul=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n,!1)||this).Qo=e,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return Object(b.c)(e,t),e.prototype.initialize=function(e){return Object(b.b)(this,void 0,void 0,(function(){var n,r=this;return Object(b.d)(this,(function(i){switch(i.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return i.sent(),n=this.Qo.syncEngine,this.sharedClientState instanceof wc?(this.sharedClientState.syncEngine={ui:$h.bind(null,n),ai:nl.bind(null,n),hi:rl.bind(null,n),fn:el.bind(null,n),ci:Xh.bind(null,n)},[4,this.sharedClientState.start()]):[3,3];case 2:i.sent(),i.label=3;case 3:return[4,this.persistence.He((function(t){return Object(b.b)(r,void 0,void 0,(function(){return Object(b.d)(this,(function(e){switch(e.label){case 0:return[4,Jh(this.Qo.syncEngine,t)];case 1:return e.sent(),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop()),[2]}}))}))}))];case 4:return i.sent(),[2]}}))}))},e.prototype.Bo=function(t){var e=Dc();if(!wc.yt(e))throw new jr(Nr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=Ru(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new wc(e,t.asyncQueue,n,t.clientId,t.initialUser)},e}(al),cl=function(){function t(){}return t.prototype.initialize=function(t,e){return Object(b.b)(this,void 0,void 0,(function(){var n=this;return Object(b.d)(this,(function(r){switch(r.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return Rh(n.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=Hh.bind(null,this.syncEngine),[4,oh(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},t.prototype.createEventManager=function(t){return new ph},t.prototype.createDatastore=function(t){var e=Nc(t.databaseInfo.databaseId),n=new Sc(t.databaseInfo);return function(t,e,n){return new Rc(t,e,n)}(t.credentials,n,e)},t.prototype.createRemoteStore=function(t){var e,n,r,i,o,s=this;return e=this.localStore,n=this.datastore,r=t.asyncQueue,i=function(t){return Rh(s.syncEngine,t,0)},o=Ec.yt()?new Ec:new Tc,new Lc(e,n,r,i,o)},t.prototype.createSyncEngine=function(t,e){return function(t,e,n,r,i,o,s){var a=new Ah(t,e,n,r,i,o);return s&&(a.$o=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)},t.prototype.terminate=function(){return function(t){return Object(b.b)(this,void 0,void 0,(function(){var e;return Object(b.d)(this,(function(n){switch(n.label){case 0:return e=qr(t),xr("RemoteStore","RemoteStore shutting down."),e.Or.add(5),[4,Mc(e)];case 1:return n.sent(),e.Lr.shutdown(),e.Br.set("Unknown"),[2]}}))}))}(this.remoteStore)},t}(),hl=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.Wo=function(){this.muted=!0},t.prototype.jo=function(t,e){var n=this;this.muted||setTimeout((function(){n.muted||t(e)}),0)},t}(),ll=(function(){function t(t,e){var n=this;this.Go=t,this.R=e,this.metadata=new wa,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then((function(t){t&&t.io()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))}),(function(t){return n.metadata.reject(t)}))}t.prototype.close=function(){return this.Go.cancel()},t.prototype.getMetadata=function(){return Object(b.b)(this,void 0,void 0,(function(){return Object(b.d)(this,(function(t){return[2,this.metadata.promise]}))}))},t.prototype.Lo=function(){return Object(b.b)(this,void 0,void 0,(function(){return Object(b.d)(this,(function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.Ho())]}}))}))},t.prototype.Ho=function(){return Object(b.b)(this,void 0,void 0,(function(){var t,e,n,r;return Object(b.d)(this,(function(i){switch(i.label){case 0:return[4,this.Jo()];case 1:return null===(t=i.sent())?[2,null]:(e=this.zo.decode(t),n=Number(e),isNaN(n)&&this.Yo("length string ("+e+") is not valid number"),[4,this.Xo(n)]);case 2:return r=i.sent(),[2,new Ih(JSON.parse(r),t.length+n)]}}))}))},t.prototype.Zo=function(){return this.buffer.findIndex((function(t){return t==="{".charCodeAt(0)}))},t.prototype.Jo=function(){return Object(b.b)(this,void 0,void 0,(function(){var t,e;return Object(b.d)(this,(function(n){switch(n.label){case 0:return this.Zo()<0?[4,this.tc()]:[3,3];case 1:if(n.sent())return[3,3];n.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((t=this.Zo())<0&&this.Yo("Reached the end of bundle when a length string is expected."),e=this.buffer.slice(0,t),[2,(this.buffer=this.buffer.slice(t),e)])}}))}))},t.prototype.Xo=function(t){return Object(b.b)(this,void 0,void 0,(function(){var e;return Object(b.d)(this,(function(n){switch(n.label){case 0:return this.buffer.length<t?[4,this.tc()]:[3,3];case 1:n.sent()&&this.Yo("Reached the end of bundle when more is expected."),n.label=2;case 2:return[3,0];case 3:return e=this.zo.decode(this.buffer.slice(0,t)),[2,(this.buffer=this.buffer.slice(t),e)]}}))}))},t.prototype.Yo=function(t){throw this.Go.cancel(),new Error("Invalid bundle format: "+t)},t.prototype.tc=function(){return Object(b.b)(this,void 0,void 0,(function(){var t,e;return Object(b.d)(this,(function(n){switch(n.label){case 0:return[4,this.Go.read()];case 1:return(t=n.sent()).done||((e=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e),[2,t.done]}}))}))}}(),function(){function t(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return t.prototype.lookup=function(t){return Object(b.b)(this,void 0,void 0,(function(){var e,n=this;return Object(b.d)(this,(function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new jr(Nr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return Object(b.b)(this,void 0,void 0,(function(){var n,r,i,o,s,a;return Object(b.d)(this,(function(u){switch(u.label){case 0:return n=qr(t),r=Cs(n.R)+"/documents",i={documents:e.map((function(t){return As(n.R,t)}))},[4,n.$i("BatchGetDocuments",r,i)];case 1:return o=u.sent(),s=new Map,o.forEach((function(t){var e=function(t,e){return"found"in e?function(t,e){Mr(!!e.found);var n=Ns(t,e.found.name),r=Os(e.found.updateTime),i=new Oi({mapValue:{fields:e.found.fields}});return Di.newFoundDocument(n,r,i)}(t,e):"missing"in e?function(t,e){Mr(!!e.missing),Mr(!!e.readTime);var n=Ns(t,e.missing),r=Os(e.readTime);return Di.newNoDocument(n,r)}(t,e):Fr()}(n.R,t);s.set(e.key.toString(),e)})),a=[],[2,(e.forEach((function(t){var e=s.get(t.toString());Mr(!!e),a.push(e)})),a)]}}))}))}(this.datastore,t)];case 1:return[2,((e=r.sent()).forEach((function(t){return n.recordVersion(t)})),e)]}}))}))},t.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())},t.prototype.delete=function(t){this.write(new Go(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.commit=function(){return Object(b.b)(this,void 0,void 0,(function(){var t,e=this;return Object(b.d)(this,(function(n){switch(n.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach((function(e){t.delete(e.key.toString())})),t.forEach((function(t,n){var r=li.fromPath(n);e.mutations.push(new zo(r,e.precondition(r)))})),[4,function(t,e){return Object(b.b)(this,void 0,void 0,(function(){var n,r,i;return Object(b.d)(this,(function(o){switch(o.label){case 0:return n=qr(t),r=Cs(n.R)+"/documents",i={writes:e.map((function(t){return Ls(n.R,t)}))},[4,n.Ni("Commit",r,i)];case 1:return o.sent(),[2]}}))}))}(this.datastore,this.mutations)];case 1:return n.sent(),this.committed=!0,[2]}}))}))},t.prototype.recordVersion=function(t){var e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw Fr();e=Qr.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new jr(Nr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?No.updateTime(e):No.none()},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(Qr.min()))throw new jr(Nr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return No.updateTime(e)}return No.exists(!0)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},t.prototype.ensureCommitNotCalled=function(){},t}()),fl=function(){function t(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new jc(this.asyncQueue,"transaction_retry")}return t.prototype.run=function(){this.ec-=1,this.nc()},t.prototype.nc=function(){var t=this;this.Zi.ji((function(){return Object(b.b)(t,void 0,void 0,(function(){var t,e,n=this;return Object(b.d)(this,(function(r){return t=new ll(this.datastore),(e=this.sc(t))&&e.then((function(e){n.asyncQueue.enqueueAndForget((function(){return t.commit().then((function(){n.deferred.resolve(e)})).catch((function(t){n.ic(t)}))}))})).catch((function(t){n.ic(t)})),[2]}))}))}))},t.prototype.sc=function(t){try{var e=this.updateFunction(t);return!ui(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},t.prototype.ic=function(t){var e=this;this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget((function(){return e.nc(),Promise.resolve()}))):this.deferred.reject(t)},t.prototype.rc=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!Ho(e)}return!1},t}(),dl=function(){function t(t,e,n){var r=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=lc.UNAUTHENTICATED,this.clientId=Vr.u(),this.credentialListener=function(){return Promise.resolve()},this.credentials.setChangeListener(e,(function(t){return Object(b.b)(r,void 0,void 0,(function(){return Object(b.d)(this,(function(e){switch(e.label){case 0:return xr("FirestoreClient","Received user=",t.uid),[4,this.credentialListener(t)];case 1:return e.sent(),this.user=t,[2]}}))}))}))}return t.prototype.getConfiguration=function(){return Object(b.b)(this,void 0,void 0,(function(){return Object(b.d)(this,(function(t){return[2,{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}]}))}))},t.prototype.setCredentialChangeListener=function(t){this.credentialListener=t},t.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new jr(Nr.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var e=new wa;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((function(){return Object(b.b)(t,void 0,void 0,(function(){var t,n;return Object(b.d)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:r.sent(),r.label=4;case 4:return this.credentials.removeChangeListener(),e.resolve(),[3,6];case 5:return t=r.sent(),n=ch(t,"Failed to shutdown persistence"),e.reject(n),[3,6];case 6:return[2]}}))}))})),e.promise},t}();function pl(t,e){return Object(b.b)(this,void 0,void 0,(function(){var n,r,i=this;return Object(b.d)(this,(function(o){switch(o.label){case 0:return t.asyncQueue.verifyOperationInProgress(),xr("FirestoreClient","Initializing OfflineComponentProvider"),[4,t.getConfiguration()];case 1:return n=o.sent(),[4,e.initialize(n)];case 2:return o.sent(),r=n.initialUser,t.setCredentialChangeListener((function(t){return Object(b.b)(i,void 0,void 0,(function(){return Object(b.d)(this,(function(n){switch(n.label){case 0:return r.isEqual(t)?[3,2]:[4,Vu(e.localStore,t)];case 1:n.sent(),r=t,n.label=2;case 2:return[2]}}))}))})),e.persistence.setDatabaseDeletedListener((function(){return t.terminate()})),t.offlineComponents=e,[2]}}))}))}function yl(t,e){return Object(b.b)(this,void 0,void 0,(function(){var n,r;return Object(b.d)(this,(function(i){switch(i.label){case 0:return t.asyncQueue.verifyOperationInProgress(),[4,gl(t)];case 1:return n=i.sent(),xr("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return r=i.sent(),[4,e.initialize(n,r)];case 3:return i.sent(),t.setCredentialChangeListener((function(t){return function(t,e){return Object(b.b)(this,void 0,void 0,(function(){var n,r;return Object(b.d)(this,(function(i){switch(i.label){case 0:return(n=qr(t)).asyncQueue.verifyOperationInProgress(),xr("RemoteStore","RemoteStore received new credentials"),r=zc(n),n.Or.add(3),[4,Mc(n)];case 1:return i.sent(),r&&n.Br.set("Unknown"),[4,n.remoteSyncer.handleCredentialChange(e)];case 2:return i.sent(),n.Or.delete(3),[4,Fc(n)];case 3:return i.sent(),[2]}}))}))}(e.remoteStore,t)})),t.onlineComponents=e,[2]}}))}))}function gl(t){return Object(b.b)(this,void 0,void 0,(function(){return Object(b.d)(this,(function(e){switch(e.label){case 0:return t.offlineComponents?[3,2]:(xr("FirestoreClient","Using default OfflineComponentProvider"),[4,pl(t,new sl)]);case 1:e.sent(),e.label=2;case 2:return[2,t.offlineComponents]}}))}))}function vl(t){return Object(b.b)(this,void 0,void 0,(function(){return Object(b.d)(this,(function(e){switch(e.label){case 0:return t.onlineComponents?[3,2]:(xr("FirestoreClient","Using default OnlineComponentProvider"),[4,yl(t,new cl)]);case 1:e.sent(),e.label=2;case 2:return[2,t.onlineComponents]}}))}))}function ml(t){return gl(t).then((function(t){return t.persistence}))}function bl(t){return gl(t).then((function(t){return t.localStore}))}function wl(t){return vl(t).then((function(t){return t.remoteStore}))}function Il(t){return vl(t).then((function(t){return t.syncEngine}))}function Tl(t){return Object(b.b)(this,void 0,void 0,(function(){var e,n;return Object(b.d)(this,(function(r){switch(r.label){case 0:return[4,vl(t)];case 1:return e=r.sent(),[2,((n=e.eventManager).onListen=Nh.bind(null,e.syncEngine),n.onUnlisten=kh.bind(null,e.syncEngine),n)]}}))}))}function El(t,e,n){var r=this;void 0===n&&(n={});var i=new wa;return t.asyncQueue.enqueueAndForget((function(){return Object(b.b)(r,void 0,void 0,(function(){var r;return Object(b.d)(this,(function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new hl({next:function(o){e.enqueueAndForget((function(){return gh(t,s)}));var a=o.docs.has(n);!a&&o.fromCache?i.reject(new jr(Nr.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&o.fromCache&&r&&"server"===r.source?i.reject(new jr(Nr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),s=new wh(Xi(n.path),o,{includeMetadataChanges:!0,so:!0});return yh(t,s)},[4,Tl(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}}))}))})),i.promise}function _l(t,e,n){var r=this;void 0===n&&(n={});var i=new wa;return t.asyncQueue.enqueueAndForget((function(){return Object(b.b)(r,void 0,void 0,(function(){var r;return Object(b.d)(this,(function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new hl({next:function(n){e.enqueueAndForget((function(){return gh(t,s)})),n.fromCache&&"server"===r.source?i.reject(new jr(Nr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),s=new wh(n,o,{includeMetadataChanges:!0,so:!0});return yh(t,s)},[4,Tl(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}}))}))})),i.promise}var Ol=function(t,e,n,r,i,o,s,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s,this.useFetchStreams=a},Sl=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t}(),Dl=new Map,Al=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t},Nl=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){this.changeListener=e,t.enqueueRetryable((function(){return e(lc.UNAUTHENTICATED)}))},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),jl=function(){function t(t){this.token=t,this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(this.token)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){var n=this;this.changeListener=e,t.enqueueRetryable((function(){return e(n.token.user)}))},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),kl=function(){function t(t){var e=this;this.currentUser=lc.UNAUTHENTICATED,this.oc=new wa,this.cc=0,this.forceRefresh=!1,this.auth=null,this.asyncQueue=null,this.uc=function(){e.cc++,e.currentUser=e.ac(),e.oc.resolve(),e.changeListener&&e.asyncQueue.enqueueRetryable((function(){return e.changeListener(e.currentUser)}))};var n=function(t){xr("FirebaseCredentialsProvider","Auth detected"),e.auth=t,e.auth.addAuthTokenListener(e.uc)};t.onInit((function(t){return n(t)})),setTimeout((function(){if(!e.auth){var r=t.getImmediate({optional:!0});r?n(r):(xr("FirebaseCredentialsProvider","Auth not yet detected"),e.oc.resolve())}}),0)}return t.prototype.getToken=function(){var t=this,e=this.cc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return t.cc!==e?(xr("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(Mr("string"==typeof n.accessToken),new Al(n.accessToken,t.currentUser)):null})):Promise.resolve(null)},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t,e){var n=this;this.asyncQueue=t,this.asyncQueue.enqueueRetryable((function(){return Object(b.b)(n,void 0,void 0,(function(){return Object(b.d)(this,(function(t){switch(t.label){case 0:return[4,this.oc.promise];case 1:return t.sent(),[4,e(this.currentUser)];case 2:return t.sent(),this.changeListener=e,[2]}}))}))}))},t.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.uc),this.changeListener=function(){return Promise.resolve()}},t.prototype.ac=function(){var t=this.auth&&this.auth.getUid();return Mr(null===t||"string"==typeof t),new lc(t)},t}(),Cl=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n,this.type="FirstParty",this.user=lc.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.lc},e=this.hc.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.fc&&(t["X-Goog-Iam-Authorization-Token"]=this.fc),t},enumerable:!1,configurable:!0}),t}(),xl=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n}return t.prototype.getToken=function(){return Promise.resolve(new Cl(this.hc,this.lc,this.fc))},t.prototype.setChangeListener=function(t,e){t.enqueueRetryable((function(){return e(lc.FIRST_PARTY)}))},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();function Rl(t,e,n){if(!n)throw new jr(Nr.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function Pl(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new jr(Nr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function Ll(t,e,n,r){if(!0===e&&!0===r)throw new jr(Nr.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function Fl(t){if(!li.isDocumentKey(t))throw new jr(Nr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function Ml(t){if(li.isDocumentKey(t))throw new jr(Nr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function ql(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":Fr()}function Ul(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new jr(Nr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=ql(t);throw new jr(Nr.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+n)}return t}function Vl(t,e){if(e<=0)throw new jr(Nr.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var Bl=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new jr(Nr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new jr(Nr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,Ll("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams},t}(),Kl=function(){function t(t,e){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Bl({}),this._settingsFrozen=!1,t instanceof Sl?(this._databaseId=t,this._credentials=new Nl):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new jr(Nr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Sl(t.options.projectId)}(t),this._credentials=new kl(e))}return Object.defineProperty(t.prototype,"app",{get:function(){if(!this._app)throw new jr(Nr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),t.prototype._setSettings=function(t){if(this._settingsFrozen)throw new jr(Nr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Bl(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new Nl;switch(t.type){case"gapi":var e=t.client;return Mr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new xl(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new jr(Nr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},t.prototype._getSettings=function(){return this._settings},t.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},t.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},t.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},t.prototype._terminate=function(){return(t=Dl.get(this))&&(xr("ComponentProvider","Removing Datastore"),Dl.delete(this),t.terminate()),Promise.resolve();var t},t}(),Gl=function(){function t(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}return Object.defineProperty(t.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new Ql(this.firestore,this.converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(e){return new t(this.firestore,e,this._key)},t}(),zl=function(){function t(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}return t.prototype.withConverter=function(e){return new t(this.firestore,e,this._query)},t}(),Ql=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,Xi(r))||this)._path=r,i.type="collection",i}return Object(b.c)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new Gl(this.firestore,null,new li(t))},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this._path)},e}(zl);function Hl(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=Object(w.n)(t),Rl("collection","path",e),t instanceof Kl)return Ml(n=$r.fromString.apply($r,Object(b.f)([e],r))),new Ql(t,null,n);if(!(t instanceof Gl||t instanceof Ql))throw new jr(Nr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Ml(n=$r.fromString.apply($r,Object(b.f)([t.path],r)).child($r.fromString(e))),new Ql(t.firestore,null,n)}function Wl(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=Object(w.n)(t),1===arguments.length&&(e=Vr.u()),Rl("doc","path",e),t instanceof Kl)return Fl(n=$r.fromString.apply($r,Object(b.f)([e],r))),new Gl(t,null,new li(n));if(!(t instanceof Gl||t instanceof Ql))throw new jr(Nr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Fl(n=t._path.child($r.fromString.apply($r,Object(b.f)([e],r)))),new Gl(t.firestore,t instanceof Ql?t.converter:null,new li(n))}function Yl(t,e){return t=Object(w.n)(t),e=Object(w.n)(e),(t instanceof Gl||t instanceof Ql)&&(e instanceof Gl||e instanceof Ql)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function Xl(t,e){return t=Object(w.n)(t),e=Object(w.n)(e),t instanceof zl&&e instanceof zl&&t.firestore===e.firestore&&oo(t._query,e._query)&&t.converter===e.converter}var $l=function(){function t(){var t=this;this.dc=Promise.resolve(),this.wc=[],this._c=!1,this.mc=[],this.yc=null,this.gc=!1,this.Ec=!1,this.Tc=[],this.Zi=new jc(this,"async_queue_retry"),this.Ic=function(){var e=Ac();e&&xr("AsyncQueue","Visibility state changed to "+e.visibilityState),t.Zi.Gi()};var e=Ac();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Ic)}return Object.defineProperty(t.prototype,"isShuttingDown",{get:function(){return this._c},enumerable:!1,configurable:!0}),t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Ac(),this.Rc(t)},t.prototype.enterRestrictedMode=function(t){if(!this._c){this._c=!0,this.Ec=t||!1;var e=Ac();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Ic)}},t.prototype.enqueue=function(t){var e=this;if(this.Ac(),this._c)return new Promise((function(){}));var n=new wa;return this.Rc((function(){return e._c&&e.Ec?Promise.resolve():(t().then(n.resolve,n.reject),n.promise)})).then((function(){return n.promise}))},t.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget((function(){return e.wc.push(t),e.bc()}))},t.prototype.bc=function(){return Object(b.b)(this,void 0,void 0,(function(){var t,e=this;return Object(b.d)(this,(function(n){switch(n.label){case 0:if(0===this.wc.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.wc[0]()];case 2:return n.sent(),this.wc.shift(),this.Zi.reset(),[3,4];case 3:if(!Sa(t=n.sent()))throw t;return xr("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.wc.length>0&&this.Zi.ji((function(){return e.bc()})),n.label=5;case 5:return[2]}}))}))},t.prototype.Rc=function(t){var e=this,n=this.dc.then((function(){return e.gc=!0,t().catch((function(t){throw e.yc=t,e.gc=!1,Rr("INTERNAL UNHANDLED ERROR: ",function(t){var e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t})).then((function(t){return e.gc=!1,t}))}));return this.dc=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.Ac(),this.Tc.indexOf(t)>-1&&(e=0);var i=uh.createAndSchedule(this,t,e,n,(function(t){return r.vc(t)}));return this.mc.push(i),i},t.prototype.Ac=function(){this.yc&&Fr()},t.prototype.verifyOperationInProgress=function(){},t.prototype.Pc=function(){return Object(b.b)(this,void 0,void 0,(function(){var t;return Object(b.d)(this,(function(e){switch(e.label){case 0:return[4,t=this.dc];case 1:e.sent(),e.label=2;case 2:if(t!==this.dc)return[3,0];e.label=3;case 3:return[2]}}))}))},t.prototype.Vc=function(t){for(var e=0,n=this.mc;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},t.prototype.Sc=function(t){var e=this;return this.Pc().then((function(){e.mc.sort((function(t,e){return t.targetTimeMs-e.targetTimeMs}));for(var n=0,r=e.mc;n<r.length;n++){var i=r[n];if(i.skipDelay(),"all"!==t&&i.timerId===t)break}return e.Pc()}))},t.prototype.Dc=function(t){this.Tc.push(t)},t.prototype.vc=function(t){var e=this.mc.indexOf(t);this.mc.splice(e,1)},t}();function Jl(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}!function(){function t(){this._progressObserver={},this._taskCompletionResolver=new wa,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}t.prototype.onProgress=function(t,e,n){this._progressObserver={next:t,error:e,complete:n}},t.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},t.prototype.then=function(t,e){return this._taskCompletionResolver.promise.then(t,e)},t.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},t.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},t.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}();var Zl=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).type="firestore",r._queue=new $l,r._persistenceKey="name"in e?e.name:"[DEFAULT]",r}return Object(b.c)(e,t),e.prototype._terminate=function(){return this._firestoreClient||ef(this),this._firestoreClient.terminate()},e}(Kl);function tf(t){return t._firestoreClient||ef(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function ef(t){var e,n=t._freezeSettings(),r=function(t,e,n,r){return new Ol(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new dl(t._credentials,t._queue,r)}function nf(t,e,n){var r=this,i=new wa;return t.asyncQueue.enqueue((function(){return Object(b.b)(r,void 0,void 0,(function(){var r;return Object(b.d)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,pl(t,n)];case 1:return o.sent(),[4,yl(t,e)];case 2:return o.sent(),i.resolve(),[3,4];case 3:if(!function(t){return"FirebaseError"===t.name?t.code===Nr.FAILED_PRECONDITION||t.code===Nr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(r=o.sent()))throw r;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+r),i.reject(r),[3,4];case 4:return[2]}}))}))})).then((function(){return i.promise}))}function rf(t){if(t._initialized||t._terminated)throw new jr(Nr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var of=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new jr(Nr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Zr(t)}return t.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},t}(),sf=function(){function t(t){this._byteString=t}return t.fromBase64String=function(e){try{return new t(ei.fromBase64String(e))}catch(e){throw new jr(Nr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}},t.fromUint8Array=function(e){return new t(ei.fromUint8Array(e))},t.prototype.toBase64=function(){return this._byteString.toBase64()},t.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},t}(),af=function(t){this._methodName=t},uf=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new jr(Nr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new jr(Nr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},t.prototype._compareTo=function(t){return Br(this._lat,t._lat)||Br(this._long,t._long)},t}(),cf=/^__.*__$/,hf=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return null!==this.fieldMask?new Mo(t,this.data,this.fieldMask,e,this.fieldTransforms):new Fo(t,this.data,e,this.fieldTransforms)},t}(),lf=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return new Mo(t,this.data,this.fieldMask,e,this.fieldTransforms)},t}();function ff(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Fr()}}var df=function(){function t(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Cc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Nc",{get:function(){return this.settings.Nc},enumerable:!1,configurable:!0}),t.prototype.xc=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},t.prototype.kc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.xc({path:n,Fc:!1});return r.$c(t),r},t.prototype.Oc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.xc({path:n,Fc:!1});return r.Cc(),r},t.prototype.Mc=function(t){return this.xc({path:void 0,Fc:!0})},t.prototype.Lc=function(t){return xf(t,this.settings.methodName,this.settings.Bc||!1,this.path,this.settings.qc)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find((function(e){return t.isPrefixOf(e)}))||void 0!==this.fieldTransforms.find((function(e){return t.isPrefixOf(e.field)}))},t.prototype.Cc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.$c(this.path.get(t))},t.prototype.$c=function(t){if(0===t.length)throw this.Lc("Document fields must not be empty");if(ff(this.Nc)&&cf.test(t))throw this.Lc('Document fields cannot begin and end with "__"')},t}(),pf=function(){function t(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||Nc(t)}return t.prototype.Uc=function(t,e,n,r){return void 0===r&&(r=!1),new df({Nc:t,methodName:e,qc:n,path:Zr.emptyPath(),Fc:!1,Bc:r},this.databaseId,this.R,this.ignoreUndefinedProperties)},t}();function yf(t){var e=t._freezeSettings(),n=Nc(t._databaseId);return new pf(t._databaseId,!!e.ignoreUndefinedProperties,n)}function gf(t,e,n,r,i,o){void 0===o&&(o={});var s=t.Uc(o.merge||o.mergeFields?2:0,e,n,i);Nf("Data must be an object, but it was:",s,r);var a,u,c=Df(r,s);if(o.merge)a=new ti(s.fieldMask),u=s.fieldTransforms;else if(o.mergeFields){for(var h=[],l=0,f=o.mergeFields;l<f.length;l++){var d=jf(e,f[l],n);if(!s.contains(d))throw new jr(Nr.INVALID_ARGUMENT,"Field '"+d+"' is specified in your field mask but missing from your input data.");Rf(h,d)||h.push(d)}a=new ti(h),u=s.fieldTransforms.filter((function(t){return a.covers(t.field)}))}else a=null,u=s.fieldTransforms;return new hf(new Oi(c),a,u)}var vf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(b.c)(e,t),e.prototype._toFieldTransform=function(t){if(2!==t.Nc)throw t.Lc(1===t.Nc?this._methodName+"() can only appear at the top level of your update data":this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},e.prototype.isEqual=function(t){return t instanceof e},e}(af);function mf(t,e,n){return new df({Nc:3,qc:e.settings.qc,methodName:t._methodName,Fc:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}var bf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(b.c)(e,t),e.prototype._toFieldTransform=function(t){return new Do(t.path,new bo)},e.prototype.isEqual=function(t){return t instanceof e},e}(af),wf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Kc=n,r}return Object(b.c)(e,t),e.prototype._toFieldTransform=function(t){var e=mf(this,t,!0),n=this.Kc.map((function(t){return Sf(t,e)})),r=new wo(n);return new Do(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(af),If=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Kc=n,r}return Object(b.c)(e,t),e.prototype._toFieldTransform=function(t){var e=mf(this,t,!0),n=this.Kc.map((function(t){return Sf(t,e)})),r=new To(n);return new Do(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(af),Tf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Qc=n,r}return Object(b.c)(e,t),e.prototype._toFieldTransform=function(t){var e=new _o(t.R,po(t.R,this.Qc));return new Do(t.path,e)},e.prototype.isEqual=function(t){return this===t},e}(af);function Ef(t,e,n,r){var i=t.Uc(1,e,n);Nf("Data must be an object, but it was:",i,r);var o=[],s=Oi.empty();Wr(r,(function(t,r){var a=Cf(e,t,n);r=Object(w.n)(r);var u=i.Oc(a);if(r instanceof vf)o.push(a);else{var c=Sf(r,u);null!=c&&(o.push(a),s.set(a,c))}}));var a=new ti(o);return new lf(s,a,i.fieldTransforms)}function _f(t,e,n,r,i,o){var s=t.Uc(1,e,n),a=[jf(e,r,n)],u=[i];if(o.length%2!=0)throw new jr(Nr.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)a.push(jf(e,o[c])),u.push(o[c+1]);for(var h=[],l=Oi.empty(),f=a.length-1;f>=0;--f)if(!Rf(h,a[f])){var d=a[f],p=u[f];p=Object(w.n)(p);var y=s.Oc(d);if(p instanceof vf)h.push(d);else{var g=Sf(p,y);null!=g&&(h.push(d),l.set(d,g))}}var v=new ti(h);return new lf(l,v,s.fieldTransforms)}function Of(t,e,n,r){return void 0===r&&(r=!1),Sf(n,t.Uc(r?4:3,e))}function Sf(t,e){if(Af(t=Object(w.n)(t)))return Nf("Unsupported field value:",e,t),Df(t,e);if(t instanceof af)return function(t,e){if(!ff(e.Nc))throw e.Lc(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.Lc(t._methodName+"() is not currently supported inside arrays");var n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Fc&&4!==e.Nc)throw e.Lc("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=Sf(o[i],e.Mc(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=Object(w.n)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return po(e.R,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=zr.fromDate(t);return{timestampValue:Ts(e.R,n)}}if(t instanceof zr)return n=new zr(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:Ts(e.R,n)};if(t instanceof uf)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof sf)return{bytesValue:Es(e.R,t._byteString)};if(t instanceof Gl){var r=t.firestore._databaseId;if(!r.isEqual(n=e.databaseId))throw e.Lc("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:Ss(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Lc("Unsupported field value: "+ql(t))}(t,e)}function Df(t,e){var n={};return Yr(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Wr(t,(function(t,r){var i=Sf(r,e.kc(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function Af(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof zr||t instanceof uf||t instanceof sf||t instanceof Gl||t instanceof af)}function Nf(t,e,n){if(!Af(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){var r=ql(n);throw e.Lc("an object"===r?t+" a custom object":t+" "+r)}}function jf(t,e,n){if((e=Object(w.n)(e))instanceof of)return e._internalPath;if("string"==typeof e)return Cf(t,e);throw xf("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var kf=new RegExp("[~\\*/\\[\\]]");function Cf(t,e,n){if(e.search(kf)>=0)throw xf("Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,n);try{return(new(of.bind.apply(of,Object(b.f)([void 0],e.split(".")))))._internalPath}catch(Rd){throw xf("Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,n)}}function xf(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,a="Function "+e+"() called with invalid data";n&&(a+=" (via `toFirestore()`)");var u="";return(o||s)&&(u+=" (found",o&&(u+=" in field "+r),s&&(u+=" in document "+i),u+=")"),new jr(Nr.INVALID_ARGUMENT,(a+=". ")+t+u)}function Rf(t,e){return t.some((function(t){return t.isEqual(e)}))}var Pf=function(){function t(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new Gl(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),t.prototype.exists=function(){return null!==this._document},t.prototype.data=function(){if(this._document){if(this._converter){var t=new Lf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}},t.prototype.get=function(t){if(this._document){var e=this._document.data.field(Ff("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}},t}(),Lf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(b.c)(e,t),e.prototype.data=function(){return t.prototype.data.call(this)},e}(Pf);function Ff(t,e){return"string"==typeof e?Cf(t,e):e instanceof of?e._internalPath:e._delegate._internalPath}var Mf=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),qf=function(t){function e(e,n,r,i,o,s){var a=this;return(a=t.call(this,e,n,r,i,s)||this)._firestore=e,a._firestoreImpl=e,a.metadata=o,a}return Object(b.c)(e,t),e.prototype.exists=function(){return t.prototype.exists.call(this)},e.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new Uf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}},e.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document){var n=this._document.data.field(Ff("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}},e}(Pf),Uf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(b.c)(e,t),e.prototype.data=function(e){return void 0===e&&(e={}),t.prototype.data.call(this,e)},e}(qf),Vf=function(){function t(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new Mf(r.hasPendingWrites,r.fromCache),this.query=n}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach((function(e){return t.push(e)})),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this._snapshot.docs.forEach((function(r){t.call(e,new Uf(n._firestore,n._userDataWriter,r.key,r,new Mf(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))}))},t.prototype.docChanges=function(t){void 0===t&&(t={});var e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new jr(Nr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){var n=0;return t._snapshot.docChanges.map((function(e){return{type:"added",doc:new Uf(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Mf(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),oldIndex:-1,newIndex:n++}}))}var r=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((function(t){return e||3!==t.type})).map((function(e){var n=new Uf(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Mf(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:Bf(e.type),doc:n,oldIndex:i,newIndex:o}}))}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t}();function Bf(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Fr()}}function Kf(t,e){return t instanceof qf&&e instanceof qf?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof Vf&&e instanceof Vf&&t._firestore===e._firestore&&Xl(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function Gf(t){if(Ji(t)&&0===t.explicitOrderBy.length)throw new jr(Nr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var zf=function(){};function Qf(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++){var o=i[r];t=o._apply(t)}return t}var Hf=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).jc=e,i.Wc=n,i.Gc=r,i.type="where",i}return Object(b.c)(e,t),e.prototype._apply=function(t){var e=yf(t.firestore),n=function(t,e,n,r,i,o,s){var a;if(i.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new jr(Nr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){td(s,o);for(var u=[],c=0,h=s;c<h.length;c++)u.push(Zf(r,t,h[c]));a={arrayValue:{values:u}}}else a=Zf(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||td(s,o),a=Of(n,"where",s,"in"===o||"not-in"===o);var l=xi.create(i,o,a);return function(t,e){if(e.g()){var n=to(t);if(null!==n&&!n.isEqual(e.field))throw new jr(Nr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=Zi(t);null!==r&&ed(0,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw new jr(Nr.INVALID_ARGUMENT,i===e.op?"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter.":"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,l),l}(t._query,0,e,t.firestore._databaseId,this.jc,this.Wc,this.Gc);return new zl(t.firestore,t.converter,function(t,e){var n=t.filters.concat([e]);return new Wi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))},e}(zf),Wf=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).jc=e,r.zc=n,r.type="orderBy",r}return Object(b.c)(e,t),e.prototype._apply=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new jr(Nr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new jr(Nr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new Gi(e,n);return function(t,e){if(null===Zi(t)){var n=to(t);null!==n&&ed(0,n,e.field)}}(t,r),r}(t._query,this.jc,this.zc);return new zl(t.firestore,t.converter,function(t,e){var n=t.explicitOrderBy.concat([e]);return new Wi(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))},e}(zf),Yf=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Hc=n,i.Jc=r,i}return Object(b.c)(e,t),e.prototype._apply=function(t){return new zl(t.firestore,t.converter,io(t._query,this.Hc,this.Jc))},e}(zf),Xf=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Yc=n,i.Xc=r,i}return Object(b.c)(e,t),e.prototype._apply=function(t){var e=Jf(t,this.type,this.Yc,this.Xc);return new zl(t.firestore,t.converter,function(t,e){return new Wi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))},e}(zf),$f=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Yc=n,i.Xc=r,i}return Object(b.c)(e,t),e.prototype._apply=function(t){var e=Jf(t,this.type,this.Yc,this.Xc);return new zl(t.firestore,t.converter,function(t,e){return new Wi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))},e}(zf);function Jf(t,e,n,r){if(n[0]=Object(w.n)(n[0]),n[0]instanceof Pf)return function(t,e,n,r,i){if(!r)throw new jr(Nr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],s=0,a=no(t);s<a.length;s++){var u=a[s];if(u.field.isKeyField())o.push(mi(e,r.key));else{var c=r.data.field(u.field);if(si(c))throw new jr(Nr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var h=u.field.canonicalString();throw new jr(Nr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+h+"' (used as the orderBy) does not exist.")}o.push(c)}}return new Bi(o,i)}(t._query,t.firestore._databaseId,e,n[0]._document,r);var i=yf(t.firestore);return function(t,e,n,r,i,o){var s=t.explicitOrderBy;if(i.length>s.length)throw new jr(Nr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],u=0;u<i.length;u++){var c=i[u];if(s[u].field.isKeyField()){if("string"!=typeof c)throw new jr(Nr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!eo(t)&&-1!==c.indexOf("/"))throw new jr(Nr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child($r.fromString(c));if(!li.isDocumentKey(h))throw new jr(Nr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");var l=new li(h);a.push(mi(e,l))}else{var f=Of(n,r,c);a.push(f)}}return new Bi(a,o)}(t._query,t.firestore._databaseId,i,e,n,r)}function Zf(t,e,n){if("string"==typeof(n=Object(w.n)(n))){if(""===n)throw new jr(Nr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!eo(e)&&-1!==n.indexOf("/"))throw new jr(Nr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child($r.fromString(n));if(!li.isDocumentKey(r))throw new jr(Nr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return mi(t,new li(r))}if(n instanceof Gl)return mi(t,n._key);throw new jr(Nr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+ql(n)+".")}function td(t,e){if(!Array.isArray(t)||0===t.length)throw new jr(Nr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new jr(Nr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function ed(t,e,n){if(!n.isEqual(e))throw new jr(Nr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}var nd=function(){function t(){}return t.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),fi(t)){case 0:return null;case 1:return t.booleanValue;case 2:return ii(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(oi(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Fr()}},t.prototype.convertObject=function(t,e){var n=this,r={};return Wr(t.fields,(function(t,i){r[t]=n.convertValue(i,e)})),r},t.prototype.convertGeoPoint=function(t){return new uf(ii(t.latitude),ii(t.longitude))},t.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map((function(t){return n.convertValue(t,e)}))},t.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=function t(e){var n=e.mapValue.fields.__previous_value__;return si(n)?t(n):n}(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(ai(t));default:return null}},t.prototype.convertTimestamp=function(t){var e=ri(t);return new zr(e.seconds,e.nanos)},t.prototype.convertDocumentKey=function(t,e){var n=$r.fromString(t);Mr(Xs(n));var r=new Sl(n.get(1),n.get(3)),i=new li(n.popFirst(5));return r.isEqual(e)||Rr("Document "+i+" contains a document reference within a different database ("+r.projectId+"/"+r.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),i},t}();function rd(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var id=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(b.c)(e,t),e.prototype.convertBytes=function(t){return new sf(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new Gl(this.firestore,null,e)},e}(nd),od=function(){function t(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=yf(t)}return t.prototype.set=function(t,e,n){this._verifyNotCommitted();var r=sd(t,this._firestore),i=rd(r.converter,e,n),o=gf(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(o.toMutation(r._key,No.none())),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this._verifyNotCommitted();var o,s=sd(t,this._firestore);return o="string"==typeof(e=Object(w.n)(e))||e instanceof of?_f(this._dataReader,"WriteBatch.update",s._key,e,n,r):Ef(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(o.toMutation(s._key,No.exists(!0))),this},t.prototype.delete=function(t){this._verifyNotCommitted();var e=sd(t,this._firestore);return this._mutations=this._mutations.concat(new Go(e._key,No.none())),this},t.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},t.prototype._verifyNotCommitted=function(){if(this._committed)throw new jr(Nr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}();function sd(t,e){if((t=Object(w.n)(t)).firestore!==e)throw new jr(Nr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var ad=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(b.c)(e,t),e.prototype.convertBytes=function(t){return new sf(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new Gl(this.firestore,null,e)},e}(nd);function ud(t,e,n){t=Ul(t,Gl);var r=Ul(t.firestore,Zl),i=rd(t.converter,e,n);return ld(r,[gf(yf(r),"setDoc",t._key,i,null!==t.converter,n).toMutation(t._key,No.none())])}function cd(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=Ul(t,Gl);var o=Ul(t.firestore,Zl),s=yf(o);return ld(o,[("string"==typeof(e=Object(w.n)(e))||e instanceof of?_f(s,"updateDoc",t._key,e,n,r):Ef(s,"updateDoc",t._key,e)).toMutation(t._key,No.exists(!0))])}function hd(t){for(var e,n,r,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];t=Object(w.n)(t);var s={includeMetadataChanges:!1},a=0;"object"!=typeof i[a]||Jl(i[a])||(s=i[a],a++);var u,c,h,l={includeMetadataChanges:s.includeMetadataChanges};if(Jl(i[a])){var f=i[a];i[a]=null===(e=f.next)||void 0===e?void 0:e.bind(f),i[a+1]=null===(n=f.error)||void 0===n?void 0:n.bind(f),i[a+2]=null===(r=f.complete)||void 0===r?void 0:r.bind(f)}if(t instanceof Gl)c=Ul(t.firestore,Zl),h=Xi(t._key.path),u={next:function(e){i[a]&&i[a](fd(c,t,e))},error:i[a+1],complete:i[a+2]};else{var d=Ul(t,zl);c=Ul(d.firestore,Zl),h=d._query;var p=new ad(c);u={next:function(t){i[a]&&i[a](new Vf(c,p,d,t))},error:i[a+1],complete:i[a+2]},Gf(t._query)}return function(t,e,n,r){var i=this,o=new hl(r),s=new wh(e,o,n);return t.asyncQueue.enqueueAndForget((function(){return Object(b.b)(i,void 0,void 0,(function(){var e;return Object(b.d)(this,(function(n){switch(n.label){case 0:return e=yh,[4,Tl(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}}))}))})),function(){o.Wo(),t.asyncQueue.enqueueAndForget((function(){return Object(b.b)(i,void 0,void 0,(function(){var e;return Object(b.d)(this,(function(n){switch(n.label){case 0:return e=gh,[4,Tl(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}}))}))}))}}(tf(c),h,l,u)}function ld(t,e){return function(t,e){var n=this,r=new wa;return t.asyncQueue.enqueueAndForget((function(){return Object(b.b)(n,void 0,void 0,(function(){var n;return Object(b.d)(this,(function(i){switch(i.label){case 0:return n=Ch,[4,Il(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(tf(t),e)}function fd(t,e,n){var r=n.docs.get(e._key),i=new ad(t);return new qf(t,i,e._key,r,new Mf(n.hasPendingWrites,n.fromCache),e.converter)}var dd=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this)._firestore=e,r}return Object(b.c)(e,t),e.prototype.get=function(e){var n=this,r=sd(e,this._firestore),i=new ad(this._firestore);return t.prototype.get.call(this,e).then((function(t){return new qf(n._firestore,i,r._key,t._document,new Mf(!1,!1),r.converter)}))},e}(function(){function t(t,e){this._firestore=t,this._transaction=e,this._dataReader=yf(t)}return t.prototype.get=function(t){var e=this,n=sd(t,this._firestore),r=new id(this._firestore);return this._transaction.lookup([n._key]).then((function(t){if(!t||1!==t.length)return Fr();var i=t[0];if(i.isFoundDocument())return new Pf(e._firestore,r,i.key,i,n.converter);if(i.isNoDocument())return new Pf(e._firestore,r,n._key,null,n.converter);throw Fr()}))},t.prototype.set=function(t,e,n){var r=sd(t,this._firestore),i=rd(r.converter,e,n),o=gf(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,o),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o,s=sd(t,this._firestore);return o="string"==typeof(e=Object(w.n)(e))||e instanceof of?_f(this._dataReader,"Transaction.update",s._key,e,n,r):Ef(this._dataReader,"Transaction.update",s._key,e),this._transaction.update(s._key,o),this},t.prototype.delete=function(t){var e=sd(t,this._firestore);return this._transaction.delete(e._key),this},t}());function pd(){if("undefined"==typeof Uint8Array)throw new jr(Nr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function yd(){if("undefined"==typeof atob)throw new jr(Nr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var gd=function(){function t(t){this._delegate=t}return t.fromBase64String=function(e){return yd(),new t(sf.fromBase64String(e))},t.fromUint8Array=function(e){return pd(),new t(sf.fromUint8Array(e))},t.prototype.toBase64=function(){return yd(),this._delegate.toBase64()},t.prototype.toUint8Array=function(){return pd(),this._delegate.toUint8Array()},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t}(),vd=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){rf(t=Ul(t,Zl));var n=tf(t),r=t._freezeSettings(),i=new cl;return nf(n,i,new al(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})},t.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){rf(t=Ul(t,Zl));var e=tf(t),n=t._freezeSettings(),r=new cl;return nf(e,r,new ul(r,n.cacheSizeBytes))}(t._delegate)},t.prototype.clearIndexedDbPersistence=function(t){return function(t){var e=this;if(t._initialized&&!t._terminated)throw new jr(Nr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var n=new wa;return t._queue.enqueueAndForgetEvenWhileRestricted((function(){return Object(b.b)(e,void 0,void 0,(function(){var e;return Object(b.d)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,function(t){return Object(b.b)(this,void 0,void 0,(function(){return Object(b.d)(this,(function(e){switch(e.label){case 0:return Ea.yt()?[4,Ea.delete(t+"main")]:[2,Promise.resolve()];case 1:return e.sent(),[2]}}))}))}(Ru(t._databaseId,t._persistenceKey))];case 1:return r.sent(),n.resolve(),[3,3];case 2:return e=r.sent(),n.reject(e),[3,3];case 3:return[2]}}))}))})),n.promise}(t._delegate)},t}(),md=function(){function t(t,e,n){var r=this;this._delegate=e,this.Zc=n,this.INTERNAL={delete:function(){return r.terminate()}},t instanceof Sl||(this.tu=t)}return Object.defineProperty(t.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){var e=this._delegate._getSettings();t.merge||e.host===t.host||Pr("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&delete(t=Object.assign(Object.assign({},e),t)).merge,this._delegate._setSettings(t)},t.prototype.useEmulator=function(t,e,n){void 0===n&&(n={}),function(t,e,n,r){var i;void 0===r&&(r={});var o=(t=Ul(t,Kl))._getSettings();if("firestore.googleapis.com"!==o.host&&o.host!==e&&Pr("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},o),{host:e+":"+n,ssl:!1})),r.mockUserToken){var s,a;if("string"==typeof r.mockUserToken)s=r.mockUserToken,a=lc.MOCK_USER;else{s=Object(w.i)(r.mockUserToken,null===(i=t._app)||void 0===i?void 0:i.options.projectId);var u=r.mockUserToken.sub||r.mockUserToken.user_id;if(!u)throw new jr(Nr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");a=new lc(u)}t._credentials=new jl(new Al(s,a))}}(this._delegate,t,e,n)},t.prototype.enableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue((function(){return Object(b.b)(e,void 0,void 0,(function(){var e,n;return Object(b.d)(this,(function(r){switch(r.label){case 0:return[4,ml(t)];case 1:return e=r.sent(),[4,wl(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!0),function(t){var e=qr(t);return e.Or.delete(0),Fc(e)}(n))]}}))}))}))}(tf(Ul(this._delegate,Zl)))},t.prototype.disableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue((function(){return Object(b.b)(e,void 0,void 0,(function(){var e,n;return Object(b.d)(this,(function(r){switch(r.label){case 0:return[4,ml(t)];case 1:return e=r.sent(),[4,wl(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!1),function(t){return Object(b.b)(this,void 0,void 0,(function(){var e;return Object(b.d)(this,(function(n){switch(n.label){case 0:return(e=qr(t)).Or.add(0),[4,Mc(e)];case 1:return n.sent(),e.Br.set("Offline"),[2]}}))}))}(n))]}}))}))}))}(tf(Ul(this._delegate,Zl)))},t.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&Ll("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Zc.enableMultiTabIndexedDbPersistence(this):this.Zc.enableIndexedDbPersistence(this,n)},t.prototype.clearPersistence=function(){return this.Zc.clearIndexedDbPersistence(this)},t.prototype.terminate=function(){return this.tu&&(this.tu._removeServiceInstance("firestore"),this.tu._removeServiceInstance("firestore-exp")),this._delegate._delete()},t.prototype.waitForPendingWrites=function(){return function(t){var e=this,n=new wa;return t.asyncQueue.enqueueAndForget((function(){return Object(b.b)(e,void 0,void 0,(function(){var e;return Object(b.d)(this,(function(r){switch(r.label){case 0:return e=Mh,[4,Il(t)];case 1:return[2,e.apply(void 0,[r.sent(),n])]}}))}))})),n.promise}(tf(Ul(this._delegate,Zl)))},t.prototype.onSnapshotsInSync=function(t){return function(t,e){return function(t,e){var n=this,r=new hl(e);return t.asyncQueue.enqueueAndForget((function(){return Object(b.b)(n,void 0,void 0,(function(){var e;return Object(b.d)(this,(function(n){switch(n.label){case 0:return e=function(t,e){qr(t).Gr.add(e),e.next()},[4,Tl(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}}))}))})),function(){r.Wo(),t.asyncQueue.enqueueAndForget((function(){return Object(b.b)(n,void 0,void 0,(function(){var e;return Object(b.d)(this,(function(n){switch(n.label){case 0:return e=function(t,e){qr(t).Gr.delete(e)},[4,Tl(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}}))}))}))}}(tf(t=Ul(t,Zl)),Jl(e)?e:{next:e})}(this._delegate,t)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this.tu)throw new jr(Nr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.tu},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new Cd(this,Hl(this._delegate,t))}catch(t){throw _d(t,"collection()","Firestore.collection()")}},t.prototype.doc=function(t){try{return new Ed(this,Wl(this._delegate,t))}catch(t){throw _d(t,"doc()","Firestore.doc()")}},t.prototype.collectionGroup=function(t){try{return new Nd(this,function(t,e){if(t=Ul(t,Kl),Rl("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new jr(Nr.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new zl(t,null,function(t){return new Wi($r.emptyPath(),t)}(e))}(this._delegate,t))}catch(t){throw _d(t,"collectionGroup()","Firestore.collectionGroup()")}},t.prototype.runTransaction=function(t){var e=this;return function(t,e){return function(t,e){var n=this,r=new wa;return t.asyncQueue.enqueueAndForget((function(){return Object(b.b)(n,void 0,void 0,(function(){var n;return Object(b.d)(this,(function(i){switch(i.label){case 0:return[4,function(t){return vl(t).then((function(t){return t.datastore}))}(t)];case 1:return n=i.sent(),new fl(t.asyncQueue,n,e,r).run(),[2]}}))}))})),r.promise}(tf(t),(function(n){return e(new dd(t,n))}))}(this._delegate,(function(n){return t(new wd(e,n))}))},t.prototype.batch=function(){var t=this;return tf(this._delegate),new Id(new od(this._delegate,(function(e){return ld(t._delegate,e)})))},t.prototype.loadBundle=function(t){throw new jr(Nr.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},t.prototype.namedQuery=function(t){throw new jr(Nr.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},t}(),bd=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(b.c)(e,t),e.prototype.convertBytes=function(t){return new gd(new sf(t))},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return Ed.eu(e,this.firestore,null)},e}(nd),wd=function(){function t(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new bd(t)}return t.prototype.get=function(t){var e=this,n=xd(t);return this._delegate.get(n).then((function(t){return new Dd(e._firestore,new qf(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n.converter))}))},t.prototype.set=function(t,e,n){var r=xd(t);return n?(Pl("Transaction.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=xd(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,Object(b.f)([s,e,n],i)),this},t.prototype.delete=function(t){var e=xd(t);return this._delegate.delete(e),this},t}(),Id=function(){function t(t){this._delegate=t}return t.prototype.set=function(t,e,n){var r=xd(t);return n?(Pl("WriteBatch.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=xd(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,Object(b.f)([s,e,n],i)),this},t.prototype.delete=function(t){var e=xd(t);return this._delegate.delete(e),this},t.prototype.commit=function(){return this._delegate.commit()},t}(),Td=function(){function t(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}return t.prototype.fromFirestore=function(t,e){var n=new Uf(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new Ad(this._firestore,n),null!=e?e:{})},t.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},t.nu=function(e,n){var r=t.su,i=r.get(e);i||(i=new WeakMap,r.set(e,i));var o=i.get(n);return o||(o=new t(e,new bd(e),n),i.set(n,o)),o},t}();Td.su=new WeakMap;var Ed=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new bd(t)}return t.iu=function(e,n,r){if(e.length%2!=0)throw new jr(Nr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(n,new Gl(n._delegate,r,new li(e)))},t.eu=function(e,n,r){return new t(n,new Gl(n._delegate,r,e))},Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new Cd(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new Cd(this.firestore,Hl(this._delegate,t))}catch(t){throw _d(t,"collection()","DocumentReference.collection()")}},t.prototype.isEqual=function(t){return(t=Object(w.n)(t))instanceof Gl&&Yl(this._delegate,t)},t.prototype.set=function(t,e){e=Pl("DocumentReference.set",e);try{return e?ud(this._delegate,t,e):ud(this._delegate,t)}catch(t){throw _d(t,"setDoc()","DocumentReference.set()")}},t.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?cd(this._delegate,t):cd.apply(void 0,Object(b.f)([this._delegate,t,e],n))}catch(t){throw _d(t,"updateDoc()","DocumentReference.update()")}},t.prototype.delete=function(){return ld(Ul((t=this._delegate).firestore,Zl),[new Go(t._key,No.none())]);var t},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=Od(e),i=Sd(e,(function(e){return new Dd(t.firestore,new qf(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate.converter))}));return hd(this._delegate,r,i)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=Ul(t,Gl);var e=Ul(t.firestore,Zl),n=tf(e),r=new ad(e);return function(t,e){var n=this,r=new wa;return t.asyncQueue.enqueueAndForget((function(){return Object(b.b)(n,void 0,void 0,(function(){var n;return Object(b.d)(this,(function(i){switch(i.label){case 0:return n=function(t,e,n){return Object(b.b)(this,void 0,void 0,(function(){var r,i;return Object(b.d)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,function(t,e){var n=qr(t);return n.persistence.runTransaction("read document","readonly",(function(t){return n.Mn.mn(t,e)}))}(t,e)];case 1:return(i=o.sent()).isFoundDocument()?n.resolve(i):i.isNoDocument()?n.resolve(null):n.reject(new jr(Nr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=o.sent(),i=ch(r,"Failed to get document '"+e+" from cache"),n.reject(i),[3,3];case 3:return[2]}}))}))},[4,bl(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(n,t._key).then((function(n){return new qf(e,r,t._key,n,new Mf(null!==n&&n.hasLocalMutations,!0),t.converter)}))}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Ul(t,Gl);var e=Ul(t.firestore,Zl);return El(tf(e),t._key,{source:"server"}).then((function(n){return fd(e,t,n)}))}(this._delegate):function(t){t=Ul(t,Gl);var e=Ul(t.firestore,Zl);return El(tf(e),t._key).then((function(n){return fd(e,t,n)}))}(this._delegate)).then((function(t){return new Dd(e.firestore,new qf(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate.converter))}))},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?Td.nu(this.firestore,e):null))},t}();function _d(t,e,n){return t.message=t.message.replace(e,n),t}function Od(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!Jl(r))return r}return{}}function Sd(t,e){var n,r,i;return{next:function(t){i.next&&i.next(e(t))},error:null===(n=(i=Jl(t[0])?t[0]:Jl(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}var Dd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"ref",{get:function(){return new Ed(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),t.prototype.data=function(t){return this._delegate.data(t)},t.prototype.get=function(t,e){return this._delegate.get(t,e)},t.prototype.isEqual=function(t){return Kf(this._delegate,t._delegate)},t}(),Ad=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(b.c)(e,t),e.prototype.data=function(t){return this._delegate.data(t)},e}(Dd),Nd=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new bd(t)}return t.prototype.where=function(e,n,r){try{return new t(this.firestore,Qf(this._delegate,function(t,e,n){var r=e,i=Ff("where",t);return new Hf(i,r,n)}(e,n,r)))}catch(e){throw _d(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.orderBy=function(e,n){try{return new t(this.firestore,Qf(this._delegate,function(t,e){void 0===e&&(e="asc");var n=e,r=Ff("orderBy",t);return new Wf(r,n)}(e,n)))}catch(e){throw _d(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.limit=function(e){try{return new t(this.firestore,Qf(this._delegate,function(t){return Vl("limit",t),new Yf("limit",t,"F")}(e)))}catch(e){throw _d(e,"limit()","Query.limit()")}},t.prototype.limitToLast=function(e){try{return new t(this.firestore,Qf(this._delegate,function(t){return Vl("limitToLast",t),new Yf("limitToLast",t,"L")}(e)))}catch(e){throw _d(e,"limitToLast()","Query.limitToLast()")}},t.prototype.startAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Qf(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Xf("startAt",t,!0)}).apply(void 0,e)))}catch(e){throw _d(e,"startAt()","Query.startAt()")}},t.prototype.startAfter=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Qf(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Xf("startAfter",t,!1)}).apply(void 0,e)))}catch(e){throw _d(e,"startAfter()","Query.startAfter()")}},t.prototype.endBefore=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Qf(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new $f("endBefore",t,!0)}).apply(void 0,e)))}catch(e){throw _d(e,"endBefore()","Query.endBefore()")}},t.prototype.endAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Qf(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new $f("endAt",t,!1)}).apply(void 0,e)))}catch(e){throw _d(e,"endAt()","Query.endAt()")}},t.prototype.isEqual=function(t){return Xl(this._delegate,t._delegate)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=Ul(t,zl);var e=Ul(t.firestore,Zl),n=tf(e),r=new ad(e);return function(t,e){var n=this,r=new wa;return t.asyncQueue.enqueueAndForget((function(){return Object(b.b)(n,void 0,void 0,(function(){var n;return Object(b.d)(this,(function(i){switch(i.label){case 0:return n=function(t,e,n){return Object(b.b)(this,void 0,void 0,(function(){var r,i,o,s,a;return Object(b.d)(this,(function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,Yu(t,e,!0)];case 1:return a=u.sent(),r=new Oh(e,a.Bn),i=r._o(a.documents),o=r.applyChanges(i,!1),n.resolve(o.snapshot),[3,3];case 2:return s=u.sent(),a=ch(s,"Failed to execute query '"+e+" against cache"),n.reject(a),[3,3];case 3:return[2]}}))}))},[4,bl(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(n,t._query).then((function(n){return new Vf(e,r,t,n)}))}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Ul(t,zl);var e=Ul(t.firestore,Zl),n=tf(e),r=new ad(e);return _l(n,t._query,{source:"server"}).then((function(n){return new Vf(e,r,t,n)}))}(this._delegate):function(t){t=Ul(t,zl);var e=Ul(t.firestore,Zl),n=tf(e),r=new ad(e);return Gf(t._query),_l(n,t._query).then((function(n){return new Vf(e,r,t,n)}))}(this._delegate)).then((function(t){return new kd(e.firestore,new Vf(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))}))},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=Od(e),i=Sd(e,(function(e){return new kd(t.firestore,new Vf(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))}));return hd(this._delegate,r,i)},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?Td.nu(this.firestore,e):null))},t}(),jd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"doc",{get:function(){return new Ad(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),t}(),kd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"query",{get:function(){return new Nd(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map((function(e){return new Ad(t._firestore,e)}))},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map((function(t){return new jd(e._firestore,t)}))},t.prototype.forEach=function(t,e){var n=this;this._delegate.forEach((function(r){t.call(e,new Ad(n._firestore,r))}))},t.prototype.isEqual=function(t){return Kf(this._delegate,t._delegate)},t}(),Cd=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).firestore=e,r._delegate=n,r}return Object(b.c)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new Ed(this.firestore,t):null},enumerable:!1,configurable:!0}),e.prototype.doc=function(t){try{return new Ed(this.firestore,void 0===t?Wl(this._delegate):Wl(this._delegate,t))}catch(t){throw _d(t,"doc()","CollectionReference.doc()")}},e.prototype.add=function(t){var e=this;return function(t,e){var n=Ul(t.firestore,Zl),r=Wl(t),i=rd(t.converter,e);return ld(n,[gf(yf(t.firestore),"addDoc",r._key,i,null!==t.converter,{}).toMutation(r._key,No.exists(!1))]).then((function(){return r}))}(this._delegate,t).then((function(t){return new Ed(e.firestore,t)}))},e.prototype.isEqual=function(t){return Yl(this._delegate,t._delegate)},e.prototype.withConverter=function(t){return new e(this.firestore,this._delegate.withConverter(t?Td.nu(this.firestore,t):null))},e}(Nd);function xd(t){return Ul(t,Gl)}var Rd,Pd=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._delegate=new(of.bind.apply(of,Object(b.f)([void 0],t)))}return t.documentId=function(){return new t(Zr.keyField().canonicalString())},t.prototype.isEqual=function(t){return(t=Object(w.n)(t))instanceof of&&this._delegate._internalPath.isEqual(t._internalPath)},t}(),Ld=function(){function t(t){this._delegate=t}return t.serverTimestamp=function(){var e=new bf("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new t(e)},t.delete=function(){var e=new vf("deleteField");return e._methodName="FieldValue.delete",new t(e)},t.arrayUnion=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new wf("arrayUnion",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayUnion",new t(r)},t.arrayRemove=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new If("arrayRemove",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayRemove",new t(r)},t.increment=function(e){var n=function(t){return new Tf("increment",t)}(e);return n._methodName="FieldValue.increment",new t(n)},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t}(),Fd=n("/6Yf"),Md={Firestore:md,GeoPoint:uf,Timestamp:zr,Blob:gd,Transaction:wd,WriteBatch:Id,DocumentReference:Ed,DocumentSnapshot:Dd,Query:Nd,QueryDocumentSnapshot:Ad,QuerySnapshot:kd,CollectionReference:Cd,FieldPath:Pd,FieldValue:Ld,setLogLevel:function(t){kr.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};(function(t,e){t.INTERNAL.registerComponent(new Fd.a("firestore",(function(t){return function(t,e){return new md(t,new Zl(t,e),new vd)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))}),"PUBLIC").setServiceProps(Object.assign({},Md)))})(Rd=m.a),Rd.registerVersion("@firebase/firestore","2.4.1");var qd=n("UbJi");function Ud(t,e){return function(t,e=i.b){return new o.a(n=>{let r;return null!=e?e.schedule(()=>{r=t.onSnapshot({includeMetadataChanges:!0},n)}):r=t.onSnapshot({includeMetadataChanges:!0},n),()=>{null!=r&&r()}})}(t,e)}function Vd(t,e){return Ud(t,e).pipe(Object(h.a)(t=>({payload:t,type:"query"})))}function Bd(t,e){return Vd(t,e).pipe(Object(u.a)(void 0),Object(c.a)(),Object(h.a)(([t,e])=>{const n=e.payload.docChanges(),r=n.map(t=>({type:t.type,payload:t}));return t&&JSON.stringify(t.payload.metadata)!==JSON.stringify(e.payload.metadata)&&e.payload.docs.forEach((e,i)=>{const o=n.find(t=>t.doc.ref.isEqual(e.ref)),s=null==t?void 0:t.payload.docs.find(t=>t.ref.isEqual(e.ref));o&&JSON.stringify(o.doc.metadata)===JSON.stringify(e.metadata)||!o&&s&&JSON.stringify(s.metadata)===JSON.stringify(e.metadata)||r.push({type:"modified",payload:{oldIndex:i,newIndex:i,type:"modified",doc:e}})}),r}))}function Kd(t,e,n){return Bd(t,n).pipe(Object(l.a)((t,n)=>function(t,e,n){return e.forEach(e=>{n.indexOf(e.type)>-1&&(t=function(t,e){switch(e.type){case"added":if(!t[e.newIndex]||!t[e.newIndex].doc.ref.isEqual(e.doc.ref))return Gd(t,e.newIndex,0,e);break;case"modified":if(null==t[e.oldIndex]||t[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const n=t.slice();return n.splice(e.oldIndex,1),n.splice(e.newIndex,0,e),n}return Gd(t,e.newIndex,1,e)}break;case"removed":if(t[e.oldIndex]&&t[e.oldIndex].doc.ref.isEqual(e.doc.ref))return Gd(t,e.oldIndex,1)}return t}(t,e))}),t}(t,n.map(t=>t.payload),e),[]),Object(f.a)(),Object(h.a)(t=>t.map(t=>({type:t.type,payload:t}))))}function Gd(t,e,n,...r){const i=t.slice();return i.splice(e,n,...r),i}function zd(t){return t&&0!==t.length||(t=["added","removed","modified"]),t}class Qd{constructor(t,e,n){this.ref=t,this.query=e,this.afs=n}stateChanges(t){let e=Bd(this.query,this.afs.schedulers.outsideAngular);return t&&t.length>0&&(e=e.pipe(Object(h.a)(e=>e.filter(e=>t.indexOf(e.type)>-1)))),e.pipe(Object(u.a)(void 0),Object(c.a)(),Object(d.a)(([t,e])=>e.length>0||!t),Object(h.a)(([t,e])=>e),this.afs.keepUnstableUntilFirst)}auditTrail(t){return this.stateChanges(t).pipe(Object(l.a)((t,e)=>[...t,...e],[]))}snapshotChanges(t){const e=zd(t);return Kd(this.query,e,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return Vd(this.query,this.afs.schedulers.outsideAngular).pipe(Object(h.a)(e=>e.payload.docs.map(e=>t.idField?Object.assign(Object.assign({},e.data()),{[t.idField]:e.id}):e.data())),this.afs.keepUnstableUntilFirst)}get(t){return Object(s.a)(this.query.get(t)).pipe(Object(p.b)(this.afs.schedulers.insideAngular))}add(t){return this.ref.add(t)}doc(t){return new Hd(this.ref.doc(t),this.afs)}}class Hd{constructor(t,e){this.ref=t,this.afs=e}set(t,e){return this.ref.set(t,e)}update(t){return this.ref.update(t)}delete(){return this.ref.delete()}collection(t,e){const n=this.ref.collection(t),{ref:r,query:i}=Zd(n,e);return new Qd(r,i,this.afs)}snapshotChanges(){return Ud(this.ref,this.afs.schedulers.outsideAngular).pipe(Object(u.a)(void 0),Object(c.a)(),Object(h.a)(([t,e])=>e.exists?(null==t?void 0:t.exists)?{payload:e,type:"modified"}:{payload:e,type:"added"}:{payload:e,type:"removed"})).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return this.snapshotChanges().pipe(Object(h.a)(({payload:e})=>t.idField?Object.assign(Object.assign({},e.data()),{[t.idField]:e.id}):e.data()))}get(t){return Object(s.a)(this.ref.get(t)).pipe(Object(p.b)(this.afs.schedulers.insideAngular))}}class Wd{constructor(t,e){this.query=t,this.afs=e}stateChanges(t){return t&&0!==t.length?Bd(this.query,this.afs.schedulers.outsideAngular).pipe(Object(h.a)(e=>e.filter(e=>t.indexOf(e.type)>-1)),Object(d.a)(t=>t.length>0),this.afs.keepUnstableUntilFirst):Bd(this.query,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}auditTrail(t){return this.stateChanges(t).pipe(Object(l.a)((t,e)=>[...t,...e],[]))}snapshotChanges(t){const e=zd(t);return Kd(this.query,e,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return Vd(this.query,this.afs.schedulers.outsideAngular).pipe(Object(h.a)(e=>e.payload.docs.map(e=>t.idField?Object.assign({[t.idField]:e.id},e.data()):e.data())),this.afs.keepUnstableUntilFirst)}get(t){return Object(s.a)(this.query.get(t)).pipe(Object(p.b)(this.afs.schedulers.insideAngular))}}const Yd=new r.q("angularfire2.enableFirestorePersistence"),Xd=new r.q("angularfire2.firestore.persistenceSettings"),$d=new r.q("angularfire2.firestore.settings"),Jd=new r.q("angularfire2.firestore.use-emulator");function Zd(t,e=(t=>t)){return{query:e(t),ref:t}}let tp=(()=>{class t{constructor(t,e,n,r,i,o,u,c,h){this.schedulers=new y.d(o),this.keepUnstableUntilFirst=Object(y.h)(this.schedulers);const l=Object(y.g)(t,o,e);!v.a.auth&&h&&Object(y.j)();const f=c;[this.firestore,this.persistenceEnabled$]=Object(y.f)(l.name+".firestore","AngularFirestore",l,()=>{const t=o.runOutsideAngular(()=>l.firestore());if(r&&t.settings(r),f&&t.useEmulator(...f),n&&!Object(g.C)(i)){const e=()=>{try{return Object(s.a)(t.enablePersistence(u||void 0).then(()=>!0,()=>!1))}catch(Rd){return"undefined"!=typeof console&&console.warn(Rd),Object(a.a)(!1)}};return[t,o.runOutsideAngular(e)]}return[t,Object(a.a)(!1)]},[r,f,n])}collection(t,e){let n;n="string"==typeof t?this.firestore.collection(t):t;const{ref:r,query:i}=Zd(n,e),o=this.schedulers.ngZone.run(()=>r);return new Qd(o,i,this)}collectionGroup(t,e){const n=e||(t=>t),r=this.firestore.collectionGroup(t);return new Wd(n(r),this)}doc(t){let e;e="string"==typeof t?this.firestore.doc(t):t;const n=this.schedulers.ngZone.run(()=>e);return new Hd(n,this)}createId(){return this.firestore.collection("_").doc().id}}return t.\u0275fac=function(e){return new(e||t)(r.ac(y.c),r.ac(y.b,8),r.ac(Yd,8),r.ac($d,8),r.ac(r.B),r.ac(r.z),r.ac(Xd,8),r.ac(Jd,8),r.ac(qd.a,8))},t.\u0275prov=r.Ib({factory:function(){return new t(r.ac(y.c),r.ac(y.b,8),r.ac(Yd,8),r.ac($d,8),r.ac(r.B),r.ac(r.z),r.ac(Xd,8),r.ac(Jd,8),r.ac(qd.a,8))},token:t,providedIn:"any"}),t})()},hKST:function(t,e,n){"use strict";n.d(e,"a",(function(){return h}));var r=n("fXoL"),i=n("b6lD"),o=n("oEi/"),s=n("tyNb"),a=n("o+pE"),u=n("I/3d"),c=n("sSZD");let h=(()=>{class t{constructor(t,e,n,r,i,o){this.httpService=t,this.storageService=e,this.router=n,this.errorService=r,this.fireServices=i,this.angularFireDatabase=o,this.dataTableParams={offset:0,size:10,sortField:"NAME",sortOrder:1,searchText:null}}prepareQueryParam(t){const e=new URLSearchParams;for(const n in t)e.set(n,t[n]);return e}getUser(t){return this.queryParam=this.prepareQueryParam(this.dataTableParams),this.angularFireDatabase.object("user/"+t)}changePassword(t,e,n){return this.angularFireDatabase.object("user/"+t).set({amount:e.amount,createdDate:e.createdDate,id:e.id,updatedDate:e.updatedDate,user_name:e.user_name,password:n})}}return t.\u0275fac=function(e){return new(e||t)(r.ac(i.a),r.ac(o.a),r.ac(s.a),r.ac(a.a),r.ac(u.a),r.ac(c.a))},t.\u0275prov=r.Ib({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},"oD4/":function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));const r={PASSWORD_REGX:"^(?=.*[0-9])(?=.*[a-z])(?=.*[A-Z])(?=.*[@#$%^&+=.*-/\\\\;!])(?=\\S+$).{8,}$",EMAIL_REGEX:"^[_A-Za-z0-9-+]+(.[_A-Za-z0-9-]+)*@[A-Za-z0-9-]+(.[A-Za-z0-9]+)*(.[A-Za-z]{2,})$",CLIENT_EMAIL_REGEX:"/^([w-.]+@(?!gmail.com)(?!yahoo.com)(?!aol.com)(?!outlook.com)(?!zoho.com)(?!mail.com)(?!protonmail.com)(?!icloud.com)(?!gmx.com)(?!yandex.com)(?!hubspot.com)(?!hotmail.com)([w-]+.)+[w-]{2,4})?$/",MASTER_TABLE_ROW_SIZE:10,MASTER_TABLE_PAGINATE_DROPDOWN:[10,20,30],EIN_REGX:"^((?!11-1111111)(?!22-2222222)(?!33-3333333)(?!44-4444444)(?!55-5555555)(?!66-6666666)(?!77-7777777)(?!88-8888888)(?!99-9999999)(?!12-3456789)(?!00-[0-9]{7})([0-9]{2}-[0-9]{7}))*$",SSN_REGX:"^((?!111-11-1111)(?!222-22-2222)(?!333-33-3333)(?!444-44-4444)(?!555-55-5555)(?!666-66-6666)(?!777-77-7777)(?!888-88-8888)(?!999-99-9999)(?!123-45-6789)(?!000-[0-9]{2}-[0-9]{4})([0-9]{3}-[0-9]{2}-[0-9]{4}))*$",MOBILE_PHONE:"^((+){1}91){1}[1-9]{1}[0-9]{9}$",TRUNCATE_LENGTH:"30",WEBSITE_URL:"^(http[s]?://)?([^.:/@#]+)(\\.[^.:/@#]+)+$",COMMON_PASSWORD_FOR_ADMIN_ADD_FUNCTIONALITY:"jKii@3456",blockSpecial:/^[^<>*!&^@#$%()_{}'":;?~`.,<>=+[\]]+$/,blockSpecialForExperience:/^[A-Z@~`!@#$%^&*()_=+\\\\';:\"\\/?>.<,-]*$/i}}}]);